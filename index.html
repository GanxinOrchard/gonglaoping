<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>æŸ‘å¿ƒæœåœ’ï½œå…¬è€åªæ¤ªæŸ‘ãƒ»æ±å‹¢èŒ‚è°·ï½œåœ¨åœ°å‚³æ‰¿çš„å¥½æ»‹å‘³</title>
<meta name="description" content="æŸ‘å¿ƒæœåœ’ï¼šç”¨å¿ƒç¨®æŸ‘ï¼Œèˆ‡ä½ æŸ‘å¿ƒç›¸ä¼´ã€‚å…¬è€åªå±±é ‚åœ¨åœ°50å¹´æ¤ªæŸ‘ã€æ±å‹¢åœ¨åœ°30å¹´èŒ‚è°·ã€‚ç¾æ¡åˆ†ç´šç›´é€ï¼Œ10/25 å°æ–¤å¤šè¦æ ¼ï¼ŒåŒ¯æ¬¾ç«‹å³å®‰æ’å‡ºè²¨ã€‚åˆ°è²¨è«‹é–‹ç®±éŒ„å½±ä¿éšœç†è³ ã€‚">

<style>
:root{
  --bg:#faf7f2;
  --surface:#ffffff;
  --text:#1f2937;
  --muted:#6b7280;
  --brand:#f59e0b;
  --brand-dark:#d97706;
  --border:#e5e7eb;
  --shadow:0 10px 28px rgba(0,0,0,.06);
  --hot:#ef4444;
  --hot-dark:#dc2626;
  --pongan-surface:#fff7d6;
  --maogao-surface:#eef9f0;
  --ok:#16a34a;
  --warn:#f59e0b;
  --sold:#9ca3af;
}
*{box-sizing:border-box}
html{scroll-behavior:smooth;-webkit-text-size-adjust:100%}
body{margin:0;background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans TC","Helvetica Neue",Arial,sans-serif}
a{color:var(--brand-dark);text-decoration:none}
.wrap{max-width:1100px;margin:0 auto;padding:0 16px}

/* Hero */
.hero{position:relative;min-height:52vh;display:grid;place-items:center;color:#fff;background-size:cover;background-position:center}
@media(max-width:560px){.hero{min-height:44vh}}
.hero::after{content:"";position:absolute;inset:0;background:linear-gradient(180deg,rgba(0,0,0,.45),rgba(0,0,0,.38));z-index:0;pointer-events:none}
.hero-inner{position:relative;z-index:1;text-align:center;padding:56px 16px}
.logo{width:110px;height:110px;border-radius:18px;background:#fff9;padding:10px;backdrop-filter:blur(4px);display:inline-grid;place-items:center;margin-bottom:10px}
.logo img{max-width:100%;max-height:100%}
.hero h1{font-size:clamp(21px,4.8vw,36px);margin:4px 0 6px}
.hero p{font-size:clamp(12.5px,3.2vw,15px);opacity:.98;margin:0}

/* å°è† å›Š */
.pill{display:inline-block;background:#fff3;backdrop-filter:blur(4px);border:1px solid #fff7;color:#fff;border-radius:999px;padding:6px 10px;font-weight:700}

/* æŒ‰éˆ• */
.btn{display:inline-flex;align-items:center;gap:8px;border-radius:12px;padding:10px 14px;background:var(--brand);color:#111;font-weight:700;border:1px solid rgba(0,0,0,.05);box-shadow:0 10px 20px rgba(245,158,11,.25);cursor:pointer;font-size:clamp(12.5px,3vw,15px)}
.btn:hover{background:var(--brand-dark)}
.btn-ghost{background:#f9fafb;border:1px solid var(--border);color:var(--text);box-shadow:none}
.btn-ghost:hover{background:#f3f4f6}
.btn-red{background:var(--hot);color:#fff;border-color:#ef4444;box-shadow:0 10px 20px rgba(239,68,68,.25)}
.btn-red:hover{background:var(--hot-dark)}
.btn-block{width:100%;justify-content:center}
.btn-disabled{pointer-events:none;opacity:.6}

/* å€å¡Š */
.section{padding:34px 0}
.section h2{font-size:clamp(17px,3.8vw,25px);margin:0 0 10px}
.muted{color:var(--muted)}
.card{background:var(--surface);border:1px solid var(--border);border-radius:16px;box-shadow:var(--shadow)}
.grid{display:grid;gap:16px}
@media(min-width:900px){.grid-2{grid-template-columns:1fr 1fr}}
.content{padding:16px}
.content p{margin:0 0 10px;line-height:1.8;font-size:clamp(13.5px,3.2vw,15px)}
.content ul{margin:0;padding-left:1.2em;line-height:1.8}
.content li{margin:4px 0}
.note{font-size:12.5px;color:var(--muted)}

/* é¡åˆ¥å­å°èˆª */
.subnav{position:sticky;top:0;z-index:40;background:var(--surface);border-bottom:1px solid var(--border);box-shadow:0 6px 20px rgba(0,0,0,.04)}
.subnav .rail{display:flex;gap:8px;align-items:center;padding:10px 4px;overflow-x:auto;white-space:nowrap;-webkit-overflow-scrolling:touch;scroll-snap-type:x proximity}
.subnav .rail::-webkit-scrollbar{height:6px}
.subnav .rail::-webkit-scrollbar-thumb{background:#e6e6e6;border-radius:999px}
.chip{flex:0 0 auto;background:#fef3c7;border:1px solid #fde68a;color:#7c2d12;padding:8px 12px;border-radius:12px;font-weight:800;cursor:pointer;scroll-snap-align:center;font-size:clamp(12.5px,3vw,14px)}
.chip:hover{background:#fde68a}

/* æ©«å‘æ»‘å‹•å¡ç‰‡ */
.rail-cards{display:flex;gap:12px;overflow:auto;padding:10px 4px}
.rail-cards::-webkit-scrollbar{height:6px}
.rail-cards::-webkit-scrollbar-thumb{background:#e6e6e6;border-radius:999px}
.rail-cards .card{flex:0 0 auto;width:min(480px,92%)}
.spec-cards .card{width:min(360px,48%)}
@media(min-width:900px){.spec-cards .card{width:min(420px,32%)}}

/* ç”¢å“ç¶²æ ¼ */
.product-grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}
@media(min-width:960px){.product-grid{gap:14px}}
.product{display:flex;flex-direction:column}
.product .imgbox{position:relative}
.product img{width:100%;aspect-ratio:4/3;height:auto;object-fit:cover;border-radius:14px 14px 0 0}
.status-badge{position:absolute;left:10px;top:10px;border-radius:10px;padding:4px 8px;font-size:12px;font-weight:800;color:#111;background:#fde68a;border:1px solid #fcd34d}
.status-badge.soldout{background:#e5e7eb;border-color:#d1d5db;color:#374151}
.product .body{padding:10px 12px}
.title{margin:0;font-weight:700;font-size:clamp(12.5px,3.5vw,15px);line-height:1.35;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;min-height:2.4em}
.price{font-weight:800;font-size:clamp(14px,3.8vw,16px)}
.row-between{display:flex;align-items:center;justify-content:space-between}
.tag-hot{display:inline-block;background:var(--hot);color:#fff;border:1px solid #ef4444;border-radius:10px;padding:3px 7px;font-size:12px;font-weight:800}

/* ä¸»é¡Œåº•è‰² */
.theme-hot .content{background:#fee2e2;border-color:#fecaca}
.theme-pongan .content{background:var(--pongan-surface);border-color:#fde68a}
.theme-maogao .content{background:var(--maogao-surface);border-color:#bbf7d0}

/* æŠ½å±œé€šç”¨ */
.drawer{position:fixed;right:0;top:0;bottom:0;width:min(480px,96%);background:var(--surface);border-left:1px solid var(--border);transform:translateX(105%);transition:.28s;z-index:60;display:flex;flex-direction:column}
.drawer.open{transform:none}
.drawer header{padding:12px 14px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;gap:8px}
.drawer header .btns{display:flex;gap:8px}
.drawer main{padding:12px 14px;overflow:auto;flex:1}
.line{height:1px;background:var(--border);margin:10px 0}
.cart-row{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:8px 0}
.qty{display:flex;align-items:center;border:1px solid var(--border);border-radius:10px}
.qty button{width:30px;height:30px;border:0;background:#f3f4f6}
.qty span{display:inline-block;width:32px;text-align:center}
.summary{background:#f9fafb;border:1px dashed var(--border);border-radius:12px;padding:12px}
.badge{display:inline-block;background:#fff0d6;color:#7c2d12;border:1px solid #fed7aa;border-radius:10px;padding:4px 8px;font-size:12px;font-weight:700}
.warn{background:#fff1f2;border:1px solid #fecdd3;color:#7f1d1d}

/* è¡¨å–® */
.form .row{display:grid;gap:10px}
@media(min-width:720px){.form .row{grid-template-columns:1fr 1fr}}
.label{font-weight:700;margin:8px 0 6px}
.input, select, textarea{width:100%;padding:12px;border:1px solid var(--border);border-radius:10px;background:#fff;font-size:16px}
input, select, textarea{touch-action:manipulation}
.help{font-size:12px;color:#6b7280;margin-top:4px}

/* æµ®å‹•è³¼ç‰©è»Šï¼ˆæ©˜å­æ¨£å¼ï¼‰ */
.fab{position:fixed;right:16px;bottom:calc(16px + env(safe-area-inset-bottom));z-index:55;background:linear-gradient(145deg,#ffb84d,#ff9800);color:#111;border:1px solid rgba(0,0,0,.06);padding:12px 16px;border-radius:999px;box-shadow:0 10px 18px rgba(245,158,11,.35);display:flex;align-items:center;gap:8px;font-weight:800;cursor:pointer}
.fab .emoji{font-size:18px}
.fab-badge{display:inline-block;min-width:22px;height:22px;border-radius:999px;background:#111;color:#fff;font-size:12px;line-height:22px;text-align:center;padding:0 6px}

/* å·¦ä¸‹è§’ç®¡ç†éµ + é½’è¼ª */
.admin-btn{position:fixed;left:14px;bottom:calc(16px + env(safe-area-inset-bottom));z-index:56;background:#fff;border:1px solid var(--border);border-radius:999px;box-shadow:var(--shadow);padding:8px 10px;opacity:.5;cursor:pointer}
.admin-btn:hover{opacity:.9}
.gear{position:fixed;right:16px;bottom:calc(68px + env(safe-area-inset-bottom));z-index:55;background:#fff;border:1px solid var(--border);border-radius:999px;box-shadow:var(--shadow);padding:10px 12px;cursor:pointer}

/* Toastï¼ˆåŠ å…¥æˆåŠŸæç¤ºï¼‰ */
.toast{position:fixed;right:16px;top:16px;z-index:70;background:#fff;border:1px solid var(--border);box-shadow:var(--shadow);border-radius:12px;padding:10px 12px;display:none}
.toast.show{display:block;animation:fadeout 2.2s ease forwards}
@keyframes fadeout{0%{opacity:1;transform:translateY(0)}80%{opacity:1}100%{opacity:0;transform:translateY(-6px)}}

/* é–€å¸‚é¸æ“‡å™¨ï¼ˆä¸è·³ç«™ï¼‰ */
.modal{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;z-index:65}
.modal.open{display:block}
.modal .panel{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:min(920px,96%);max-height:84vh;overflow:auto;background:#fff;border-radius:16px;border:1px solid var(--border);box-shadow:var(--shadow);padding:14px}
.tabbar{display:flex;gap:8px;margin-bottom:10px}
.tabbar .tab{padding:8px 12px;border-radius:12px;border:1px solid var(--border);background:#f9fafb;cursor:pointer}
.tabbar .tab.active{background:#fffbeb;border-color:#fde68a}
.store-tools{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px}
.store-list{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:8px}
@media(max-width:700px){.store-list{grid-template-columns:1fr}}
.store-item{border:1px solid var(--border);border-radius:12px;padding:10px}
.store-item .row{display:flex;align-items:center;justify-content:space-between;gap:8px}
.store-item .sub{font-size:12.5px;color:#6b7280}

/* ç®¡ç†é¢æ¿ï¼šåˆ†å¡Š */
.admin-section{border:1px dashed var(--border);border-radius:12px;padding:12px;margin:10px 0}
.admin-section h4{margin:0 0 8px}
.admin-grid{display:grid;gap:8px}
@media(min-width:760px){.admin-grid.cols-2{grid-template-columns:1fr 1fr}}
.admin-actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}

/* footer */
footer{padding:34px 0 56px;color:#6b7280;text-align:center}
</style>
</head>

<body>
<!-- åŠ å…¥æˆåŠŸæç¤º -->
<div id="toast" class="toast">å·²åŠ å…¥è³¼ç‰©è»Š ğŸŠ</div>

<!-- è³¼ç‰©è»ŠæŠ½å±œ -->
<aside id="drawer" class="drawer" aria-hidden="true">
  <header>
    <strong>è³¼ç‰©è»Š</strong>
    <div class="btns">
      <button class="btn-ghost" onclick="clearCart()">æ¸…ç©ºè³¼ç‰©è»Š</button>
      <button class="btn" onclick="toggleDrawer(false)">é—œé–‰</button>
    </div>
  </header>
  <main>
    <div id="cartList"></div>
    <div class="line"></div>

    <!-- é…é€æ–¹å¼ -->
    <div class="summary" style="margin-bottom:10px">
      <div class="label">é…é€æ–¹å¼</div>
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <button id="shipHomeBtn" class="btn" type="button" onclick="setShipMethod('HOME')">å®…é…</button>
        <button id="shipCvsBtn" class="btn-ghost" type="button" onclick="setShipMethod('CVS')">è¶…å•†å–è²¨ï¼ˆå…é‹ï½œé™10æ–¤Ã—1ï¼‰</button>
        <button id="openStoreBtn" class="btn-ghost" type="button" onclick="openStorePicker()">é¸é–€å¸‚ï¼ˆä¸è·³ç«™ï¼‰</button>
      </div>
      <div class="help">è¶…å•†å–è²¨é™ã€Œå–®ä¸€ 10 å°æ–¤ Ã— 1 ç®±ã€ï¼Œä¸æ¥å—å¤–å³¶é…é€ã€‚</div>
    </div>

    <!-- é‹è²»èˆ‡ç¸½é¡ -->
    <div class="summary">
      <div class="row-between"><span>å•†å“å°è¨ˆ</span><strong id="subtotal">$0</strong></div>
      <div class="row-between"><span id="shipLabel">é‹è²»ï¼ˆå®…é…ï¼‰</span><strong id="shipping">$0</strong></div>
      <div class="line"></div>
      <div class="row-between" style="font-size:18px"><span>æ‡‰ä»˜é‡‘é¡</span><strong id="total">$0</strong></div>
      <div class="note" style="margin-top:8px">å®…é…æ»¿é¡ <b id="freeShipText">0</b> å…é‹ï¼›è¶…å•†å–è²¨ä¸€å¾‹å…é‹ã€‚</div>
    </div>

    <div class="line"></div>

    <!-- ä¸‹å–®è¡¨å–® -->
    <form id="orderForm" class="form" onsubmit="submitOrder(event)">
      <div class="row">
        <div>
          <div class="label">å§“å</div>
          <input class="input" name="name" placeholder="ä¾‹ï¼šé™³å°æ©˜" required>
        </div>
        <div>
          <div class="label">æ‰‹æ©Ÿ</div>
          <input class="input" name="phone" placeholder="ä¾‹ï¼š0912-345-678" required>
        </div>
      </div>
      <div class="row">
        <div>
          <div class="label">Emailï¼ˆå¯„é€å‡ºè²¨é€šçŸ¥ï¼‰</div>
          <input class="input" type="email" name="email" placeholder="ä¾‹ï¼šorange@example.com" required>
        </div>
        <div>
          <div class="label">ç‰©æµæ–¹å¼</div>
          <select name="ship" class="input" required>
            <option value="å®…é…">å®…é…</option>
            <option value="è¶…å•†å–è²¨">è¶…å•†å–è²¨ï¼ˆå…é‹ï½œé™10æ–¤Ã—1ï¼‰</option>
            <option value="è‡ªå–ï¼ˆå°ä¸­å¸‚çŸ³å²¡å€çŸ³å²¡è¡—61è™Ÿï¼‰">è‡ªå–ï¼ˆå°ä¸­å¸‚çŸ³å²¡å€çŸ³å²¡è¡—61è™Ÿï¼‰</option>
          </select>
          <div class="help">æ­¤æ¬„æœƒè·Ÿä¸Šæ–¹ã€Œé…é€æ–¹å¼ã€åŒæ­¥ã€‚</div>
        </div>
      </div>

      <!-- åœ°å€ï¼è¶…å•† -->
      <div id="homeFields">
        <div class="label">æ”¶ä»¶åœ°å€ï¼ˆå®…é…å°ˆç”¨ï¼‰</div>
        <input class="input" name="addr" placeholder="ä¾‹ï¼šå°ä¸­å¸‚â—‹â—‹å€â—‹â—‹è·¯ 123 è™Ÿ 5 æ¨“" required>
      </div>

      <div id="cvsFields" style="display:none">
        <div class="row">
          <div>
            <div class="label">è¶…å•†å“ç‰Œï¼ˆ7-11ï¼å…¨å®¶ï¼‰</div>
            <select class="input" name="cvsBrand" onchange="updateCvsLink()">
              <option value="7-11">7-11</option>
              <option value="å…¨å®¶">å…¨å®¶</option>
            </select>
            <div class="help">
              <a id="cvsFinderLink" href="https://emap.pcsc.com.tw/" target="_blank">é–‹å•Ÿ 7-11 é–€å¸‚æŸ¥è©¢ï¼ˆå¦é–‹ï¼‰</a>ã€€
              <button type="button" class="btn-ghost" onclick="pasteCvsFromClipboard()">è²¼ä¸Šå‰ªè²¼ç°¿</button>
            </div>
          </div>
          <div>
            <div class="label">é–€å¸‚åç¨± / åº—è™Ÿ</div>
            <input class="input" name="cvsStore" placeholder="ä¾‹ï¼šè±åŸæˆåŠŸé–€å¸‚ / 123456">
            <div class="help">ä¹Ÿå¯ç”¨ã€Œé¸é–€å¸‚ï¼ˆä¸è·³ç«™ï¼‰ã€ç›´æ¥æŒ‘é¸ã€‚</div>
          </div>
        </div>
      </div>

      <div>
        <div class="label">å‚™è¨»ï¼ˆåˆ°è²¨æ™‚æ®µç­‰ï¼‰</div>
        <textarea class="input" name="remark" rows="3" placeholder="ä¾‹ï¼šå¹³æ—¥ 18:00 å¾Œæ”¶ä»¶"></textarea>
      </div>

      <!-- æ¢æ¬¾ -->
      <div class="line"></div>
      <div class="label">ç‰©æµèˆ‡é€€è²¨èªªæ˜</div>
      <details id="policy" class="card content" style="max-height:220px;overflow:auto">
        <summary style="cursor:pointer"><b>è«‹å±•é–‹é–±è®€ï¼ˆéœ€æ²åˆ°æœ€åº•æ‰å¯å‹¾é¸åŒæ„ï¼‰</b></summary>
        <div class="content" style="padding-top:10px">
          <ul>
            <li>å…¥å¸³å¾Œ 1â€“3 å€‹å·¥ä½œå¤©å…§å‡ºè²¨ï¼ˆé€±æœ«èˆ‡ç¯€æ…¶é‡å¤§æ™‚é †å»¶ï¼‰ã€‚</li>
            <li>å®…é…ï¼šæ–°ç«¹è²¨é‹ï¼ˆå¸¸æº«ï¼‰ã€‚åˆ°è²¨è«‹ã€Œå…¨ç¨‹é–‹ç®±éŒ„å½±ã€ã€‚è‹¥æœ‰é‹æï¼Œ<b>24 å°æ™‚å…§æä¾›å½±ç‰‡èˆ‡ç…§ç‰‡</b>ï¼Œæˆ‘å€‘å”åŠ©å‘ç‰©æµç†è³ ã€‚</li>
            <li>è¶…å•†å–è²¨ï¼š<b>å…é‹</b>ï¼Œ<b>é™å–®ä¸€ 10 å°æ–¤ Ã— 1 ç®±</b>ï¼Œä¸”ç›®å‰<b>ä¸æ¥å—å¤–å³¶é…é€</b>ã€‚</li>
            <li>æ°´æœå±¬å¤©ç„¶è¾²ç”¢ï¼Œ<b>è¡¨çš®ç„¡æ³•å®Œç¾ç„¡ç‘•</b>å±¬æ­£å¸¸ç¾è±¡ï¼›å¤–è§€ã€ç”œåº¦æœƒå› æ°£å€™æ‰¹æ¬¡ç•¥æœ‰å·®ç•°ã€‚</li>
            <li>ç”Ÿé®®æ°´æœä¾æ³•ä¸é©ç”¨ 7 æ—¥çŒ¶è±«æœŸï¼›è‡ªç„¶æœæ–‘ã€ç³–ç“¤ã€ç”œåº¦è½å·®ä¸åˆ—ç‚ºé€€æ›ã€‚</li>
          </ul>
          <p class="note">è«‹ç¢ºèªä¸Šè¿°å…§å®¹ï¼Œæ²åˆ°åº•å³å¯å•Ÿç”¨åŒæ„å‹¾é¸ã€‚</p>
        </div>
      </details>
      <div style="margin:8px 0">
        <label for="agree">
          <input type="checkbox" id="agree" disabled> æˆ‘å·²è©³é–±<span style="text-decoration:underline">ä¸Šæ–¹</span>ã€Œç‰©æµèˆ‡é€€è²¨èªªæ˜ã€ä¸¦åŒæ„
        </label>
        <div class="help">ï¼ˆè‹¥æœªå•Ÿç”¨ï¼Œè«‹å…ˆå±•é–‹ä¸¦æ²åˆ°æœ€åº•ï¼‰</div>
      </div>

      <button id="submitBtn" class="btn btn-block" type="submit">é€å‡ºè¨‚å–®</button>
      <div id="result" class="note" style="margin-top:8px"></div>
    </form>
  </main>
</aside>

<!-- è¨‚å–®æŸ¥è©¢æŠ½å±œ -->
<aside id="queryDrawer" class="drawer" aria-hidden="true">
  <header>
    <strong>è¨‚å–®æŸ¥è©¢</strong>
    <div class="btns"><button class="btn" onclick="toggleQuery(false)">é—œé–‰</button></div>
  </header>
  <main>
    <form id="queryForm" onsubmit="queryOrder(event)" class="form">
      <div>
        <div class="label">è¨‚å–®ç·¨è™Ÿ</div>
        <input class="input" name="orderNo" placeholder="ä¾‹ï¼šK24-20251008-1234" required>
      </div>
      <button class="btn" type="submit" style="margin-top:8px">æŸ¥è©¢</button>
    </form>
    <div class="line"></div>
    <div id="queryCard" class="card content" style="display:none"></div>
    <div style="display:flex;gap:8px;margin-top:8px">
      <button id="dlPngBtn" class="btn-ghost" onclick="downloadQueryPNG()" style="display:none">ä¸€éµæˆªåœ–ï¼ˆPNGï¼‰</button>
      <button id="printBtn" class="btn-ghost" onclick="window.print()" style="display:none">åˆ—å° / å­˜ PDF</button>
    </div>
  </main>
</aside>

<!-- ç®¡ç†å“¡æŠ½å±œï¼ˆç™»å…¥ï¼‹ç®¡ç†é¢æ¿ï¼‰ -->
<aside id="adminDrawer" class="drawer" aria-hidden="true">
  <header>
    <strong>ç®¡ç†é¢æ¿</strong>
    <div class="btns">
      <button class="btn-ghost" onclick="logoutAdmin()">ç™»å‡º</button>
      <button class="btn" onclick="toggleAdmin(false)">é—œé–‰</button>
    </div>
  </header>
  <main id="adminBody" class="content">
    <!-- ç”± JS æ¸²æŸ“ -->
  </main>
</aside>

<!-- æµ®å‹•è³¼ç‰©è»Šï¼ˆæ©˜å­ï¼‰ -->
<button id="cartFab" class="fab" aria-label="é–‹å•Ÿè³¼ç‰©è»Š" onclick="toggleDrawer(true)">
  <span class="emoji">ğŸŠ</span> è³¼ç‰©è»Š <span id="fabCount" class="fab-badge">0</span>
</button>

<!-- ä¸èµ·çœ¼çš„ç®¡ç†å“¡æŒ‰éˆ• -->
<button class="admin-btn" onclick="toggleAdmin(true)" title="ç®¡ç†å“¡">ğŸ”’</button>

<!-- åº«å­˜ç·¨è¼¯é½’è¼ªï¼ˆæœªç™»å…¥æ™‚æœƒå¼•å°ç™»å…¥ï¼‰ -->
<button class="gear" onclick="toggleInvEdit()" title="åº«å­˜ï¼ç‹€æ…‹ç·¨è¼¯">âš™ï¸</button>

<!-- Hero -->
<section class="hero" id="hero">
  <div class="hero-inner wrap">
    <div class="logo"><img id="logoImg" src="" alt="æŸ‘å¿ƒæœåœ’ Logo"></div>
    <span id="heroPill" class="pill">è±åŸãƒ»æ±å‹¢ï½œåœ¨åœ°å‚³æ‰¿</span>
    <h1 id="heroTitle">æŸ‘å¿ƒæœåœ’ï½œç”¨å¿ƒç¨®æŸ‘ï¼Œèˆ‡ä½ æŸ‘å¿ƒç›¸ä¼´</h1>
    <p id="heroSubtitle">å…¬è€åªæ¤ªæŸ‘ï¼ˆ50å¹´ï¼‰èˆ‡æ±å‹¢èŒ‚è°·ï¼ˆ30å¹´ï¼‰ï¼Œç¾æ¡åˆ†ç´šç›´é€ã€‚10 / 25 å°æ–¤å¤šè¦æ ¼å¯é¸ï¼ŒåŒ¯æ¬¾å¾Œç«‹å³å®‰æ’å‡ºè²¨ï¼›åˆ°è²¨è«‹é–‹ç®±éŒ„å½±ï¼Œä¿éšœé‹æç†è³ ã€‚</p>
    <div style="margin-top:14px">
      <a id="shopNowBtn" class="btn" href="#hot" onclick="go(event,'hot')">é¦¬ä¸Šé¸è³¼</a>
    </div>
  </div>
</section>

<!-- åˆ†é¡éŒ¨é» -->
<nav class="subnav">
  <div class="wrap">
    <div class="rail">
      <button class="chip" onclick="go(event,'hot')">ğŸ”¥ ç†±éŠ·æ¬¾</button>
      <button class="chip" onclick="go(event,'pongan')">å…¬è€åªæ¤ªæŸ‘</button>
      <button class="chip" onclick="go(event,'maogao')">æ±å‹¢èŒ‚è°·</button>
      <button class="chip" onclick="toggleQuery(true)">è¨‚å–®æŸ¥è©¢</button>
    </div>
  </div>
</nav>

<!-- å“ç‰Œæ•…äº‹ + æœ€æ–°é®®å ± -->
<section class="section">
  <div class="wrap grid grid-2">
    <div class="card content">
      <h2 id="aboutTitle">é—œæ–¼ã€ŒæŸ‘å¿ƒæœåœ’ã€</h2>
      <div id="aboutBody">
        <p>æˆ‘å€‘ç›¸ä¿¡ï¼Œå¥½çš„æ°´æœï¼Œä¾†è‡ªé•·å¹´çš„å …æŒèˆ‡åœŸåœ°çš„å›æ‡‰ã€‚</p>
        <p><b>å…¬è€åªæ¤ªæŸ‘</b>æ‰¿è¼‰è‘—å®¶æ—åœ¨å±±é ‚çš„ <b>50 å¹´</b>è€•ä½œè¨˜æ†¶ï¼šæ—¥ç…§å……è¶³ã€æ—©æ™šæº«å·®å¤§ï¼Œè®“æœçš®è–„ã€æ±æ°´è¶³ã€é…¸ç”œå¹³è¡¡ã€‚</p>
        <p><b>æ±å‹¢èŒ‚è°·</b>å‰‡æ˜¯ä¸€è·¯ç›¸ä¼´çš„ <b>30 å¹´</b>è€å‹ï¼šé¦™æ°£æ¸…ç”œã€çº–ç¶­ç´°ç·»ã€å…¥å£åŒ–é–‹ã€‚</p>
        <p>å¾æ¡æ”¶ã€åˆ†ç´šåˆ°è£ç®±ï¼Œæˆ‘å€‘åšçš„æ¯ä¸€æ­¥åªæœ‰ä¸€å€‹ç›®çš„â€”â€”æŠŠæœ€å¥½åƒçš„æŸ‘æ©˜ï¼Œå®Œå¥½é€åˆ°ä½ æ‰‹ä¸Šã€‚<br><b>ç”¨å¿ƒç¨®æŸ‘ï¼Œèˆ‡ä½ æŸ‘å¿ƒç›¸ä¼´ã€‚</b></p>
      </div>
    </div>
    <div class="card content">
      <h2 id="newsTitle">æœ€æ–°é®®å ±ï½œæœåœ’æ—¥èªŒ</h2>
      <div class="rail-cards" id="newsRail"></div>
    </div>
  </div>
</section>

<!-- è¦æ ¼ç­‰ç´š -->
<section class="section">
  <div class="wrap">
    <div class="card content" style="padding-bottom:0">
      <h2 id="specTitle">å¦‚ä½•åˆ†è¾¨è¦æ ¼ç­‰ç´š</h2>
      <p id="specSubtitle" class="muted" style="margin-top:-6px">å¿«é€Ÿäº†è§£å„ç­‰ç´šå·®ç•°ï¼ŒæŒ‘å°æœ€åˆé©çš„å£æ„Ÿèˆ‡é¡†ç²’</p>
    </div>
    <div class="rail-cards spec-cards" id="specRail" style="padding:10px 14px"></div>
  </div>
</section>

<!-- ç†±éŠ· -->
<section id="hot" class="section theme-hot">
  <div class="wrap">
    <div class="card content" style="padding-bottom:0">
      <h2 id="hotTitle">ğŸ”¥ ç†±éŠ·æ¬¾</h2>
      <p id="hotSubtitle" class="muted" style="margin-top:-6px">å¤§å®¶æœ€å¸¸å›è³¼çš„ç†±é–€è¦æ ¼</p>
    </div>
    <div class="card" style="padding:0 14px 14px">
      <div id="hotGrid" class="product-grid"></div>
    </div>
  </div>
</section>

<!-- å…¬è€åªæ¤ªæŸ‘ -->
<section id="pongan" class="section theme-pongan">
  <div class="wrap">
    <div class="card content" style="padding-bottom:0">
      <h2 id="ponganTitle">å…¬è€åªæ¤ªæŸ‘ï¼ˆ50å¹´ï¼‰</h2>
      <p id="ponganSubtitle" class="muted" style="margin-top:-6px">ç¾æ¡åˆ†ç´šï½œçš®è–„å¤šæ±ï½œé…¸ç”œå¹³è¡¡</p>
    </div>
    <div class="card" style="padding:0 14px 14px">
      <div id="ponganGrid" class="product-grid"></div>
    </div>
  </div>
</section>

<!-- æ±å‹¢èŒ‚è°· -->
<section id="maogao" class="section theme-maogao">
  <div class="wrap">
    <div class="card content" style="padding-bottom:0">
      <h2 id="maogaoTitle">æ±å‹¢èŒ‚è°·ï¼ˆ30å¹´ï¼‰</h2>
      <p id="maogaoSubtitle" class="muted" style="margin-top:-6px">é¦™æ°£æ¸…ç”œï½œçº–ç¶­ç´°ç·»ï½œå…¥å£åŒ–é–‹</p>
    </div>
    <div class="card" style="padding:0 14px 14px">
      <div id="maogaoGrid" class="product-grid"></div>
    </div>
  </div>
</section>

<!-- åŒ¯æ¬¾è³‡è¨Š -->
<section class="section">
  <div class="wrap card content">
    <h2>åŒ¯æ¬¾è³‡è¨Š</h2>
    <p><strong id="bankName"></strong>ã€€æˆ¶åï¼š<strong id="bankHolder"></strong></p>
    <p>å¸³è™Ÿï¼š<strong id="bankNo"></strong></p>
    <p class="note">åŒ¯æ¬¾å®Œæˆå¾Œï¼Œæ­¡è¿åˆ°æˆ‘å€‘çš„
      <a href="https://www.facebook.com/profile.php?id=61581488901343" target="_blank">Facebook</a>
      ç§è¨Šã€Œè¨‚å–®ç·¨è™Ÿï¼‹åŒ¯æ¬¾å¾Œäº”ç¢¼ã€æˆ–ç›´æ¥å›è¦†ä¿¡ä»¶é€šçŸ¥ã€Œè¨‚å–®ç·¨è™Ÿï¼‹åŒ¯æ¬¾å¾Œäº”ç¢¼ã€ï¼Œæˆ‘å€‘å°‡ç«‹å³ç‚ºæ‚¨å®‰æ’å‡ºè²¨ã€‚
    </p>
  </div>
</section>

<footer>
  <div class="wrap">
    <div class="content" style="text-align:center;padding-top:0">
      <div class="muted">Â© æŸ‘å¿ƒæœåœ’ï½œå…¬è€åªæ¤ªæŸ‘ãƒ»æ±å‹¢èŒ‚è°·</div>
      <div class="muted">åœ°å€ï¼šå°ä¸­å¸‚çŸ³å²¡å€çŸ³å²¡è¡—61è™Ÿã€€|ã€€é€£çµ¡é›»è©±ï¼š0933-721-978</div>
    </div>
  </div>
</footer>

<!-- é–€å¸‚é¸æ“‡å™¨ï¼ˆä¸è·³ç«™ï¼‰ -->
<div id="storeModal" class="modal" aria-hidden="true">
  <div class="panel">
    <div class="row-between" style="gap:8px">
      <h3 style="margin:0">é¸æ“‡é–€å¸‚ï¼ˆä¸è·³ç«™ï¼‰</h3>
      <button class="btn-ghost" onclick="closeStorePicker()">é—œé–‰</button>
    </div>
    <div class="tabbar" role="tablist">
      <button id="tab711" class="tab active" onclick="switchStoreTab('7-11')">7-11</button>
      <button id="tabFam" class="tab" onclick="switchStoreTab('å…¨å®¶')">å…¨å®¶</button>
    </div>
    <div class="store-tools">
      <input id="storeSearch" class="input" placeholder="æœå°‹ï¼šè¼¸å…¥é—œéµå­—ï¼ˆåº—å / åœ°å€ / åº—è™Ÿï¼‰" oninput="filterStores()">
      <div style="flex:1"></div>
      <button class="btn-ghost" onclick="reloadBuiltinStores()">æ¢å¾©ç¯„ä¾‹é–€å¸‚</button>
    </div>
    <div id="storeList" class="store-list"></div>
    <div class="note" style="margin-top:8px">å°æé†’ï¼šé–€å¸‚è³‡æ–™ç”±ã€Œç®¡ç†é¢æ¿ â†’ é–€å¸‚æ¸…å–®ã€ç¶­è­·ï¼Œäº¦å¯é»ã€Œæ¢å¾©ç¯„ä¾‹é–€å¸‚ã€ã€‚</div>
  </div>
</div>

<!-- ä¸€éµæˆªåœ–ç”¨ï¼ˆä¸å½±éŸ¿é é¢ï¼ŒCDN å¯æ›ä¾†æºï¼‰ -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

/** =========================================================
 *  æŸ‘å¿ƒæœåœ’ï¼šç¶²ç«™é‚è¼¯ï¼ˆå®Œæ•´æ–°ç‰ˆï¼‰
 *  - ä¸ç”¨ GitHub Tokenï¼Œæ”¹ã€ŒRAW URL è½‰æ›å™¨ã€
 *  - å…§å»ºé–€å¸‚é¸æ“‡å™¨ï¼ˆä¸è·³ç«™ï¼‰ã€è‡ªè¨‚é–€å¸‚æ¸…å–®
 *  - å…¨ç«™å¡ç‰‡/æ–‡å­—/æŒ‰éˆ•å¯ç”±ç®¡ç†é¢æ¿æ”¹ï¼Œéœ€æŒ‰ã€Œå„²å­˜ä¿®æ”¹ã€
 *  - ç”¢å“æ–°å¢ç‹€æ…‹ï¼šæ­£å¸¸ / é–‹æ”¾é è³¼ / å·²å”®å®Œï¼ˆåœ–ä¸Šè²¼ç´™ + æŒ‰éˆ•ç‹€æ…‹ï¼‰
 *  - è³¼è²·ä¸å†è‡ªå‹•æ‰“é–‹è³¼ç‰©è»Šï¼Œæ”¹å³ä¸Šè§’ Toast æç¤º
 *  - æ‰€æœ‰èªªæ˜éƒ½åœ¨è¨»è§£è£¡ï¼Œç…§æ­¥é©Ÿæ”¹å°±æœƒæˆåŠŸ
 *  ========================================================= */

/* =========================
 * A. åŸºç¤å·¥å…·
 * ========================= */

// 1) raw.github è½‰æ›ï¼ˆè‹¥å‚³å…¥ä¸€èˆ¬ GitHub ç¶²å€ï¼Œè‡ªå‹•è®Š rawï¼‰
function toRaw(u){
  if (!u) return u;
  // å·²æ˜¯ raw ç›´æ¥å›å‚³
  if (u.includes('raw.githubusercontent.com')) return u;

  // å¸¸è¦‹å¹¾ç¨®å½¢å¼å…¨è½‰ rawï¼ˆåŒ…å« query åƒæ•¸å»é™¤ï¼‰
  try{
    // ç§»é™¤ä»»ä½• ?xxx åƒæ•¸
    const pure = u.split('?')[0];
    // 1) https://github.com/user/repo/blob/branch/path/to/file.jpg
    if (pure.includes('github.com') && pure.includes('/blob/')) {
      return pure
        .replace('https://github.com/', 'https://raw.githubusercontent.com/')
        .replace('/blob/', '/');
    }
    // 2) https://github.com/user/repo/raw/branch/path/to/file.jpg
    if (pure.includes('github.com') && pure.includes('/raw/')) {
      return pure
        .replace('https://github.com/', 'https://raw.githubusercontent.com/')
        .replace('/raw/', '/');
    }
    // 3) è‹¥æ˜¯ GitHub Releases æˆ– Gist ç­‰ï¼Œå˜—è©¦ç›´æ¥ç”¨
    return pure;
  }catch{
    return u;
  }
}

// 2) é‡‘é¡æ–‡å­—
const currency = n => "NT$ " + (n||0).toLocaleString();

// 3) Toast æç¤ºï¼ˆåŠ å…¥è³¼ç‰©è»ŠæˆåŠŸï¼‰
function showToast(msg='å·²åŠ å…¥è³¼ç‰©è»Š ğŸŠ'){
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(()=> t.classList.remove('show'), 2200);
}

// 4) å¹³æ»‘æ²å‹•
function go(e,id){
  if(e) e.preventDefault();
  const el = document.getElementById(id);
  if(!el) return;
  const navH = document.querySelector('.subnav')?.offsetHeight || 0;
  const y = el.getBoundingClientRect().top + window.scrollY - navH - 6;
  window.scrollTo({top:y,behavior:'smooth'});
}

/* =========================
 * B. é è¨­è¨­å®šï¼ˆå¯åœ¨ç®¡ç†é¢æ¿æ”¹ï¼Œæœƒå¯«é€² LocalStorageï¼‰
 * ========================= */

const LS = {
  cart: 'gx_cart_v2',
  shipMethod: 'gx_ship_method_v2',
  form: 'gx_form_v2',
  overrides: 'gx_overrides_v2',
  inventory: 'gx_inventory_v2',
  stores: 'gx_stores_v2'
};

// é è¨­å•†å“èˆ‡åƒ¹æ ¼ï¼ˆå¯æ”¹ï¼‰ï¼Œæ³¨æ„ï¼šã€Œåƒ¹æ ¼ã€èˆ‡ã€Œåœ–ç‰‡ã€æœ€å¾Œæœƒç”± overrides è¦†è“‹
const CONFIG = {
  SHIPPING: 160,
  FREE_SHIP_THRESHOLD: 1800,
  BANK: { name: "é€£ç·šéŠ€è¡Œ(824)", holder: "å¼µéˆæ³“", no: "11101-37823-13" },
  BRAND_TAG: "æŸ‘å¿ƒæœåœ’",
  // Hero èˆ‡æ¨™é¡Œï¼ˆç™»å…¥å¾Œå¯ç›´æ¥æ”¹ï¼‰
  TEXTS: {
    hero: {
      bg: toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/%E5%B0%81%E9%9D%A2%E5%9C%96.png"),
      logo: toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/%E6%9F%91%E5%BF%83%E6%9E%9C%E5%9C%92LOGO.png"),
      pill: "è±åŸãƒ»æ±å‹¢ï½œåœ¨åœ°å‚³æ‰¿",
      title: "æŸ‘å¿ƒæœåœ’ï½œç”¨å¿ƒç¨®æŸ‘ï¼Œèˆ‡ä½ æŸ‘å¿ƒç›¸ä¼´",
      subtitle: "å…¬è€åªæ¤ªæŸ‘ï¼ˆ50å¹´ï¼‰èˆ‡æ±å‹¢èŒ‚è°·ï¼ˆ30å¹´ï¼‰ï¼Œç¾æ¡åˆ†ç´šç›´é€ã€‚10 / 25 å°æ–¤å¤šè¦æ ¼å¯é¸ï¼ŒåŒ¯æ¬¾å¾Œç«‹å³å®‰æ’å‡ºè²¨ï¼›åˆ°è²¨è«‹é–‹ç®±éŒ„å½±ï¼Œä¿éšœé‹æç†è³ ã€‚",
      ctaText: "é¦¬ä¸Šé¸è³¼",
      ctaLink: "#hot"
    },
    sections: {
      hot: { title: "ğŸ”¥ ç†±éŠ·æ¬¾", subtitle: "å¤§å®¶æœ€å¸¸å›è³¼çš„ç†±é–€è¦æ ¼" },
      pongan: { title: "å…¬è€åªæ¤ªæŸ‘ï¼ˆ50å¹´ï¼‰", subtitle: "ç¾æ¡åˆ†ç´šï½œçš®è–„å¤šæ±ï½œé…¸ç”œå¹³è¡¡" },
      maogao: { title: "æ±å‹¢èŒ‚è°·ï¼ˆ30å¹´ï¼‰", subtitle: "é¦™æ°£æ¸…ç”œï½œçº–ç¶­ç´°ç·»ï½œå…¥å£åŒ–é–‹" },
      about: {
        title: "é—œæ–¼ã€ŒæŸ‘å¿ƒæœåœ’ã€",
        body: [
          "æˆ‘å€‘ç›¸ä¿¡ï¼Œå¥½çš„æ°´æœï¼Œä¾†è‡ªé•·å¹´çš„å …æŒèˆ‡åœŸåœ°çš„å›æ‡‰ã€‚",
          "<b>å…¬è€åªæ¤ªæŸ‘</b>æ‰¿è¼‰è‘—å®¶æ—åœ¨å±±é ‚çš„ <b>50 å¹´</b>è€•ä½œè¨˜æ†¶ï¼šæ—¥ç…§å……è¶³ã€æ—©æ™šæº«å·®å¤§ï¼Œè®“æœçš®è–„ã€æ±æ°´è¶³ã€é…¸ç”œå¹³è¡¡ã€‚",
          "<b>æ±å‹¢èŒ‚è°·</b>å‰‡æ˜¯ä¸€è·¯ç›¸ä¼´çš„ <b>30 å¹´</b>è€å‹ï¼šé¦™æ°£æ¸…ç”œã€çº–ç¶­ç´°ç·»ã€å…¥å£åŒ–é–‹ã€‚",
          "å¾æ¡æ”¶ã€åˆ†ç´šåˆ°è£ç®±ï¼Œæˆ‘å€‘åšçš„æ¯ä¸€æ­¥åªæœ‰ä¸€å€‹ç›®çš„â€”â€”æŠŠæœ€å¥½åƒçš„æŸ‘æ©˜ï¼Œå®Œå¥½é€åˆ°ä½ æ‰‹ä¸Šã€‚<br><b>ç”¨å¿ƒç¨®æŸ‘ï¼Œèˆ‡ä½ æŸ‘å¿ƒç›¸ä¼´ã€‚</b>"
        ]
      },
      news: { title: "æœ€æ–°é®®å ±ï½œæœåœ’æ—¥èªŒ" },
      spec: { title: "å¦‚ä½•åˆ†è¾¨è¦æ ¼ç­‰ç´š", subtitle: "å¿«é€Ÿäº†è§£å„ç­‰ç´šå·®ç•°ï¼ŒæŒ‘å°æœ€åˆé©çš„å£æ„Ÿèˆ‡é¡†ç²’" }
    }
  },
  // è¦æ ¼åœ–ã€æ–°èï¼ˆå¯åœ¨ç®¡ç†é¢æ¿æ”¹ï¼‰
  SPEC_GALLERY: [
    toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/%E7%AD%89%E7%B4%9A%E6%AF%94%E8%BC%83%E5%9C%96.jpg")
  ],
  NEWS: [
    { type:"video", src: toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/780323577.063367.mp4"), title:"æ¡æ”¶èŠ±çµ®" },
    { type:"image", src:"https://via.placeholder.com/1200x800?text=%E6%9C%80%E6%96%B0%E7%9F%AD%E5%BD%B1", title:"å±±é ‚æ™šéœ" }
  ],
  // åƒ¹æ ¼è¡¨ï¼ˆå¯åœ¨ç®¡ç†é¢æ¿æ”¹ï¼‰
  PRICES: {
    PONGAN: { "10å°æ–¤": { "23A": 750, "25A": 780, "27A": 820, "30A": 880 },
              "25å°æ–¤": { "23A":1600, "25A":1680, "27A":1780, "30A":1880 } },
    MAOGAO: { "10å°æ–¤": { "23A": 720, "25A": 760, "27A": 800, "30A": 860 },
              "25å°æ–¤": { "23A":1500, "25A":1580, "27A":1680, "30A":1780 } }
  },
  // å•†å“åœ–ï¼ˆå¯åœ¨ç®¡ç†é¢æ¿æ”¹ï¼‰
  IMAGES: {
    PONGAN: {
      "10å°æ–¤-23A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/10%E6%96%A4%E5%A4%A7%E5%90%89%E5%A4%A7%E5%88%A93.jpg"),
      "10å°æ–¤-25A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/10%E6%96%A4%E5%A4%A7%E5%90%89%E5%A4%A7%E5%88%A93.jpg"),
      "10å°æ–¤-27A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/10%E6%96%A4%E5%A4%A7%E5%90%89%E5%A4%A7%E5%88%A93.jpg"),
      "10å°æ–¤-30A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/10%E6%96%A4%E5%A4%A7%E5%90%89%E5%A4%A7%E5%88%A93.jpg"),
      "25å°æ–¤-23A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/25%E6%96%A4%E6%A9%98%E5%AD%90.jpg"),
      "25å°æ–¤-25A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/25%E6%96%A4%E6%A9%98%E5%AD%90.jpg"),
      "25å°æ–¤-27A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/25%E6%96%A4%E6%A9%98%E5%AD%90.jpg"),
      "25å°æ–¤-30A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/25%E6%96%A4%E6%A9%98%E5%AD%90.jpg")
    },
    MAOGAO: {
      "10å°æ–¤-23A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/10%E6%96%A4%E5%A4%A7%E5%90%89%E5%A4%A7%E5%88%A93.jpg"),
      "10å°æ–¤-25A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/10%E6%96%A4%E5%A4%A7%E5%90%89%E5%A4%A7%E5%88%A93.jpg"),
      "10å°æ–¤-27A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/10%E6%96%A4%E5%A4%A7%E5%90%89%E5%A4%A7%E5%88%A93.jpg"),
      "10å°æ–¤-30A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/10%E6%96%A4%E5%A4%A7%E5%90%89%E5%A4%A7%E5%88%A93.jpg"),
      "25å°æ–¤-23A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/25%E6%96%A4%E6%A9%98%E5%AD%90.jpg"),
      "25å°æ–¤-25A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/25%E6%96%A4%E6%A9%98%E5%AD%90.jpg"),
      "25å°æ–¤-27A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/25%E6%96%A4%E6%A9%98%E5%AD%90.jpg"),
      "25å°æ–¤-30A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/25%E6%96%A4%E6%A9%98%E5%AD%90.jpg")
    }
  },
  // åº«å­˜ï¼ˆå”®å‡º/å‰©é¤˜ï¼‰å…ˆçµ¦é«˜å€¼ï¼Œå¯¦å‹™è«‹æ‰‹å‹•æ”¹
  INVENTORY: {
    "PON10-23A":{sold:0, stock:999, status:"normal"},
    "PON10-25A":{sold:0, stock:999, status:"normal"},
    "PON10-27A":{sold:0, stock:999, status:"normal"},
    "PON10-30A":{sold:0, stock:999, status:"normal"},
    "PON25-23A":{sold:0, stock:999, status:"normal"},
    "PON25-25A":{sold:0, stock:999, status:"normal"},
    "PON25-27A":{sold:0, stock:999, status:"normal"},
    "PON25-30A":{sold:0, stock:999, status:"normal"},
    "MAO10-23A":{sold:0, stock:999, status:"normal"},
    "MAO10-25A":{sold:0, stock:999, status:"normal"},
    "MAO10-27A":{sold:0, stock:999, status:"normal"},
    "MAO10-30A":{sold:0, stock:999, status:"normal"},
    "MAO25-23A":{sold:0, stock:999, status:"normal"},
    "MAO25-25A":{sold:0, stock:999, status:"normal"},
    "MAO25-27A":{sold:0, stock:999, status:"normal"},
    "MAO25-30A":{sold:0, stock:999, status:"normal"}
  }
};

// ç”¢å“æ¸…å–®ï¼ˆID å°æ‡‰ INVENTORY key èˆ‡åœ–ç‰‡/åƒ¹æ ¼éµï¼‰
const PONGAN = [
  { id:"PON10-23A", section:"PONGAN", title:"æ¤ªæŸ‘ï½œ10å°æ–¤ï½œ23A", weight:"10å°æ–¤", size:"23A" },
  { id:"PON10-25A", section:"PONGAN", title:"æ¤ªæŸ‘ï½œ10å°æ–¤ï½œ25A", weight:"10å°æ–¤", size:"25A" },
  { id:"PON10-27A", section:"PONGAN", title:"æ¤ªæŸ‘ï½œ10å°æ–¤ï½œ27A", weight:"10å°æ–¤", size:"27A" },
  { id:"PON10-30A", section:"PONGAN", title:"æ¤ªæŸ‘ï½œ10å°æ–¤ï½œ30A", weight:"10å°æ–¤", size:"30A" },
  { id:"PON25-23A", section:"PONGAN", title:"æ¤ªæŸ‘ï½œ25å°æ–¤ï½œ23A", weight:"25å°æ–¤", size:"23A" },
  { id:"PON25-25A", section:"PONGAN", title:"æ¤ªæŸ‘ï½œ25å°æ–¤ï½œ25A", weight:"25å°æ–¤", size:"25A" },
  { id:"PON25-27A", section:"PONGAN", title:"æ¤ªæŸ‘ï½œ25å°æ–¤ï½œ27A", weight:"25å°æ–¤", size:"27A" },
  { id:"PON25-30A", section:"PONGAN", title:"æ¤ªæŸ‘ï½œ25å°æ–¤ï½œ30A", weight:"25å°æ–¤", size:"30A" }
];
const MAOGAO = [
  { id:"MAO10-23A", section:"MAOGAO", title:"èŒ‚è°·ï½œ10å°æ–¤ï½œ23A", weight:"10å°æ–¤", size:"23A" },
  { id:"MAO10-25A", section:"MAOGAO", title:"èŒ‚è°·ï½œ10å°æ–¤ï½œ25A", weight:"10å°æ–¤", size:"25A" },
  { id:"MAO10-27A", section:"MAOGAO", title:"èŒ‚è°·ï½œ10å°æ–¤ï½œ27A", weight:"10å°æ–¤", size:"27A" },
  { id:"MAO10-30A", section:"MAOGAO", title:"èŒ‚è°·ï½œ10å°æ–¤ï½œ30A", weight:"10å°æ–¤", size:"30A" },
  { id:"MAO25-23A", section:"MAOGAO", title:"èŒ‚è°·ï½œ25å°æ–¤ï½œ23A", weight:"25å°æ–¤", size:"23A" },
  { id:"MAO25-25A", section:"MAOGAO", title:"èŒ‚è°·ï½œ25å°æ–¤ï½œ25A", weight:"25å°æ–¤", size:"25A" },
  { id:"MAO25-27A", section:"MAOGAO", title:"èŒ‚è°·ï½œ25å°æ–¤ï½œ27A", weight:"25å°æ–¤", size:"27A" },
  { id:"MAO25-30A", section:"MAOGAO", title:"èŒ‚è°·ï½œ25å°æ–¤ï½œ30A", weight:"25å°æ–¤", size:"30A" }
];

// ç†±éŠ·æ¸…å–®ï¼ˆé è¨­å–æ¯å€ 25Aï¼Œå¯è‡ªè¡Œèª¿æ•´è¦å‰‡ï¼‰
const HOT = [...PONGAN, ...MAOGAO].filter(p=>p.size==='25A');

/* =========================
 * C. LocalStorage è¼‰å…¥/å„²å­˜
 * ========================= */

function loadJSON(key, fallback){
  try{
    const s = localStorage.getItem(key);
    return s? JSON.parse(s) : (fallback ?? null);
  }catch{ return fallback ?? null; }
}
function saveJSON(key, obj){
  localStorage.setItem(key, JSON.stringify(obj));
}

// è¦†å¯«åŒ…ï¼šä¿å­˜æ‰€æœ‰ç®¡ç†æ”¹å‹•
function loadOverrides(){
  return loadJSON(LS.overrides, {
    TEXTS: CONFIG.TEXTS,
    PRICES: CONFIG.PRICES,
    IMAGES: CONFIG.IMAGES,
    SPEC_GALLERY: CONFIG.SPEC_GALLERY,
    NEWS: CONFIG.NEWS
  });
}
function saveOverrides(data){
  saveJSON(LS.overrides, data);
}

// åº«å­˜/ç‹€æ…‹
let INV = loadJSON(LS.inventory, CONFIG.INVENTORY);
function saveInventory(){ saveJSON(LS.inventory, INV); }

// è³¼ç‰©è»Š
const cart = loadJSON(LS.cart, []);
function saveCart(){ saveJSON(LS.cart, cart); }

/* =========================
 * D. å–åƒ¹/å–åœ–ã€å•†å“ç‹€æ…‹
 * ========================= */

function priceOf(section, weight, size){
  const O = loadOverrides();
  return O.PRICES?.[section]?.[weight]?.[size] ?? 0;
}
function imgFor(section, weight, size){
  const O = loadOverrides();
  return O.IMAGES?.[section]?.[`${weight}-${size}`] || 'https://via.placeholder.com/800x600?text=Image';
}

// å•†å“ç‹€æ…‹æ–‡å­—èˆ‡é¡¯ç¤º
// status: normal / preorder / soldout
function renderStatusBadge(status){
  if(status === 'preorder') return '<span class="status-badge">é–‹æ”¾é è³¼</span>';
  if(status === 'soldout') return '<span class="status-badge soldout">å·²å”®å®Œ</span>';
  return '';
}

/* =========================
 * E. æ¸²æŸ“å€ï¼šç”¢å“å¡ã€æ»‘å‹•ç‰†ã€æ–‡å­—
 * ========================= */

function productCard(p){
  const price = priceOf(p.section, p.weight, p.size);
  const img = imgFor(p.section, p.weight, p.size);
  const inv = INV[p.id] || {sold:0, stock:0, status:'normal'};
  const isHot = p.size === '25A';
  const disableBuy = inv.status === 'soldout';
  const preorder = inv.status === 'preorder';

  return `
  <article class="product card">
    <div class="imgbox">
      <img src="${img}" alt="${p.title}">
      ${renderStatusBadge(inv.status)}
    </div>
    <div class="body">
      <div class="row-between" style="gap:8px">
        <h3 class="title" ${ADMIN.logged() ? `contenteditable="true" onblur="editTitle('${p.id}', this.textContent.trim())"`:''}>${p.title}</h3>
        ${isHot ? '<span class="tag-hot" aria-label="ç†±éŠ·">ğŸ”¥ ç†±éŠ·</span>' : ''}
      </div>
      <div class="note" style="margin-top:6px">
        å·²å”®å‡º ${inv.sold}ã€€å‰©é¤˜ ${inv.stock} ç®±
      </div>

      <div class="price" style="margin:6px 0 10px">
        ${ADMIN.logged()
          ? `<input type="number" value="${price}" style="width:120px" onblur="setPrice('${p.section}','${p.weight}','${p.size}', this.value)">`
          : `${currency(price)}`
        }
      </div>

      ${ADMIN.logged()
        ? `<div class="note" style="display:flex;gap:6px;align-items:center;flex-wrap:wrap;margin:6px 0 10px">
             <span>åœ–ç‰‡ç¶²å€</span>
             <input type="url" value="${img}" style="flex:1;min-width:140px" onblur="setImage('${p.section}','${p.weight}','${p.size}', this.value)">
           </div>`
        : ''
      }

      <button class="btn btn-block ${disableBuy?'btn-disabled':''}" ${disableBuy?'disabled':''}
        onclick="addToCart('${p.id}')">${preorder?'é è³¼åŠ å…¥':'è³¼è²·'}</button>

      ${invEditMode && ADMIN.logged() ? `
      <div class="note" style="margin-top:8px;display:flex;gap:6px;align-items:center;flex-wrap:wrap">
        <span>å·²å”®å‡º</span><input type="number" min="0" value="${inv.sold}" style="width:80px" onchange="editInv('${p.id}','sold',this.value)">
        <span>å‰©é¤˜</span><input type="number" min="0" value="${inv.stock}" style="width:80px" onchange="editInv('${p.id}','stock',this.value)">
        <span>ç‹€æ…‹</span>
        <label><input type="radio" name="status-${p.id}" value="normal" ${inv.status==='normal'?'checked':''} onchange="setStatus('${p.id}',this.value)"> æ­£å¸¸</label>
        <label><input type="radio" name="status-${p.id}" value="preorder" ${inv.status==='preorder'?'checked':''} onchange="setStatus('${p.id}',this.value)"> é–‹æ”¾é è³¼</label>
        <label><input type="radio" name="status-${p.id}" value="soldout" ${inv.status==='soldout'?'checked':''} onchange="setStatus('${p.id}',this.value)"> å·²å”®å®Œ</label>
      </div>` : ''}

    </div>
  </article>`;
}

function editTitle(id, val){
  const O = loadOverrides();
  // æŠŠå°æ‡‰ç”¢å“æ‰¾åˆ°ä¸¦æ”¹ title
  const all = [...PONGAN, ...MAOGAO];
  const item = all.find(x=>x.id===id);
  if(item){
    item.title = val || item.title;
    // å¦å­˜ä¸€ä»½ titles: ç›´æ¥è¦†å¯«ç¾æœ‰é™£åˆ—å…§ titleï¼ˆå› ç‚ºæ¸²æŸ“ç”¨è©²é™£åˆ—ï¼‰
    saveOverrides(O); // æœ¬è¡Œç¢ºä¿å…¶ä»–æ”¹å‹•ä¹Ÿè¢«ä¿ç•™
    renderAllGrids();
  }
}
function setStatus(id, status){
  if(!INV[id]) INV[id] = {sold:0, stock:0, status:'normal'};
  INV[id].status = status;
  saveInventory();
  renderAllGrids();
}
function setPrice(section,weight,size,val){
  const O = loadOverrides();
  if(!O.PRICES[section]) O.PRICES[section]={};
  if(!O.PRICES[section][weight]) O.PRICES[section][weight]={};
  O.PRICES[section][weight][size] = Math.max(0, parseInt(val||0));
  saveOverrides(O);
}
function setImage(section,weight,size,url){
  const O = loadOverrides();
  if(!O.IMAGES[section]) O.IMAGES[section]={};
  O.IMAGES[section][`${weight}-${size}`] = toRaw((url||'').trim());
  saveOverrides(O);
  renderAllGrids();
}

function renderGrid(elId, items){
  const el = document.getElementById(elId);
  el.innerHTML = items.map(productCard).join('');
}
function renderAllGrids(){
  renderGrid('hotGrid', HOT);
  renderGrid('ponganGrid', PONGAN);
  renderGrid('maogaoGrid', MAOGAO);
}

function renderSpecRail(){
  const rail = document.getElementById('specRail');
  const O = loadOverrides();
  rail.innerHTML = (O.SPEC_GALLERY||[]).map(src=>
    `<div class="card">
      <img src="${src}" alt="è¦æ ¼ç­‰ç´šèªªæ˜" style="width:100%;height:auto;display:block;border-radius:16px">
    </div>`
  ).join('');
}
function renderNewsRail(){
  const rail = document.getElementById('newsRail');
  const O = loadOverrides();
  rail.innerHTML = (O.NEWS||[]).map(item=>{
    if(item.type==='video'){
      return `<div class="card" style="overflow:hidden">
        <video src="${item.src}" controls style="width:100%;height:100%;display:block"></video>
        <div class="content" style="padding:10px">${item.title||''}</div>
      </div>`;
    }else{
      return `<div class="card">
        <img src="${item.src}" alt="${item.title||''}" style="width:100%;height:auto;display:block;border-radius:16px 16px 0 0">
        <div class="content" style="padding:10px">${item.title||''}</div>
      </div>`;
    }
  }).join('');
}

function renderTexts(){
  const O = loadOverrides();
  const T = O.TEXTS;
  // Hero
  document.getElementById('hero').style.backgroundImage = `url('${toRaw(T.hero.bg)}')`;
  document.getElementById('logoImg').src = toRaw(T.hero.logo);
  document.getElementById('heroPill').textContent = T.hero.pill;
  document.getElementById('heroTitle').textContent = T.hero.title;
  document.getElementById('heroSubtitle').textContent = T.hero.subtitle;
  const cta = document.getElementById('shopNowBtn');
  cta.textContent = T.hero.ctaText;
  cta.setAttribute('href', T.hero.ctaLink || '#hot');

  // Section æ¨™é¡Œ
  document.getElementById('hotTitle').textContent = T.sections.hot.title;
  document.getElementById('hotSubtitle').textContent = T.sections.hot.subtitle;
  document.getElementById('ponganTitle').textContent = T.sections.pongan.title;
  document.getElementById('ponganSubtitle').textContent = T.sections.pongan.subtitle;
  document.getElementById('maogaoTitle').textContent = T.sections.maogao.title;
  document.getElementById('maogaoSubtitle').textContent = T.sections.maogao.subtitle;
  document.getElementById('specTitle').textContent = T.sections.spec.title;
  document.getElementById('specSubtitle').textContent = T.sections.spec.subtitle;
  document.getElementById('newsTitle').textContent = T.sections.news.title;
  document.getElementById('aboutTitle').textContent = T.sections.about.title;
  // about å¤šè¡Œ
  const aboutBody = document.getElementById('aboutBody');
  aboutBody.innerHTML = T.sections.about.body.map(line=>`<p>${line}</p>`).join('');
}

/* =========================
 * F. è³¼ç‰©è»Š + è¨‚å–®æµç¨‹ï¼ˆè²·æŒ‰éˆ•ä¸è‡ªå‹•å½ˆè³¼ç‰©è»Šï¼‰
 * ========================= */

function getShipMethod(){ return localStorage.getItem(LS.shipMethod) || 'HOME'; }
function setShipMethod(m){
  if(m==='CVS'){
    const ok = cart.length===1 && cart[0].weight==='10å°æ–¤' && cart[0].qty===1;
    if(!ok){
      alert('è¶…å•†å–è²¨é™ã€Œå–®ä¸€ 10 å°æ–¤ Ã— 1 ç®±ã€ã€‚è«‹èª¿æ•´è³¼ç‰©è»Šæ•¸é‡å¾Œå†é¸æ“‡ã€‚');
      m = 'HOME';
    }
  }
  localStorage.setItem(LS.shipMethod, m);
  // åˆ‡æ›æŒ‰éˆ•æ¨£å¼
  document.getElementById('shipHomeBtn').className = (m==='HOME') ? 'btn' : 'btn-ghost';
  document.getElementById('shipCvsBtn').className = (m==='CVS') ? 'btn' : 'btn-ghost';
  renderCart();
}

function calc(){
  const method = getShipMethod();
  const subtotal = cart.reduce((s,i)=>s+i.price*i.qty,0);
  let shipping = 0;
  if(method==='CVS') shipping = 0;
  else shipping = (subtotal>=CONFIG.FREE_SHIP_THRESHOLD || cart.length===0) ? 0 : CONFIG.SHIPPING;
  return {subtotal, shipping, total: subtotal+shipping};
}

function renderCart(){
  const list = document.getElementById('cartList');
  if(!cart.length){
    list.innerHTML = `<div class="muted">è³¼ç‰©è»Šæ˜¯ç©ºçš„ï¼Œå»æŒ‘å¹¾é¡†æœ€é ‚çš„æ©˜å­å§ ğŸŠ</div>`;
  }else{
    list.innerHTML = cart.map((c,i)=>`
      <div class="cart-row">
        <div>
          <div><strong>${c.title}</strong></div>
          <div class="note">${currency(c.price)} Ã— ${c.qty}</div>
        </div>
        <div class="qty">
          <button aria-label="æ¸›å°‘" onclick="mutateQty(${i},-1)">â€“</button>
          <span>${c.qty}</span>
          <button aria-label="å¢åŠ " onclick="mutateQty(${i},1)">ï¼‹</button>
        </div>
      </div>`).join('');
  }
  const {subtotal,shipping,total} = calc();
  document.getElementById('subtotal').textContent = currency(subtotal);
  document.getElementById('shipping').textContent = currency(shipping);
  document.getElementById('total').textContent = currency(total);
  document.getElementById('fabCount').textContent = cart.reduce((s,i)=>s+i.qty,0);

  const method = getShipMethod();
  document.getElementById('shipLabel').textContent = method==='CVS' ? 'é‹è²»ï¼ˆè¶…å•†å–è²¨ï½œå…é‹ï¼‰' : 'é‹è²»ï¼ˆå®…é…ï¼‰';

  const shipSel = document.querySelector('select[name="ship"]');
  if(shipSel){ shipSel.value = method==='CVS' ? 'è¶…å•†å–è²¨' : 'å®…é…'; }

  document.getElementById('homeFields').style.display = (method==='HOME') ? 'block':'none';
  document.getElementById('cvsFields').style.display = (method==='CVS') ? 'block':'none';
  document.querySelector('input[name="addr"]')?.toggleAttribute('required', method==='HOME');
}

function addToCart(pid){
  const src = [...PONGAN, ...MAOGAO].find(x=>x.id===pid);
  if(!src) return;
  // ä¸å…è¨±å·²å”®å®ŒåŠ å…¥
  if(INV[pid]?.status === 'soldout'){
    showToast('æ­¤å•†å“å·²å”®å®Œ');
    return;
  }
  const price = priceOf(src.section, src.weight, src.size);
  const existed = cart.find(x=>x.id===pid);
  if(existed) existed.qty++;
  else cart.push({ id:src.id, title:src.title, price, qty:1, weight:src.weight, size:src.size, section:src.section });

  saveCart();
  renderCart();
  // ä¸å†è‡ªå‹•æ‰“é–‹è³¼ç‰©è»Šï¼Œæ”¹æç¤º
  showToast(INV[pid]?.status === 'preorder' ? 'å·²åŠ å…¥é è³¼æ¸…å–® ğŸŠ' : 'å·²åŠ å…¥è³¼ç‰©è»Š ğŸŠ');
}

function mutateQty(i,delta){
  cart[i].qty += delta;
  if(cart[i].qty<=0) cart.splice(i,1);
  saveCart(); renderCart();
}
function clearCart(){
  if(!cart.length) return;
  if(confirm('ç¢ºå®šè¦æ¸…ç©ºè³¼ç‰©è»Šï¼Ÿ')){
    cart.length = 0;
    saveCart(); renderCart();
  }
}

function saveForm(){
  const f = document.getElementById('orderForm');
  const obj = Object.fromEntries(new FormData(f));
  obj.shipMethod = getShipMethod();
  saveJSON(LS.form, obj);
}
function loadForm(){
  try{
    const obj = loadJSON(LS.form, null);
    if(!obj) return;
    const f = document.getElementById('orderForm');
    for(const k in obj){ if(f[k]) f[k].value = obj[k]; }
    setShipMethod(obj.shipMethod || 'HOME');
  }catch{}
}

// æäº¤è¨‚å–®ï¼ˆä¿æŒä½ åŸæœ¬ GAS é‚è¼¯ï¼‰
async function submitOrder(ev){
  ev.preventDefault();
  if(!cart.length){ alert("è³¼ç‰©è»Šæ˜¯ç©ºçš„"); return; }
  const agree = document.getElementById('agree');
  if(!agree.checked){ alert('è«‹å…ˆé–±è®€ã€Œç‰©æµèˆ‡é€€è²¨èªªæ˜ã€ä¸¦å‹¾é¸åŒæ„'); return; }

  const f = new FormData(ev.target);
  f.set('ship', getShipMethod()==='CVS' ? 'è¶…å•†å–è²¨' : f.get('ship'));
  const method = getShipMethod();
  if(method==='CVS'){
    const ok = cart.length===1 && cart[0].weight==='10å°æ–¤' && cart[0].qty===1;
    if(!ok){ alert('è¶…å•†å–è²¨é™ã€Œå–®ä¸€ 10 å°æ–¤ Ã— 1 ç®±ã€ã€‚'); return; }
  }
  for (const key of ['name','phone','email']){
    if(!f.get(key)){ alert('è«‹å®Œæ•´å¡«å¯«è¨‚å–®è³‡æ–™'); return; }
  }
  if(method==='HOME' && !f.get('addr')){ alert('è«‹å¡«å¯«å®…é…åœ°å€'); return; }

  const payload = {
    ts: new Date().toISOString(),
    name: f.get('name'),
    phone: f.get('phone'),
    email: f.get('email'),
    addr: method==='CVS' ? `${f.get('cvsBrand')||''} ${f.get('cvsStore')||''}ï¼ˆè¶…å•†å–è²¨ï¼‰` : (f.get('addr')||''),
    ship: method==='CVS' ? 'è¶…å•†å–è²¨' : f.get('ship'),
    remark: f.get('remark')||'',
    items: cart.map(c=>({title:c.title, section:c.section, weight:c.weight, size:c.size, price:c.price, qty:c.qty})),
    summary: calc(),
    brand: CONFIG.BRAND_TAG,
    shipMeta: { method, cvsBrand: f.get('cvsBrand')||'', cvsStore: f.get('cvsStore')||'' }
  };

  const btn = document.getElementById('submitBtn');
  const resBox = document.getElementById('result');
  btn.disabled = true; btn.textContent = 'é€å‡ºè¨‚å–®ä¸­ï¼Œè«‹ç¨ç­‰â€¦';
  resBox.textContent = '';
  try{
    const r = await fetch("https://script.google.com/macros/s/AKfycbw5y8y1Yw7ymc7bP-iqV4KmxMB7l3c1wxMpPK1F6-d_vx_ejiIhCzhq0CyHPxDUNM92/exec", {
      method:'POST', body: JSON.stringify(payload)
    });
    const data = await r.json();
    if(data.ok){
      resBox.innerHTML = `âœ… è¨‚å–®å·²å»ºç«‹ï¼ˆç·¨è™Ÿï¼š<b>${data.order_no}</b>ï¼‰ã€‚<br>æˆ‘å€‘å·²æŠŠåŒ¯æ¬¾è³‡è¨Šå¯„è‡³ <b>${payload.email}</b>ï¼Œè«‹æ–¼ 24 å°æ™‚å…§å®ŒæˆåŒ¯æ¬¾ä»¥ä¿ç•™åº«å­˜ã€‚`;
      cart.length = 0; saveCart(); renderCart(); ev.target.reset(); saveForm();
    }else{
      resBox.textContent = 'é€å‡ºå¤±æ•—ï¼š'+(data.msg||'æœªçŸ¥éŒ¯èª¤');
    }
  }catch(e){
    resBox.textContent = 'é€å‡ºå¤±æ•—ï¼š'+ e.message;
  }finally{
    btn.disabled = false; btn.textContent = 'é€å‡ºè¨‚å–®';
  }
}

/* =========================
 * G. è¨‚å–®æŸ¥è©¢ï¼ˆç¶­æŒä½ çš„åŸåŠŸèƒ½ï¼‰
 * ========================= */

async function queryOrder(ev){
  ev.preventDefault();
  const f = new FormData(ev.target);
  const no = (f.get('orderNo')||'').trim();
  const card = document.getElementById('queryCard');
  const dlBtn = document.getElementById('dlPngBtn');
  const printBtn = document.getElementById('printBtn');
  card.style.display = 'block';
  card.innerHTML = 'æŸ¥è©¢ä¸­â€¦';
  dlBtn.style.display = 'none';
  printBtn.style.display = 'none';
  try{
    const url = "https://script.google.com/macros/s/AKfycbw5y8y1Yw7ymc7bP-iqV4KmxMB7l3c1wxMpPK1F6-d_vx_ejiIhCzhq0CyHPxDUNM92/exec?orderNo=" + encodeURIComponent(no);
    const r = await fetch(url);
    const data = await r.json();
    if(data.ok){
      const s = data.status || 'ï¼ˆæœªæä¾›ç‹€æ…‹ï¼‰';
      const total = data.total ? `NT$ ${(data.total||0).toLocaleString()}` : 'â€”';
      const shipDate = data.shipDate || 'â€”';
      const trackNo = data.trackingNo || 'â€”';
      const trackLink = data.trackingNo ? `<a href="https://www.hct.com.tw/searchWaybill.aspx?no=${encodeURIComponent(data.trackingNo)}" target="_blank">æ–°ç«¹è²¨é‹æŸ¥è©¢</a>` : 'â€”';
      const items = Array.isArray(data.items) ? data.items.map(i=>`${i.title} Ã— ${i.qty}`).join('ã€') : 'â€”';
      card.innerHTML = `
        <div style="display:flex;justify-content:space-between;align-items:center;gap:8px">
          <h3 style="margin:0">è¨‚å–®æŸ¥è©¢çµæœ</h3>
          <div class="note">${new Date().toLocaleString()}</div>
        </div>
        <div class="line" style="margin:10px 0"></div>
        <div><b>è¨‚å–®ç·¨è™Ÿï¼š</b>${no}</div>
        <div><b>ç›®å‰ç‹€æ…‹ï¼š</b>${s}</div>
        <div><b>å‡ºè²¨æ—¥æœŸï¼š</b>${shipDate}</div>
        <div><b>ç‰©æµå–®è™Ÿï¼š</b>${trackNo}</div>
        <div><b>ç‰©æµæŸ¥è©¢ï¼š</b>${trackLink}</div>
        <div><b>é‡‘é¡ï¼š</b>${total}</div>
        <div><b>å“é …ï¼š</b>${items}</div>`;
      dlBtn.style.display = 'inline-flex';
      printBtn.style.display = 'inline-flex';
    }else{
      card.innerHTML = 'æŸ¥ç„¡æ­¤è¨‚å–®ç·¨è™Ÿ';
    }
  }catch(e){
    card.innerHTML = 'æŸ¥è©¢å¤±æ•—ï¼š' + e.message;
  }
}
async function downloadQueryPNG(){
  const card = document.getElementById('queryCard');
  if(!window.html2canvas){ alert('æˆªåœ–å·¥å…·è¼‰å…¥ä¸­ï¼Œè«‹ç¨å¾Œå†è©¦'); return; }
  const canvas = await html2canvas(card, {scale:2});
  const url = canvas.toDataURL('image/png');
  const a = document.createElement('a');
  a.href = url; a.download = 'order-query.png'; a.click();
}

/* =========================
 * H. é–€å¸‚é¸æ“‡å™¨ï¼ˆä¸è·³ç«™ï¼‰
 * ========================= */

// å…§å»ºç¯„ä¾‹é–€å¸‚ï¼ˆä½ ä¹Ÿå¯ä»¥å¾ç®¡ç†é¢æ¿è²¼ CSV ä¸€æ¬¡æ›´æ–°ï¼‰
const BUILTIN_STORES = {
  "7-11": [
    {name:"è±åŸæˆåŠŸé–€å¸‚", code:"123456", addr:"å°ä¸­å¸‚è±åŸå€æˆåŠŸè·¯ 123 è™Ÿ"},
    {name:"å…¬è€åªå±±é ‚é–€å¸‚", code:"223344", addr:"å°ä¸­å¸‚æ±å‹¢å€å±±é ‚è·¯ 8 è™Ÿ"}
  ],
  "å…¨å®¶": [
    {name:"æ±å‹¢ç¢§å±±é–€å¸‚", code:"998877", addr:"å°ä¸­å¸‚æ±å‹¢å€ç¢§å±±é‡Œ 88 è™Ÿ"}
  ]
};
let storeTab = '7-11';
let STORES = loadJSON(LS.stores, BUILTIN_STORES);

function openStorePicker(){
  setShipMethod('CVS'); // é–‹é–€å¸‚å‰å…ˆåˆ‡åˆ° CVS
  document.getElementById('storeModal').classList.add('open');
  renderStoreList();
}
function closeStorePicker(){
  document.getElementById('storeModal').classList.remove('open');
}
function switchStoreTab(tab){
  storeTab = tab;
  document.getElementById('tab711').classList.toggle('active', tab==='7-11');
  document.getElementById('tabFam').classList.toggle('active', tab==='å…¨å®¶');
  document.getElementById('storeSearch').value = '';
  renderStoreList();
}
function filterStores(){
  renderStoreList(document.getElementById('storeSearch').value.trim());
}
function renderStoreList(keyword=''){
  const list = document.getElementById('storeList');
  const all = STORES[storeTab] || [];
  const k = keyword.toLowerCase();
  const data = k ? all.filter(s =>
    (s.name||'').toLowerCase().includes(k) ||
    (s.addr||'').toLowerCase().includes(k) ||
    (s.code||'').toLowerCase().includes(k)
  ) : all;

  if(!data.length){
    list.innerHTML = `<div class="note">ç›®å‰æ²’æœ‰ç¬¦åˆçš„é–€å¸‚ï¼Œè«‹æ›é—œéµå­—æˆ–åˆ‡æ›å“ç‰Œã€‚</div>`;
    return;
  }
  list.innerHTML = data.map(s=>`
    <div class="store-item">
      <div class="row">
        <div><b>${s.name}</b></div>
        <button class="btn" onclick="chooseStore('${storeTab}','${s.name}','${s.code}')">é¸æ“‡</button>
      </div>
      <div class="sub">åº—è™Ÿï¼š${s.code}</div>
      <div class="sub">${s.addr||''}</div>
    </div>
  `).join('');
}
function chooseStore(brand, name, code){
  const storeStr = `${name} / ${code}`;
  document.querySelector('select[name="cvsBrand"]').value = brand;
  document.querySelector('input[name="cvsStore"]').value = storeStr;
  updateCvsLink();
  closeStorePicker();
  showToast(`å·²é¸æ“‡ ${brand}ï¼š${storeStr}`);
}
function reloadBuiltinStores(){
  STORES = JSON.parse(JSON.stringify(BUILTIN_STORES));
  saveJSON(LS.stores, STORES);
  renderStoreList();
}

// èˆŠçš„å¤–éƒ¨æŸ¥è©¢é€£çµï¼ˆä¿ç•™çµ¦æœ‰ç¿’æ…£ç”¨è€…ï¼‰
function updateCvsLink(){
  const brand = document.querySelector('select[name="cvsBrand"]').value;
  const a = document.getElementById('cvsFinderLink');
  if(brand==='å…¨å®¶'){
    a.href = 'https://www.family.com.tw/marketing/inquiry.aspx';
    a.textContent = 'é–‹å•Ÿ å…¨å®¶ é–€å¸‚æŸ¥è©¢ï¼ˆå¦é–‹ï¼‰';
  }else{
    a.href = 'https://emap.pcsc.com.tw/';
    a.textContent = 'é–‹å•Ÿ 7-11 é–€å¸‚æŸ¥è©¢ï¼ˆå¦é–‹ï¼‰';
  }
}

// è®€å‰ªè²¼ç°¿å¿«é€Ÿè²¼å›é–€å¸‚è³‡è¨Šï¼ˆä¿ç•™ä½ çš„åŸåŠŸèƒ½ï¼‰
async function pasteCvsFromClipboard(){
  try{
    const txt = await navigator.clipboard.readText();
    if(!txt){ alert('å‰ªè²¼ç°¿æ²’æœ‰å…§å®¹'); return; }
    const parsed = parseStoreFromText(txt);
    if(parsed){
      document.querySelector('input[name="cvsStore"]').value = `${parsed.name} / ${parsed.code}`;
    }else{
      document.querySelector('input[name="cvsStore"]').value = txt.trim();
    }
  }catch(e){
    alert('ç„¡æ³•è®€å–å‰ªè²¼ç°¿ï¼š' + e.message + 'ï¼ˆè«‹å…ˆå…è¨±æ¬Šé™ï¼‰');
  }
}
function parseStoreFromText(txt){
  const code = (txt.match(/(\d{5,6})/)||[])[1];
  const name = (txt.match(/([\u4e00-\u9fa5A-Za-z0-9]+é–€å¸‚)/)||[])[1]
            || (txt.match(/åº—å[:ï¼š]?\s*([\u4e00-\u9fa5A-Za-z0-9]+)/)||[])[1]
            || (txt.replace(/\s+/g,' ').trim().split(/[\/,ï¼Œ-]/)[0]||'é–€å¸‚');
  if(code){ return {name, code}; }
  return null;
}

/* =========================
 * I. æ¢æ¬¾ï¼šä¸€å®šè¦æ»¾åˆ°åº•æ‰èƒ½å‹¾
 * ========================= */
(function setupPolicy(){
  const det = document.getElementById('policy');
  const agree = document.getElementById('agree');
  const enableIfBottom = ()=>{
    const sc = det.scrollTop + det.clientHeight;
    const need = det.scrollHeight - 10;
    if(sc >= need){ agree.disabled = false; }
  };
  det.addEventListener('toggle', ()=>{ if(det.open){ det.focus(); }});
  det.addEventListener('scroll', enableIfBottom, {passive:true});
  document.querySelector('label[for="agree"]')?.addEventListener('click', (e)=>{
    if(agree.disabled){ e.preventDefault(); det.open=true; det.scrollIntoView({behavior:'smooth',block:'center'}); }
  });
})();

/* =========================
 * J. ç®¡ç†å“¡ç™»å…¥ + ç®¡ç†é¢æ¿ï¼ˆRAW URL è½‰æ›å™¨ + å…¨ç«™å¯ç·¨è¼¯ï¼‰
 * ========================= */

const ADMIN = {
  LS_KEY:'gx_admin_login_v2',
  USER:'111111',
  PASS:'111111',
  logged(){ try{return JSON.parse(localStorage.getItem(this.LS_KEY))?.ok;}catch{return false} },
  save(ok){ localStorage.setItem(this.LS_KEY, JSON.stringify({ok:!!ok, ts:Date.now()})); }
};

function toggleAdmin(open){
  const d = document.getElementById('adminDrawer');
  d.classList.toggle('open', !!open);
  renderAdmin();
}
function logoutAdmin(){
  ADMIN.save(false); invEditMode=false; renderAdmin(); renderAllGrids();
}

function renderAdmin(){
  const box = document.getElementById('adminBody');
  if(!ADMIN.logged()){
    box.innerHTML = `
      <h3>ç®¡ç†å“¡ç™»å…¥</h3>
      <div class="note">è¨˜æ†¶åœ¨æ­¤è£ç½®ã€‚</div>
      <div class="line"></div>
      <div class="form">
        <div class="label">å¸³è™Ÿ</div>
        <input class="input" id="admUser" placeholder="è¼¸å…¥å¸³è™Ÿ">
        <div class="label">å¯†ç¢¼</div>
        <input class="input" id="admPass" type="password" placeholder="è¼¸å…¥å¯†ç¢¼">
        <button class="btn" style="margin-top:10px" onclick="doAdminLogin()">ç™»å…¥</button>
      </div>`;
  }else{
    // ç®¡ç†é¢æ¿ï¼ˆå„åˆ†å€ï¼‰
    const O = loadOverrides();
    const T = O.TEXTS;

    box.innerHTML = `
      <h3>å¿«é€Ÿç·¨è¼¯</h3>
      <p class="note">ç™»å…¥å¾Œå¯ä¿®æ”¹ï¼šå°é¢ã€æ¨™èªŒã€å„å€æ¨™é¡Œ/æ–‡å­—ã€æœ€æ–°é®®å ±èˆ‡è¦æ ¼ç‰†ã€å•†å“åƒ¹æ ¼/åœ–ç‰‡/ç‹€æ…‹ã€é–€å¸‚æ¸…å–®ã€‚æ”¹å®Œè«‹æŒ‰å„å€å¡Šçš„ã€Œå„²å­˜ä¿®æ”¹ã€ã€‚</p>

      <!-- RAW URL è½‰æ›å™¨ -->
      <div class="admin-section">
        <h4>RAW URL è½‰æ›å™¨ï¼ˆä¸ç”¨ Tokenï¼‰</h4>
        <div class="admin-grid cols-2">
          <div>
            <div class="label">è²¼ä¸Šä¸€èˆ¬ GitHub ç¶²å€ï¼ˆæˆ–ä»»æ„ç¶²å€ï¼‰</div>
            <input id="rawInput" class="input" placeholder="ä¾‹ï¼šhttps://github.com/user/repo/blob/main/pic.jpg">
          </div>
          <div>
            <div class="label">è½‰æ›çµæœï¼ˆå¯è¤‡è£½è²¼å›å•†å“ï¼‰</div>
            <input id="rawOutput" class="input" readonly placeholder="æŒ‰ä¸‹æ–¹æŒ‰éˆ•å¾Œé¡¯ç¤º">
          </div>
        </div>
        <div class="admin-actions">
          <button class="btn" onclick="doRawConvert()">è½‰æ›ç‚º raw ç›´é€£</button>
          <button class="btn-ghost" onclick="copyRaw()">è¤‡è£½çµæœ</button>
        </div>
      </div>

      <!-- HERO èˆ‡ LOGO -->
      <div class="admin-section">
        <h4>é¦–é å°é¢ / å“ç‰Œæ¨™èªŒ</h4>
        <div class="admin-grid cols-2">
          <div>
            <div class="label">å°é¢èƒŒæ™¯ï¼ˆåœ–ç‰‡ç¶²å€ï¼‰</div>
            <input id="heroBg" class="input" value="${T.hero.bg}">
          </div>
          <div>
            <div class="label">å“ç‰Œ Logoï¼ˆåœ–ç‰‡ç¶²å€ï¼‰</div>
            <input id="heroLogo" class="input" value="${T.hero.logo}">
          </div>
          <div>
            <div class="label">è† å›Šæ–‡å­—ï¼ˆå°å­—ï¼‰</div>
            <input id="heroPillInput" class="input" value="${T.hero.pill}">
          </div>
          <div>
            <div class="label">ä¸»æ¨™é¡Œ</div>
            <input id="heroTitleInput" class="input" value="${T.hero.title}">
          </div>
          <div>
            <div class="label">å‰¯æ¨™</div>
            <textarea id="heroSubInput" class="input" rows="2">${T.hero.subtitle}</textarea>
          </div>
          <div>
            <div class="label">æŒ‰éˆ•æ–‡å­—</div>
            <input id="heroCtaText" class="input" value="${T.hero.ctaText}">
            <div class="label" style="margin-top:8px">æŒ‰éˆ•é€£çµï¼ˆ#id æˆ–ç¶²å€ï¼‰</div>
            <input id="heroCtaLink" class="input" value="${T.hero.ctaLink}">
          </div>
        </div>
        <div class="admin-actions">
          <button class="btn" onclick="saveHero()">å„²å­˜ä¿®æ”¹</button>
        </div>
      </div>

      <!-- å€å¡Šæ¨™é¡Œ -->
      <div class="admin-section">
        <h4>å€å¡Šæ¨™é¡Œèˆ‡å‰¯æ¨™</h4>
        <div class="admin-grid cols-2">
          <div><div class="label">ç†±éŠ·æ¨™é¡Œ</div><input id="hotTitleIn" class="input" value="${T.sections.hot.title}"></div>
          <div><div class="label">ç†±éŠ·å‰¯æ¨™</div><input id="hotSubIn" class="input" value="${T.sections.hot.subtitle}"></div>

          <div><div class="label">æ¤ªæŸ‘æ¨™é¡Œ</div><input id="ponganTitleIn" class="input" value="${T.sections.pongan.title}"></div>
          <div><div class="label">æ¤ªæŸ‘å‰¯æ¨™</div><input id="ponganSubIn" class="input" value="${T.sections.pongan.subtitle}"></div>

          <div><div class="label">èŒ‚æ¨™é¡Œ</div><input id="maogaoTitleIn" class="input" value="${T.sections.maogao.title}"></div>
          <div><div class="label">èŒ‚å‰¯æ¨™</div><input id="maogaoSubIn" class="input" value="${T.sections.maogao.subtitle}"></div>

          <div><div class="label">è¦æ ¼å€æ¨™é¡Œ</div><input id="specTitleIn" class="input" value="${T.sections.spec.title}"></div>
          <div><div class="label">è¦æ ¼å€å‰¯æ¨™</div><input id="specSubIn" class="input" value="${T.sections.spec.subtitle}"></div>

          <div><div class="label">æœ€æ–°é®®å ±æ¨™é¡Œ</div><input id="newsTitleIn" class="input" value="${T.sections.news.title}"></div>

          <div><div class="label">é—œæ–¼æˆ‘å€‘æ¨™é¡Œ</div><input id="aboutTitleIn" class="input" value="${T.sections.about.title}"></div>
          <div class="col-span-2">
            <div class="label">é—œæ–¼æˆ‘å€‘å…§æ–‡ï¼ˆæ¯è¡Œä¸€æ®µï¼Œå¯å« HTML<b>ç²—é«”</b>èˆ‡<br>æ›è¡Œï¼‰</div>
            <textarea id="aboutBodyIn" class="input" rows="5">${T.sections.about.body.join('\n')}</textarea>
          </div>
        </div>
        <div class="admin-actions">
          <button class="btn" onclick="saveSectionTexts()">å„²å­˜ä¿®æ”¹</button>
        </div>
      </div>

      <!-- æœ€æ–°é®®å ±ç·¨è¼¯ -->
      <div class="admin-section">
        <h4>æœ€æ–°é®®å ± / æœåœ’æ—¥èªŒ</h4>
        <div id="newsEditor"></div>
        <div class="admin-actions">
          <button class="btn" onclick="addNewsItem()">æ–°å¢ä¸€å‰‡</button>
          <button class="btn" onclick="saveNews()">å„²å­˜ä¿®æ”¹</button>
        </div>
      </div>

      <!-- è¦æ ¼åœ–ç‰†ç·¨è¼¯ -->
      <div class="admin-section">
        <h4>è¦æ ¼ç­‰ç´šåœ–ç‰†</h4>
        <div id="specEditor"></div>
        <div class="admin-actions">
          <button class="btn" onclick="addSpecImg()">æ–°å¢ä¸€å¼µ</button>
          <button class="btn" onclick="saveSpec()">å„²å­˜ä¿®æ”¹</button>
        </div>
      </div>

      <!-- å•†å“å¿«é€Ÿæ”¹åƒ¹/æ”¹åœ–/ç‹€æ…‹ -->
      <div class="admin-section">
        <h4>å•†å“ç·¨è¼¯ï¼ˆæ¨™é¡Œ / åƒ¹æ ¼ / åœ–ç‰‡ / ç‹€æ…‹ï¼‰</h4>
        <p class="note">äº¦å¯åœ¨æ¯å¼µå•†å“å¡ç›´æ¥ç·¨è¼¯æ¨™é¡Œã€åƒ¹æ ¼ã€åœ–ç‰‡ï¼›æ­¤è™•æä¾›è¡¨æ ¼å¼ä¸€æ¬¡ä¿®æ”¹ã€‚</p>
        <div id="productEditor"></div>
        <div class="admin-actions">
          <button class="btn" onclick="saveProducts()">å„²å­˜ä¿®æ”¹</button>
        </div>
      </div>

      <!-- é–€å¸‚æ¸…å–®ï¼ˆä¸è·³ç«™ç”¨ï¼‰ -->
      <div class="admin-section">
        <h4>é–€å¸‚æ¸…å–®ï¼ˆ7-11 / å…¨å®¶ï¼‰</h4>
        <p class="note">æ ¼å¼ï¼šæ¯è¡Œä¸€ç­†ï¼Œæ¬„ä½ä»¥é€—è™Ÿåˆ†éš”ï¼šã€Œåº—å,åº—è™Ÿ,åœ°å€ã€ã€‚ä¾‹ï¼šè±åŸæˆåŠŸé–€å¸‚,123456,å°ä¸­å¸‚è±åŸå€æˆåŠŸè·¯ 123 è™Ÿ</p>
        <div class="admin-grid cols-2">
          <div>
            <div class="label">7-11 CSV</div>
            <textarea id="csv711" class="input" rows="6">${(STORES['7-11']||[]).map(s=>`${s.name},${s.code},${s.addr||''}`).join('\n')}</textarea>
          </div>
          <div>
            <div class="label">å…¨å®¶ CSV</div>
            <textarea id="csvFam" class="input" rows="6">${(STORES['å…¨å®¶']||[]).map(s=>`${s.name},${s.code},${s.addr||''}`).join('\n')}</textarea>
          </div>
        </div>
        <div class="admin-actions">
          <button class="btn" onclick="saveStores()">å„²å­˜é–€å¸‚æ¸…å–®</button>
          <button class="btn-ghost" onclick="reloadBuiltinStores();document.getElementById('csv711').value='';document.getElementById('csvFam').value='';renderAdmin();">æ¢å¾©å…§å»ºç¯„ä¾‹</button>
        </div>
      </div>
    `;

    // æ¸²æŸ“å‹•æ…‹ç·¨è¼¯å™¨
    mountNewsEditor();
    mountSpecEditor();
    mountProductEditor();
  }
}

function doAdminLogin(){
  const u = document.getElementById('admUser').value.trim();
  const p = document.getElementById('admPass').value.trim();
  if(u===ADMIN.USER && p===ADMIN.PASS){
    ADMIN.save(true);
    alert('ç™»å…¥æˆåŠŸ'); renderAdmin();
  } else alert('å¸³å¯†éŒ¯èª¤');
}

/* --- RAW URL è½‰æ›å™¨ --- */
function doRawConvert(){
  const input = document.getElementById('rawInput').value.trim();
  document.getElementById('rawOutput').value = toRaw(input);
}
function copyRaw(){
  const o = document.getElementById('rawOutput');
  o.select(); document.execCommand('copy');
  showToast('å·²è¤‡è£½ RAW é€£çµ');
}

/* --- å„²å­˜ï¼šHero/å€å¡Šæ¨™é¡Œ/é—œæ–¼ --- */
function saveHero(){
  const O = loadOverrides();
  O.TEXTS.hero.bg = toRaw(document.getElementById('heroBg').value.trim());
  O.TEXTS.hero.logo = toRaw(document.getElementById('heroLogo').value.trim());
  O.TEXTS.hero.pill = document.getElementById('heroPillInput').value.trim();
  O.TEXTS.hero.title = document.getElementById('heroTitleInput').value.trim();
  O.TEXTS.hero.subtitle = document.getElementById('heroSubInput').value.trim();
  O.TEXTS.hero.ctaText = document.getElementById('heroCtaText').value.trim();
  O.TEXTS.hero.ctaLink = document.getElementById('heroCtaLink').value.trim() || '#hot';
  saveOverrides(O);
  renderTexts();
  showToast('å°é¢å·²æ›´æ–°');
}
function saveSectionTexts(){
  const O = loadOverrides();
  O.TEXTS.sections.hot.title = document.getElementById('hotTitleIn').value.trim();
  O.TEXTS.sections.hot.subtitle = document.getElementById('hotSubIn').value.trim();
  O.TEXTS.sections.pongan.title = document.getElementById('ponganTitleIn').value.trim();
  O.TEXTS.sections.pongan.subtitle = document.getElementById('ponganSubIn').value.trim();
  O.TEXTS.sections.maogao.title = document.getElementById('maogaoTitleIn').value.trim();
  O.TEXTS.sections.maogao.subtitle = document.getElementById('maogaoSubIn').value.trim();
  O.TEXTS.sections.spec.title = document.getElementById('specTitleIn').value.trim();
  O.TEXTS.sections.spec.subtitle = document.getElementById('specSubIn').value.trim();
  O.TEXTS.sections.news.title = document.getElementById('newsTitleIn').value.trim();
  O.TEXTS.sections.about.title = document.getElementById('aboutTitleIn').value.trim();
  const aboutLines = document.getElementById('aboutBodyIn').value.split('\n').map(s=>s.trim()).filter(Boolean);
  O.TEXTS.sections.about.body = aboutLines;
  saveOverrides(O);
  renderTexts();
  showToast('æ¨™é¡Œèˆ‡é—œæ–¼å…§å®¹å·²æ›´æ–°');
}

/* --- æœ€æ–°é®®å ± Editor --- */
function mountNewsEditor(){
  const O = loadOverrides();
  const wrap = document.getElementById('newsEditor');
  const list = O.NEWS || [];
  wrap.innerHTML = list.map((it,idx)=>`
    <div class="admin-grid cols-2" style="border:1px solid var(--border);border-radius:10px;padding:8px;margin:6px 0">
      <div>
        <div class="label">é¡å‹ï¼ˆimage / videoï¼‰</div>
        <input class="input" id="news-type-${idx}" value="${it.type}">
      </div>
      <div>
        <div class="label">æ¨™é¡Œ</div>
        <input class="input" id="news-title-${idx}" value="${it.title||''}">
      </div>
      <div class="col-span-2">
        <div class="label">ä¾†æºç¶²å€</div>
        <input class="input" id="news-src-${idx}" value="${it.src}">
        <div class="help">å¯è²¼ä¸€èˆ¬ GitHub ç¶²å€ï¼Œå„²å­˜æ™‚è‡ªå‹•è½‰ç‚º raw ç›´é€£</div>
      </div>
      <div class="admin-actions">
        <button class="btn-ghost" onclick="removeNews(${idx})">åˆªé™¤æ­¤å‰‡</button>
      </div>
    </div>
  `).join('') || '<div class="note">å°šç„¡é …ç›®ï¼Œè«‹æŒ‰ã€Œæ–°å¢ä¸€å‰‡ã€</div>';
}
function addNewsItem(){
  const O = loadOverrides();
  O.NEWS = O.NEWS || [];
  O.NEWS.push({type:'image', src:'https://via.placeholder.com/1200x800?text=%E6%96%B0%E5%A2%9E', title:''});
  saveOverrides(O); mountNewsEditor(); renderNewsRail();
}
function removeNews(i){
  const O = loadOverrides();
  O.NEWS.splice(i,1);
  saveOverrides(O); mountNewsEditor(); renderNewsRail();
}
function saveNews(){
  const O = loadOverrides();
  const list = O.NEWS || [];
  for(let i=0;i<list.length;i++){
    const type = document.getElementById(`news-type-${i}`).value.trim();
    const title = document.getElementById(`news-title-${i}`).value.trim();
    const src = toRaw(document.getElementById(`news-src-${i}`).value.trim());
    list[i] = {type, title, src};
  }
  O.NEWS = list; saveOverrides(O); renderNewsRail(); showToast('æœ€æ–°é®®å ±å·²æ›´æ–°');
}

/* --- è¦æ ¼åœ–ç‰† Editor --- */
function mountSpecEditor(){
  const O = loadOverrides();
  const wrap = document.getElementById('specEditor');
  const list = O.SPEC_GALLERY || [];
    wrap.innerHTML = list.map((src,idx)=>`
    <div class="admin-grid cols-2" style="border:1px solid var(--border);border-radius:10px;padding:8px;margin:6px 0">
      <div class="col-span-2">
        <div class="label">åœ–ç‰‡ç¶²å€</div>
        <input class="input" id="spec-src-${idx}" value="${src}">
        <div class="help">å¯è²¼ä¸€èˆ¬ GitHub ç¶²å€ï¼Œå„²å­˜æ™‚è‡ªå‹•è½‰ç‚º raw ç›´é€£</div>
      </div>
      <div class="admin-actions">
        <button class="btn-ghost" onclick="removeSpecImg(${idx})">åˆªé™¤æ­¤åœ–</button>
      </div>
    </div>
  `).join('') || '<div class="note">å°šç„¡è¦æ ¼åœ–ï¼Œè«‹æŒ‰ã€Œæ–°å¢ä¸€å¼µã€</div>';
}
function addSpecImg(){
  const O = loadOverrides();
  O.SPEC_GALLERY = O.SPEC_GALLERY || [];
  O.SPEC_GALLERY.push('https://via.placeholder.com/1200x800?text=%E8%A6%8F%E6%A0%BC%E5%9C%96');
  saveOverrides(O); mountSpecEditor(); renderSpecRail();
}
function removeSpecImg(i){
  const O = loadOverrides();
  O.SPEC_GALLERY.splice(i,1);
  saveOverrides(O); mountSpecEditor(); renderSpecRail();
}
function saveSpec(){
  const O = loadOverrides();
  const wrap = document.getElementById('specEditor');
  const inputs = wrap.querySelectorAll('input[id^="spec-src-"]');
  const list = [];
  inputs.forEach((inp)=> list.push(toRaw(inp.value.trim())));
  O.SPEC_GALLERY = list;
  saveOverrides(O); renderSpecRail(); showToast('è¦æ ¼åœ–ç‰†å·²æ›´æ–°');
}

/* --- å•†å“ Editorï¼ˆè¡¨æ ¼ä¸€æ¬¡ä¿®æ”¹ï¼‰ --- */
function mountProductEditor(){
  const O = loadOverrides();
  const wrap = document.getElementById('productEditor');
  const rows = [...PONGAN, ...MAOGAO];

  const header = `
    <div class="admin-grid cols-6" style="font-weight:800;padding:8px 0;border-bottom:1px solid var(--border)">
      <div>ID</div>
      <div>å“åï¼ˆå¯æ”¹ï¼‰</div>
      <div>åƒ¹æ ¼</div>
      <div>åœ–ç‰‡ç¶²å€</div>
      <div>ç‹€æ…‹</div>
      <div>å”®å‡º / åº«å­˜</div>
    </div>`;

  const body = rows.map(p=>{
    const price = priceOf(p.section, p.weight, p.size);
    const img = imgFor(p.section, p.weight, p.size);
    const inv = INV[p.id] || {sold:0, stock:0, status:'normal'};
    return `
      <div class="admin-grid cols-6" style="align-items:center;padding:8px 0;border-bottom:1px dashed var(--border)">
        <div class="note">${p.id}</div>
        <div><input class="input" id="pe-title-${p.id}" value="${p.title}"></div>
        <div><input class="input" type="number" id="pe-price-${p.section}-${p.weight}-${p.size}" value="${price}"></div>
        <div><input class="input" id="pe-img-${p.section}-${p.weight}-${p.size}" value="${img}"></div>
        <div class="note" style="display:flex;gap:8px;flex-wrap:wrap">
          <label><input type="radio" name="pe-status-${p.id}" value="normal"  ${inv.status==='normal'?'checked':''}> æ­£å¸¸</label>
          <label><input type="radio" name="pe-status-${p.id}" value="preorder" ${inv.status==='preorder'?'checked':''}> é è³¼</label>
          <label><input type="radio" name="pe-status-${p.id}" value="soldout" ${inv.status==='soldout'?'checked':''}> å”®å®Œ</label>
        </div>
        <div class="note" style="display:flex;gap:6px;align-items:center">
          <span>å”®å‡º</span><input class="input" type="number" id="pe-sold-${p.id}" value="${inv.sold}" style="width:90px">
          <span>åº«å­˜</span><input class="input" type="number" id="pe-stock-${p.id}" value="${inv.stock}" style="width:90px">
        </div>
      </div>`;
  }).join('');

  wrap.innerHTML = header + body;
}

function saveProducts(){
  const O = loadOverrides();
  const all = [...PONGAN, ...MAOGAO];

  // 1) æ¨™é¡Œ
  all.forEach(p=>{
    const t = document.getElementById(`pe-title-${p.id}`)?.value?.trim();
    if(t){ p.title = t; }
  });

  // 2) åƒ¹æ ¼ + åœ–ç‰‡
  all.forEach(p=>{
    const priceInputId = `pe-price-${p.section}-${p.weight}-${p.size}`;
    const imgInputId   = `pe-img-${p.section}-${p.weight}-${p.size}`;
    const priceVal = parseInt(document.getElementById(priceInputId)?.value||'0');
    const imgVal   = document.getElementById(imgInputId)?.value?.trim()||'';

    if(!O.PRICES[p.section]) O.PRICES[p.section] = {};
    if(!O.PRICES[p.section][p.weight]) O.PRICES[p.section][p.weight] = {};
    O.PRICES[p.section][p.weight][p.size] = Math.max(0, priceVal||0);

    if(!O.IMAGES[p.section]) O.IMAGES[p.section] = {};
    O.IMAGES[p.section][`${p.weight}-${p.size}`] = toRaw(imgVal);
  });

  // 3) ç‹€æ…‹ + å”®å‡º/åº«å­˜
  all.forEach(p=>{
    const status = (document.querySelector(`input[name="pe-status-${p.id}"]:checked`)?.value)||'normal';
    const sold = parseInt(document.getElementById(`pe-sold-${p.id}`)?.value||'0');
    const stock = parseInt(document.getElementById(`pe-stock-${p.id}`)?.value||'0');
    if(!INV[p.id]) INV[p.id] = {sold:0, stock:0, status:'normal'};
    INV[p.id].status = status;
    INV[p.id].sold = Math.max(0, sold||0);
    INV[p.id].stock = Math.max(0, stock||0);
  });

  saveOverrides(O);
  saveInventory();
  renderAllGrids();
  showToast('å•†å“è³‡æ–™å·²æ›´æ–°');
}

/* --- é–€å¸‚æ¸…å–®å„²å­˜ --- */
function saveStores(){
  const v711 = document.getElementById('csv711').value;
  const vFam = document.getElementById('csvFam').value;

  function parseCSV(s){
    return s.split('\n').map(l=>l.trim()).filter(Boolean).map(l=>{
      const [name='', code='', addr=''] = l.split(',').map(x=>x.trim());
      return {name, code, addr};
    }).filter(x=>x.name && x.code);
  }

  STORES = {
    '7-11': parseCSV(v711),
    'å…¨å®¶': parseCSV(vFam)
  };
  saveJSON(LS.stores, STORES);
  renderStoreList();
  showToast('é–€å¸‚æ¸…å–®å·²æ›´æ–°');
}

/* --- å–®ç­†åº«å­˜æ¬„ä½ from ç”¢å“å¡ï¼ˆä»ä¿ç•™ï¼‰ --- */
function editInv(id,key,val){
  if(!INV[id]) INV[id]={sold:0,stock:0,status:'normal'};
  INV[id][key] = Math.max(0, parseInt(val||0));
  saveInventory();
  renderAllGrids();
}

/* --- åˆ‡æ›åº«å­˜ç·¨è¼¯æ¨¡å¼ï¼ˆå³ä¸‹é½’è¼ªæœƒå‘¼å«ï¼‰ --- */
let invEditMode = false;
function toggleInvEdit(){
  if(!ADMIN.logged()){ toggleAdmin(true); return; }
  invEditMode = !invEditMode;
  renderAllGrids();
  showToast(invEditMode ? 'å·²é–‹å•Ÿåº«å­˜ç·¨è¼¯' : 'å·²é—œé–‰åº«å­˜ç·¨è¼¯');
}

/* =========================
 * K. åˆå§‹åŒ–
 * ========================= */
function renderBank(){
  // è‹¥é é¢ä¸Šæœ‰åŒ¯æ¬¾è³‡è¨Šæ¬„ä½ï¼Œå¸¶å…¥ï¼ˆå¯é¸ï¼‰
  const b = CONFIG.BANK;
  const bankName = document.getElementById('bankName');
  if(bankName){ bankName.textContent = b.name; }
  const bankHolder = document.getElementById('bankHolder');
  if(bankHolder){ bankHolder.textContent = b.holder; }
  const bankNo = document.getElementById('bankNo');
  if(bankNo){ bankNo.textContent = b.no; }
}

function init(){
  // æ–‡å­—/åœ–åƒ
  renderTexts();
  renderNewsRail();
  renderSpecRail();
  renderAllGrids();
  renderBank();

  // é…é€èˆ‡è¡¨å–®
  setShipMethod(getShipMethod());
  renderCart();
  loadForm();
  updateCvsLink();

  // æŠŠæµ®å‹•è³¼ç‰©è»ŠæŒ‰éˆ•æ›æˆæ©˜å­æ¨£å¼çš„æ–‡æ¡ˆï¼ˆåœ–ç¤ºï¼‰
  const fab = document.getElementById('cartFab');
  if(fab){
    fab.innerHTML = `ğŸŠ è³¼ç‰©è»Š <span id="fabCount" class="fab-badge">0</span>`;
  }
}

// é é¢å°±ç·’
init();
</script>
