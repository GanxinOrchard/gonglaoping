<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>æŸ‘å¿ƒæœåœ’ï½œå…¬è€åªæ¤ªæŸ‘ãƒ»æ±å‹¢èŒ‚è°·ï½œåœ¨åœ°å‚³æ‰¿çš„å¥½æ»‹å‘³</title>
  <meta name="description" content="æŸ‘å¿ƒæœåœ’ï¼šç”¨å¿ƒç¨®æŸ‘ï¼Œèˆ‡ä½ æŸ‘å¿ƒç›¸ä¼´ã€‚å…¬è€åªå±±é ‚åœ¨åœ°50å¹´æ¤ªæŸ‘ã€æ±å‹¢åœ¨åœ°30å¹´èŒ‚è°·ã€‚ç¾æ¡åˆ†ç´šç›´é€ï¼Œ10/25 å°æ–¤å¤šè¦æ ¼ï¼ŒåŒ¯æ¬¾ç«‹å³å®‰æ’å‡ºè²¨ã€‚åˆ°è²¨è«‹é–‹ç®±éŒ„å½±ä¿éšœç†è³ ã€‚">
  <style>
    :root{
      --bg:#faf7f2; --surface:#ffffff; --text:#1f2937; --muted:#6b7280;
      --brand:#f59e0b; --brand-dark:#d97706; --border:#e5e7eb; --shadow:0 10px 28px rgba(0,0,0,.06);
      --hot:#ef4444; --hot-dark:#dc2626; --pongan-surface:#fff7d6; --maogao-surface:#eef9f0;
      --ok:#10b981; --warn:#f59e0b;
    }
    *{box-sizing:border-box}
    html{scroll-behavior:smooth; -webkit-text-size-adjust:100%}
    body{margin:0;background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans TC","Helvetica Neue",Arial,sans-serif}
    a{color:var(--brand-dark);text-decoration:none}
    .wrap{max-width:1100px;margin:0 auto;padding:0 16px}
    /* Hero */
    .hero{position:relative;min-height:52vh;display:grid;place-items:center;color:#fff;background-size:cover;background-position:center}
    @media(max-width:560px){.hero{min-height:44vh}}
    .hero::after{content:"";position:absolute;inset:0;background:linear-gradient(180deg,rgba(0,0,0,.45),rgba(0,0,0,.38));z-index:0;pointer-events:none}
    .hero-inner{position:relative;z-index:1;text-align:center;padding:56px 16px}
    .logo{width:110px;height:110px;border-radius:18px;background:#fff9;padding:10px;backdrop-filter:blur(4px);display:inline-grid;place-items:center;margin-bottom:10px}
    .logo img{max-width:100%;max-height:100%}
    .hero h1{font-size:clamp(21px,4.8vw,36px);margin:4px 0 6px}
    .hero p{font-size:clamp(12.5px,3.2vw,15px);opacity:.98;margin:0}
    .pill{display:inline-block;background:#fff3;backdrop-filter:blur(4px);border:1px solid #fff7;color:#fff;border-radius:999px;padding:6px 10px;font-weight:700}
    .btn{display:inline-flex;align-items:center;gap:8px;border-radius:12px;padding:10px 14px;background:var(--brand);color:#111;font-weight:700;border:1px solid rgba(0,0,0,.05);box-shadow:0 10px 20px rgba(245,158,11,.25);cursor:pointer;font-size:clamp(12.5px,3vw,15px)}
    .btn:hover{background:var(--brand-dark)}
    .btn-ghost{background:#f9fafb;border:1px solid var(--border);color:var(--text);box-shadow:none}
    .btn-ghost:hover{background:#f3f4f6}
    .btn-red{background:var(--hot);color:#fff;border-color:#ef4444;box-shadow:0 10px 20px rgba(239,68,68,.25)}
    .btn-red:hover{background:var(--hot-dark)}
    .btn-block{width:100%;justify-content:center}
    .section{padding:34px 0}
    .section h2{font-size:clamp(17px,3.8vw,25px);margin:0 0 10px}
    .muted{color:var(--muted)}
    .card{background:var(--surface);border:1px solid var(--border);border-radius:16px;box-shadow:var(--shadow)}
    .grid{display:grid;gap:16px}
    @media(min-width:900px){.grid-2{grid-template-columns:1fr 1fr}}
    .content{padding:16px}
    .content p{margin:0 0 10px;line-height:1.8;font-size:clamp(13.5px,3.2vw,15px)}
    .content ul{margin:0;padding-left:1.2em;line-height:1.8}
    .content li{margin:4px 0}
    .note{font-size:12.5px;color:var(--muted)}
    /* åˆ†é¡ç±¤ï¼šå–®æ’æ©«å‘æ»‘å‹• */
    .subnav{position:sticky;top:0;z-index:40;background:var(--surface);border-bottom:1px solid var(--border);box-shadow:0 6px 20px rgba(0,0,0,.04)}
    .subnav .rail{display:flex;gap:8px;align-items:center;padding:10px 4px;overflow-x:auto;white-space:nowrap;-webkit-overflow-scrolling:touch;scroll-snap-type:x proximity}
    .subnav .rail::-webkit-scrollbar{height:6px}
    .subnav .rail::-webkit-scrollbar-thumb{background:#e6e6e6;border-radius:999px}
    .chip{flex:0 0 auto;background:#fef3c7;border:1px solid #fde68a;color:#7c2d12;padding:8px 12px;border-radius:12px;font-weight:800;cursor:pointer;scroll-snap-align:center;font-size:clamp(12.5px,3vw,14px)}
    .chip:hover{background:#fde68a}
    /* æ©«å‘æ»‘å‹•å¡ç‰‡ */
    .rail-cards{display:flex;gap:12px;overflow:auto;padding:10px 4px}
    .rail-cards::-webkit-scrollbar{height:6px}
    .rail-cards::-webkit-scrollbar-thumb{background:#e6e6e6;border-radius:999px}
    .rail-cards .card{flex:0 0 auto;width:min(480px,92%)}
    .spec-cards .card{width:min(360px,48%)}
    @media(min-width:900px){.spec-cards .card{width:min(420px,32%)}}
    /* ç”¢å“ç¶²æ ¼ */
    .product-grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}
    @media(min-width:960px){.product-grid{gap:14px}}
    .product{display:flex;flex-direction:column;position:relative;overflow:hidden}
    .product img{width:100%;aspect-ratio:4/3;height:auto;object-fit:cover;border-radius:14px 14px 0 0}
    .product .body{padding:10px 12px}
    .title{margin:0;font-weight:700;font-size:clamp(12.5px,3.5vw,15px);line-height:1.35;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;min-height:2.4em}
    .price{font-weight:800;font-size:clamp(14px,3.8vw,16px)}
    .row-between{display:flex;align-items:center;justify-content:space-between}
    .tag-hot{display:inline-block;background:var(--hot);color:#fff;border:1px solid #ef4444;border-radius:10px;padding:3px 7px;font-size:12px;font-weight:800}
    /* å€å¡Šä¸»é¡Œ */
    .theme-hot .content{background:#fee2e2;border-color:#fecaca}
    .theme-pongan .content{background:var(--pongan-surface);border-color:#fde68a}
    .theme-maogao .content{background:var(--maogao-surface);border-color:#bbf7d0}
    /* æŠ½å±œï¼ˆå…±ç”¨ï¼‰ */
    .drawer{position:fixed;right:0;top:0;bottom:0;width:min(480px,96%);background:var(--surface);border-left:1px solid var(--border);
      transform:translateX(105%);transition:.28s;z-index:60;display:flex;flex-direction:column}
    .drawer.open{transform:none}
    .drawer header{padding:12px 14px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;gap:8px}
    .drawer header .btns{display:flex;gap:8px}
    .drawer main{padding:12px 14px;overflow:auto;flex:1}
    .line{height:1px;background:var(--border);margin:10px 0}
    .cart-row{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:8px 0}
    .qty{display:flex;align-items:center;border:1px solid var(--border);border-radius:10px}
    .qty button{width:30px;height:30px;border:0;background:#f3f4f6}
    .qty span{display:inline-block;width:32px;text-align:center}
    .summary{background:#f9fafb;border:1px dashed var(--border);border-radius:12px;padding:12px}
    .badge{display:inline-block;background:#fff0d6;color:#7c2d12;border:1px solid #fed7aa;border-radius:10px;padding:4px 8px;font-size:12px;font-weight:700}
    .warn{background:#fff1f2;border:1px solid #fecdd3;color:#7f1d1d}
    /* è¡¨å–® */
    .form .row{display:grid;gap:10px}
    @media(min-width:720px){.form .row{grid-template-columns:1fr 1fr}}
    .label{font-weight:700;margin:8px 0 6px}
    .input, select, textarea{width:100%;padding:12px;border:1px solid var(--border);border-radius:10px;background:#fff;font-size:16px}
    input, select, textarea{touch-action:manipulation}
    .help{font-size:12px;color:#6b7280;margin-top:4px}
    /* æµ®å‹•è³¼ç‰©è»ŠæŒ‰éˆ•ï¼šæ©˜å­æ¨£å¼ */
    .fab{position:fixed;right:16px;bottom:calc(16px + env(safe-area-inset-bottom));z-index:55;
      background: radial-gradient(circle at 30% 30%, #ffd27a, #f59e0b);
      color:#111;border:1px solid rgba(0,0,0,.06); padding:12px 16px;border-radius:999px;
      box-shadow:0 10px 18px rgba(245,158,11,.35);display:flex;align-items:center;gap:8px;font-weight:800;cursor:pointer}
    .fab:before{content:"ğŸŠ";}
    .fab-badge{display:inline-block;min-width:22px;height:22px;border-radius:999px;background:#111;color:#fff;font-size:12px;line-height:22px;text-align:center;padding:0 6px}
    /* ä¸èµ·çœ¼çš„ç®¡ç†å“¡æŒ‰éˆ•ï¼ˆå·¦ä¸‹è§’ï¼‰ */
    .admin-btn{position:fixed;left:14px;bottom:calc(16px + env(safe-area-inset-bottom));z-index:56;background:#fff;border:1px solid var(--border);border-radius:999px;box-shadow:var(--shadow);padding:8px 10px;opacity:.5;cursor:pointer}
    .admin-btn:hover{opacity:.9}
    /* å³ä¸‹è§’é½’è¼ªï¼ˆåº«å­˜ç·¨è¼¯ï¼‰ */
    .gear{position:fixed;right:16px;bottom:calc(68px + env(safe-area-inset-bottom));z-index:55;background:#fff;border:1px solid var(--border);border-radius:999px;box-shadow:var(--shadow);padding:10px 12px;cursor:pointer}
    footer{padding:34px 0 56px;color:#6b7280;text-align:center}
    /* ç”¢å“ç‹€æ…‹è²¼ç´™ï¼ˆé è³¼ / å”®å®Œï¼‰ */
    .status-badge{position:absolute;left:8px;top:8px;z-index:2;padding:6px 8px;border-radius:10px;font-weight:800;font-size:12px;color:#111;background:#fff;box-shadow:0 6px 14px rgba(0,0,0,.12)}
    .status-preorder{background:#dcfce7;border:1px solid #bbf7d0;color:#064e3b}
    .status-soldout{background:#fee2e2;border:1px solid #fecaca;color:#7f1d1d}
    .soldout .body{opacity:.65}
    .soldout img{filter:grayscale(.25) brightness(.9)}
    .toast{position:fixed;left:50%;bottom:20px;transform:translateX(-50%);background:#111;color:#fff;padding:10px 14px;border-radius:999px;font-weight:700;box-shadow:0 10px 24px rgba(0,0,0,.25);z-index:80;opacity:0;pointer-events:none;transition:.3s}
    .toast.show{opacity:1;bottom:28px}
    /* ç®¡ç†é¢æ¿ï¼šå°æ’ç‰ˆ */
    .adm-row{display:grid;grid-template-columns:1fr;gap:10px}
    @media(min-width:720px){.adm-row{grid-template-columns:1fr 1fr}}
    .adm-grid-3{display:grid;grid-template-columns:1fr;gap:10px}
    @media(min-width:900px){.adm-grid-3{grid-template-columns:repeat(3,1fr)}}
    .kbd{display:inline-block;background:#f3f4f6;border:1px solid var(--border);border-bottom-width:2px;border-radius:6px;padding:0 6px;font-size:12px}
  </style>
</head>
<body>
  <!-- è³¼ç‰©è»ŠæŠ½å±œ -->
  <aside id="drawer" class="drawer" aria-hidden="true">
    <header>
      <strong>è³¼ç‰©è»Š</strong>
      <div class="btns">
        <button class="btn-ghost" onclick="clearCart()">æ¸…ç©ºè³¼ç‰©è»Š</button>
        <button class="btn" onclick="toggleDrawer(false)">é—œé–‰</button>
      </div>
    </header>
    <main>
      <div id="cartList"></div>
      <div class="line"></div>
      <!-- é…é€æ–¹å¼ -->
      <div class="summary" style="margin-bottom:10px">
        <div class="label">é…é€æ–¹å¼</div>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <button id="shipHomeBtn" class="btn" type="button" onclick="setShipMethod('HOME')">å®…é…</button>
          <button id="shipCvsBtn" class="btn-ghost" type="button" onclick="setShipMethod('CVS')">è¶…å•†å–è²¨ï¼ˆå…é‹ï½œé™10æ–¤Ã—1ï¼‰</button>
        </div>
        <div class="help">è¶…å•†å–è²¨é™ã€Œå–®ä¸€ 10 å°æ–¤ Ã— 1 ç®±ã€ï¼Œä¸æ¥å—å¤–å³¶é…é€ã€‚</div>
        <div class="help">é¸é–€å¸‚ï¼šé»ä¸‹æ–¹æŒ‰éˆ•åœ¨æ–°åˆ†é æŒ‘é¸ âœ å›åˆ°æœ¬é å¾ŒæŒ‰ <span class="kbd">è²¼ä¸Šå‰ªè²¼ç°¿</span> è‡ªå‹•å¸¶å›é–€å¸‚ã€‚</div>
      </div>
      <!-- é‹è²»èˆ‡ç¸½é¡ -->
      <div class="summary">
        <div class="row-between"><span>å•†å“å°è¨ˆ</span><strong id="subtotal">$0</strong></div>
        <div class="row-between"><span id="shipLabel">é‹è²»ï¼ˆå®…é…ï¼‰</span><strong id="shipping">$0</strong></div>
        <div class="line"></div>
        <div class="row-between" style="font-size:18px"><span>æ‡‰ä»˜é‡‘é¡</span><strong id="total">$0</strong></div>
        <div class="note" style="margin-top:8px">å®…é…æ»¿é¡ <b id="freeShipText">0</b> å…é‹ï¼›è¶…å•†å–è²¨ä¸€å¾‹å…é‹ã€‚</div>
      </div>
      <div class="line"></div>
      <!-- ä¸‹å–®è¡¨å–® -->
      <form id="orderForm" class="form" onsubmit="submitOrder(event)">
        <div class="row">
          <div>
            <div class="label">å§“å</div>
            <input class="input" name="name" placeholder="ä¾‹ï¼šé™³å°æ©˜" required>
          </div>
          <div>
            <div class="label">æ‰‹æ©Ÿ</div>
            <input class="input" name="phone" placeholder="ä¾‹ï¼š0912-345-678" required>
          </div>
        </div>
        <div class="row">
          <div>
            <div class="label">Emailï¼ˆå¯„é€å‡ºè²¨é€šçŸ¥ï¼‰</div>
            <input class="input" type="email" name="email" placeholder="ä¾‹ï¼šorange@example.com" required>
          </div>
          <div>
            <div class="label">ç‰©æµæ–¹å¼</div>
            <select name="ship" class="input" required>
              <option value="å®…é…">å®…é…</option>
              <option value="è¶…å•†å–è²¨">è¶…å•†å–è²¨ï¼ˆå…é‹ï½œé™10æ–¤Ã—1ï¼‰</option>
              <option value="è‡ªå–ï¼ˆå°ä¸­å¸‚çŸ³å²¡å€çŸ³å²¡è¡—61è™Ÿï¼‰">è‡ªå–ï¼ˆå°ä¸­å¸‚çŸ³å²¡å€çŸ³å²¡è¡—61è™Ÿï¼‰</option>
            </select>
            <div class="help">æ­¤æ¬„æœƒè·Ÿä¸Šæ–¹ã€Œé…é€æ–¹å¼ã€åŒæ­¥ã€‚</div>
          </div>
        </div>
        <!-- åœ°å€ï¼è¶…å•† -->
        <div id="homeFields">
          <div class="label">æ”¶ä»¶åœ°å€ï¼ˆå®…é…å°ˆç”¨ï¼‰</div>
          <input class="input" name="addr" placeholder="ä¾‹ï¼šå°ä¸­å¸‚â—‹â—‹å€â—‹â—‹è·¯ 123 è™Ÿ 5 æ¨“" required>
        </div>
        <div id="cvsFields" style="display:none">
          <div class="row">
            <div>
              <div class="label">è¶…å•†å“ç‰Œï¼ˆ7-11ï¼å…¨å®¶ï¼‰</div>
              <select class="input" name="cvsBrand" onchange="updateCvsLink()">
                <option value="7-11">7-11</option>
                <option value="å…¨å®¶">å…¨å®¶</option>
              </select>
              <div class="help">
                <a id="cvsFinderLink" href="https://emap.pcsc.com.tw/" target="_blank" rel="noopener">é–‹å•Ÿ 7-11 é–€å¸‚æŸ¥è©¢</a>ã€€
                <button type="button" class="btn-ghost" onclick="pasteCvsFromClipboard()">è²¼ä¸Šå‰ªè²¼ç°¿</button>
              </div>
            </div>
            <div>
              <div class="label">é–€å¸‚åç¨± / åº—è™Ÿ</div>
              <input class="input" name="cvsStore" placeholder="ä¾‹ï¼šè±åŸæˆåŠŸé–€å¸‚ / 123456">
              <div class="help">å…ˆé»ã€Œé–€å¸‚æŸ¥è©¢ã€æ‰¾åˆ°é–€å¸‚ï¼Œå†é»ã€Œè²¼ä¸Šå‰ªè²¼ç°¿ã€å˜—è©¦è‡ªå‹•å›å¡«ï¼›æˆ–æ‰‹å‹•è¼¸å…¥ã€‚</div>
            </div>
          </div>
        </div>
        <div>
          <div class="label">å‚™è¨»ï¼ˆåˆ°è²¨æ™‚æ®µç­‰ï¼‰</div>
          <textarea class="input" name="remark" rows="3" placeholder="ä¾‹ï¼šå¹³æ—¥ 18:00 å¾Œæ”¶ä»¶"></textarea>
        </div>
        <!-- åŒæ„æ¢æ¬¾ -->
        <div class="line"></div>
        <div class="label">ç‰©æµèˆ‡é€€è²¨èªªæ˜</div>
        <details id="policy" class="card content" style="max-height:220px;overflow:auto">
          <summary style="cursor:pointer"><b>è«‹å±•é–‹é–±è®€ï¼ˆéœ€æ²åˆ°æœ€åº•æ‰å¯å‹¾é¸åŒæ„ï¼‰</b></summary>
          <div class="content" style="padding-top:10px">
            <ul>
              <li>å…¥å¸³å¾Œ 1â€“3 å€‹å·¥ä½œå¤©å…§å‡ºè²¨ï¼ˆé€±æœ«èˆ‡ç¯€æ…¶é‡å¤§æ™‚é †å»¶ï¼‰ã€‚</li>
              <li>å®…é…ï¼šæ–°ç«¹è²¨é‹ï¼ˆå¸¸æº«ï¼‰ã€‚åˆ°è²¨è«‹ã€Œå…¨ç¨‹é–‹ç®±éŒ„å½±ã€ã€‚è‹¥æœ‰é‹æï¼Œ<b>24 å°æ™‚å…§æä¾›å½±ç‰‡èˆ‡ç…§ç‰‡</b>ï¼Œæˆ‘å€‘å”åŠ©å‘ç‰©æµç†è³ ã€‚</li>
              <li>è¶…å•†å–è²¨ï¼š<b>å…é‹</b>ï¼Œ<b>é™å–®ä¸€ 10 å°æ–¤ Ã— 1 ç®±</b>ï¼Œä¸”ç›®å‰<b>ä¸æ¥å—å¤–å³¶é…é€</b>ã€‚</li>
              <li>æ°´æœå±¬å¤©ç„¶è¾²ç”¢ï¼Œ<b>è¡¨çš®ç„¡æ³•å®Œç¾ç„¡ç‘•</b>å±¬æ­£å¸¸ç¾è±¡ï¼›å¤–è§€ã€ç”œåº¦æœƒå› æ°£å€™æ‰¹æ¬¡ç•¥æœ‰å·®ç•°ã€‚</li>
              <li>ç”Ÿé®®æ°´æœä¾æ³•ä¸é©ç”¨ 7 æ—¥çŒ¶è±«æœŸï¼›è‡ªç„¶æœæ–‘ã€ç³–ç“¤ã€ç”œåº¦è½å·®ä¸åˆ—ç‚ºé€€æ›ã€‚</li>
            </ul>
            <p class="note">è«‹ç¢ºèªä¸Šè¿°å…§å®¹ï¼Œæ²åˆ°åº•å³å¯å•Ÿç”¨åŒæ„å‹¾é¸ã€‚</p>
          </div>
        </details>
        <div style="margin:8px 0">
          <label for="agree">
            <input type="checkbox" id="agree" disabled> æˆ‘å·²è©³é–±<span style="text-decoration:underline">ä¸Šæ–¹</span>ã€Œç‰©æµèˆ‡é€€è²¨èªªæ˜ã€ä¸¦åŒæ„
          </label>
          <div class="help">ï¼ˆè‹¥æœªå•Ÿç”¨ï¼Œè«‹å…ˆå±•é–‹ä¸¦æ²åˆ°æœ€åº•ï¼‰</div>
        </div>
        <button id="submitBtn" class="btn btn-block" type="submit">é€å‡ºè¨‚å–®</button>
        <div id="result" class="note" style="margin-top:8px"></div>
      </form>
    </main>
  </aside>

  <!-- è¨‚å–®æŸ¥è©¢æŠ½å±œ -->
  <aside id="queryDrawer" class="drawer" aria-hidden="true">
    <header>
      <strong>è¨‚å–®æŸ¥è©¢</strong>
      <div class="btns">
        <button class="btn" onclick="toggleQuery(false)">é—œé–‰</button>
      </div>
    </header>
    <main>
      <form id="queryForm" onsubmit="queryOrder(event)" class="form">
        <div>
          <div class="label">è¨‚å–®ç·¨è™Ÿ</div>
          <input class="input" name="orderNo" placeholder="ä¾‹ï¼šK24-20251008-1234" required>
        </div>
        <button class="btn" type="submit" style="margin-top:8px">æŸ¥è©¢</button>
      </form>
      <div class="line"></div>
      <div id="queryCard" class="card content" style="display:none"></div>
      <div style="display:flex;gap:8px;margin-top:8px">
        <button id="dlPngBtn" class="btn-ghost" onclick="downloadQueryPNG()" style="display:none">ä¸€éµæˆªåœ–ï¼ˆPNGï¼‰</button>
        <button id="printBtn" class="btn-ghost" onclick="window.print()" style="display:none">åˆ—å° / å­˜ PDF</button>
      </div>
    </main>
  </aside>

  <!-- ç®¡ç†å“¡æŠ½å±œ -->
  <aside id="adminDrawer" class="drawer" aria-hidden="true">
    <header>
      <strong>ç®¡ç†é¢æ¿</strong>
      <div class="btns">
        <button class="btn-ghost" onclick="logoutAdmin()">ç™»å‡º</button>
        <button class="btn" onclick="toggleAdmin(false)">é—œé–‰</button>
      </div>
    </header>
    <main id="adminBody" class="content"></main>
  </aside>

  <!-- æµ®å‹•è³¼ç‰©è»ŠæŒ‰éˆ•ï¼ˆæ©˜å­æ¨£å¼ï¼‰ -->
  <button id="cartFab" class="fab" aria-label="é–‹å•Ÿè³¼ç‰©è»Š" onclick="toggleDrawer(true)">
    <span>è³¼ç‰©è»Š</span>
    <span id="fabCount" class="fab-badge">0</span>
  </button>
  <!-- ç®¡ç†å“¡å…¥å£ -->
  <button class="admin-btn" onclick="toggleAdmin(true)" title="ç®¡ç†å“¡">ğŸ”’</button>
  <!-- åº«å­˜ç·¨è¼¯é½’è¼ª -->
  <button class="gear" onclick="toggleInvEdit()" title="åº«å­˜èˆ‡ç‹€æ…‹ç·¨è¼¯">âš™ï¸</button>

  <!-- Hero -->
  <section class="hero" id="hero">
    <div class="hero-inner wrap">
      <div class="logo"><img id="logoImg" src="" alt="æŸ‘å¿ƒæœåœ’ Logo"></div>
      <span id="heroPill" class="pill">è±åŸãƒ»æ±å‹¢ï½œåœ¨åœ°å‚³æ‰¿</span>
      <h1 id="heroTitle">æŸ‘å¿ƒæœåœ’ï½œç”¨å¿ƒç¨®æŸ‘ï¼Œèˆ‡ä½ æŸ‘å¿ƒç›¸ä¼´</h1>
      <p id="heroDesc">å…¬è€åªæ¤ªæŸ‘ï¼ˆ50å¹´ï¼‰èˆ‡æ±å‹¢èŒ‚è°·ï¼ˆ30å¹´ï¼‰ï¼Œç¾æ¡åˆ†ç´šç›´é€ã€‚10 / 25 å°æ–¤å¤šè¦æ ¼å¯é¸ï¼ŒåŒ¯æ¬¾å¾Œç«‹å³å®‰æ’å‡ºè²¨ï¼›åˆ°è²¨è«‹é–‹ç®±éŒ„å½±ï¼Œä¿éšœé‹æç†è³ ã€‚</p>
      <div style="margin-top:14px">
        <a id="shopNowBtn" class="btn" href="#hot" onclick="go(event,'hot')">é¦¬ä¸Šé¸è³¼</a>
      </div>
    </div>
  </section>

  <!-- åˆ†é¡éŒ¨é»ï¼ˆå–®æ’ï¼‰ -->
  <nav class="subnav">
    <div class="wrap">
      <div class="rail">
        <button id="tabHot" class="chip" onclick="go(event,'hot')">ğŸ”¥ ç†±éŠ·æ¬¾</button>
        <button id="tabPongan" class="chip" onclick="go(event,'pongan')">å…¬è€åªæ¤ªæŸ‘</button>
        <button id="tabMaogao" class="chip" onclick="go(event,'maogao')">æ±å‹¢èŒ‚è°·</button>
        <button id="tabQuery" class="chip" onclick="toggleQuery(true)">è¨‚å–®æŸ¥è©¢</button>
      </div>
    </div>
  </nav>

  <!-- å“ç‰Œæ•…äº‹ + æœ€æ–°é®®å ± -->
  <section class="section">
    <div class="wrap grid grid-2">
      <div class="card content" id="aboutCard">
        <h2 id="aboutTitle">é—œæ–¼ã€ŒæŸ‘å¿ƒæœåœ’ã€</h2>
        <div id="aboutHtml">
          <p>æˆ‘å€‘ç›¸ä¿¡ï¼Œå¥½çš„æ°´æœï¼Œä¾†è‡ªé•·å¹´çš„å …æŒèˆ‡åœŸåœ°çš„å›æ‡‰ã€‚</p>
          <p><b>å…¬è€åªæ¤ªæŸ‘</b>æ‰¿è¼‰è‘—å®¶æ—åœ¨å±±é ‚çš„ <b>50 å¹´</b>è€•ä½œè¨˜æ†¶ï¼šæ—¥ç…§å……è¶³ã€æ—©æ™šæº«å·®å¤§ï¼Œè®“æœçš®è–„ã€æ±æ°´è¶³ã€é…¸ç”œå¹³è¡¡ã€‚</p>
          <p><b>æ±å‹¢èŒ‚è°·</b>å‰‡æ˜¯ä¸€è·¯ç›¸ä¼´çš„ <b>30 å¹´</b>è€å‹ï¼šé¦™æ°£æ¸…ç”œã€çº–ç¶­ç´°ç·»ã€å…¥å£åŒ–é–‹ã€‚</p>
          <p>å¾æ¡æ”¶ã€åˆ†ç´šåˆ°è£ç®±ï¼Œæˆ‘å€‘åšçš„æ¯ä¸€æ­¥åªæœ‰ä¸€å€‹ç›®çš„â€”â€”æŠŠæœ€å¥½åƒçš„æŸ‘æ©˜ï¼Œå®Œå¥½é€åˆ°ä½ æ‰‹ä¸Šã€‚<br><b>ç”¨å¿ƒç¨®æŸ‘ï¼Œèˆ‡ä½ æŸ‘å¿ƒç›¸ä¼´ã€‚</b></p>
        </div>
      </div>
      <div class="card content">
        <h2 id="newsTitle">æœ€æ–°é®®å ±ï½œæœåœ’æ—¥èªŒ</h2>
        <div class="rail-cards" id="newsRail"></div>
      </div>
    </div>
  </section>

  <!-- è¦æ ¼ç­‰ç´šï¼šç¨ç«‹å€å¡Šï¼ˆæ”¾åœ¨æœ€æ–°é®®å ±ä¸‹æ–¹ï¼‰ -->
  <section class="section">
    <div class="wrap">
      <div class="card content" style="padding-bottom:0">
        <h2 id="specTitle">å¦‚ä½•åˆ†è¾¨è¦æ ¼ç­‰ç´š</h2>
        <p id="specSub" class="muted" style="margin-top:-6px">å¿«é€Ÿäº†è§£å„ç­‰ç´šå·®ç•°ï¼ŒæŒ‘å°æœ€åˆé©çš„å£æ„Ÿèˆ‡é¡†ç²’</p>
      </div>
      <div class="rail-cards spec-cards" id="specRail" style="padding:10px 14px"></div>
    </div>
  </section>

  <!-- ç†±éŠ· -->
  <section id="hot" class="section theme-hot">
    <div class="wrap">
      <div class="card content" style="padding-bottom:0">
        <h2 id="hotTitle">ğŸ”¥ ç†±éŠ·æ¬¾</h2>
        <p id="hotSub" class="muted" style="margin-top:-6px">å¤§å®¶æœ€å¸¸å›è³¼çš„ç†±é–€è¦æ ¼</p>
      </div>
      <div class="card" style="padding:0 14px 14px">
        <div id="hotGrid" class="product-grid"></div>
      </div>
    </div>
  </section>

  <!-- å…¬è€åªæ¤ªæŸ‘ -->
  <section id="pongan" class="section theme-pongan">
    <div class="wrap">
      <div class="card content" style="padding-bottom:0">
        <h2 id="ponganTitle">å…¬è€åªæ¤ªæŸ‘ï¼ˆ50å¹´ï¼‰</h2>
        <p id="ponganSub" class="muted" style="margin-top:-6px">ç¾æ¡åˆ†ç´šï½œçš®è–„å¤šæ±ï½œé…¸ç”œå¹³è¡¡</p>
      </div>
      <div class="card" style="padding:0 14px 14px">
        <div id="ponganGrid" class="product-grid"></div>
      </div>
    </div>
  </section>

  <!-- æ±å‹¢èŒ‚è°· -->
  <section id="maogao" class="section theme-maogao">
    <div class="wrap">
      <div class="card content" style="padding-bottom:0">
        <h2 id="maogaoTitle">æ±å‹¢èŒ‚è°·ï¼ˆ30å¹´ï¼‰</h2>
        <p id="maogaoSub" class="muted" style="margin-top:-6px">é¦™æ°£æ¸…ç”œï½œçº–ç¶­ç´°ç·»ï½œå…¥å£åŒ–é–‹</p>
      </div>
      <div class="card" style="padding:0 14px 14px">
        <div id="maogaoGrid" class="product-grid"></div>
      </div>
    </div>
  </section>

  <!-- åŒ¯æ¬¾è³‡è¨Š -->
  <section class="section">
    <div class="wrap card content">
      <h2 id="bankTitle">åŒ¯æ¬¾è³‡è¨Š</h2>
      <p><strong id="bankName"></strong>ã€€æˆ¶åï¼š<strong id="bankHolder"></strong></p>
      <p>å¸³è™Ÿï¼š<strong id="bankNo"></strong></p>
      <p class="note">åŒ¯æ¬¾å®Œæˆå¾Œï¼Œæ­¡è¿åˆ°æˆ‘å€‘çš„ <a id="fbLink" href="https://www.facebook.com/profile.php?id=61581488901343" target="_blank" rel="noopener">Facebook</a> ç§è¨Šã€Œè¨‚å–®ç·¨è™Ÿï¼‹åŒ¯æ¬¾å¾Œäº”ç¢¼ã€æˆ–ç›´æ¥å›è¦†ä¿¡ä»¶é€šçŸ¥ã€Œè¨‚å–®ç·¨è™Ÿï¼‹åŒ¯æ¬¾å¾Œäº”ç¢¼ã€ï¼Œæˆ‘å€‘å°‡ç«‹å³ç‚ºæ‚¨å®‰æ’å‡ºè²¨ã€‚</p>
    </div>
  </section>

  <footer>
    <div class="wrap">
      <div class="content" style="text-align:center;padding-top:0">
        <div class="muted" id="copyright">Â© æŸ‘å¿ƒæœåœ’ï½œå…¬è€åªæ¤ªæŸ‘ãƒ»æ±å‹¢èŒ‚è°·</div>
        <div class="muted" id="contact">åœ°å€ï¼šå°ä¸­å¸‚çŸ³å²¡å€çŸ³å²¡è¡—61è™Ÿã€€|ã€€é€£çµ¡é›»è©±ï¼š0933-721-978</div>
      </div>
    </div>
  </footer>

  <!-- æç¤ºç”¨ Toast -->
  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <script>
    /** =========================
     * è¨­å®šï¼ˆå³é‚Šéƒ½æœ‰ä¸­æ–‡å‚™è¨»ï¼‰
     * ========================= */
    const CONFIG = {
      PRICES: {
        // å”®åƒ¹è¡¨
        PONGAN: {
          "10å°æ–¤": { "23A": 750, "25A": 780, "27A": 820, "30A": 880 },
          "25å°æ–¤": { "23A": 1600,"25A": 1680,"27A": 1780,"30A": 1880 }
        },
        MAOGAO: {
          "10å°æ–¤": { "23A": 720, "25A": 760, "27A": 800, "30A": 860 },
          "25å°æ–¤": { "23A": 1500,"25A": 1580,"27A": 1680,"30A": 1780 }
        }
      },
      SHIPPING: 160, // å®…é…é‹è²»ï¼ˆè¶…å•†å–è²¨ä¸€å¾‹å…é‹ï¼‰
      FREE_SHIP_THRESHOLD: 1800, // å®…é…å…é‹é–€æª»
      BANK: { name: "é€£ç·šéŠ€è¡Œ(824)", holder: "å¼µéˆæ³“", no: "11101-37823-13" },
      IMAGES: {
        // åœ–ç‰‡èˆ‡å½±ç‰‡é€£çµ
        HERO: toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/%E5%B0%81%E9%9D%A2%E5%9C%96.png"),
        LOGO: toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/%E6%9F%91%E5%BF%83%E6%9E%9C%E5%9C%92LOGO.png"),
        SPEC_GALLERY: [
          toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/%E7%AD%89%E7%B4%9A%E6%AF%94%E8%BC%83%E5%9C%96.jpg"),
          "https://via.placeholder.com/1200x800?text=%E8%A6%8F%E6%A0%BC%E5%9C%96+2",
          "https://via.placeholder.com/1200x800?text=%E8%A6%8F%E6%A0%BC%E5%9C%96+3"
        ],
        NEWS: [
          {type:"video", src:"https://raw.githubusercontent.com/s9000721-cloud/gonglaoping/main/780323577.063367.mp4", title:"æ¡æ”¶èŠ±çµ®"},
          {type:"image", src:"https://via.placeholder.com/1200x800?text=%E6%9C%80%E6%96%B0%E7%9F%AD%E5%BD%B1", title:"å±±é ‚æ™šéœ"},
          {type:"image", src:"https://via.placeholder.com/1200x800?text=%E6%9E%97%E9%96%93%E6%97%A5%E5%B8%B8", title:"æœåœ’æ—¥å¸¸"},
          {type:"video", src:"https://www.w3schools.com/html/mov_bbb.mp4", title:"åˆ†ç´šä¸Šæ¶"}
        ],
        PONGAN: {
          "10å°æ–¤-23A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/10%E6%96%A4%E5%A4%A7%E5%90%89%E5%A4%A7%E5%88%A93.jpg"),
          "10å°æ–¤-25A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/10%E6%96%A4%E5%A4%A7%E5%90%89%E5%A4%A7%E5%88%A93.jpg"),
          "10å°æ–¤-27A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/10%E6%96%A4%E5%A4%A7%E5%90%89%E5%A4%A7%E5%88%A93.jpg"),
          "10å°æ–¤-30A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/10%E6%96%A4%E5%A4%A7%E5%90%89%E5%A4%A7%E5%88%A93.jpg"),
          "25å°æ–¤-23A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/25%E6%96%A4%E6%A9%98%E5%AD%90.jpg"),
          "25å°æ–¤-25A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/25%E6%96%A4%E6%A9%98%E5%AD%90.jpg"),
          "25å°æ–¤-27A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/25%E6%96%A4%E6%A9%98%E5%AD%90.jpg"),
          "25å°æ–¤-30A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/25%E6%96%A4%E6%A9%98%E5%AD%90.jpg")
        },
        MAOGAO: {
          "10å°æ–¤-23A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/10%E6%96%A4%E5%A4%A7%E5%90%89%E5%A4%A7%E5%88%A93.jpg"),
          "10å°æ–¤-25A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/10%E6%96%A4%E5%A4%A7%E5%90%89%E5%A4%A7%E5%88%A93.jpg"),
          "10å°æ–¤-27A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/10%E6%96%A4%E5%A4%A7%E5%90%89%E5%A4%A7%E5%88%A93.jpg"),
          "10å°æ–¤-30A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/10%E6%96%A4%E5%A4%A7%E5%90%89%E5%A4%A7%E5%88%A93.jpg"),
          "25å°æ–¤-23A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/25%E6%96%A4%E6%A9%98%E5%AD%90.jpg"),
          "25å°æ–¤-25A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/25%E6%96%A4%E6%A9%98%E5%AD%90.jpg"),
          "25å°æ–¤-27A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/25%E6%96%A4%E6%A9%98%E5%AD%90.jpg"),
          "25å°æ–¤-30A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/25%E6%96%A4%E6%A9%98%E5%AD%90.jpg")
        }
      },
      GAS_ENDPOINT: "https://script.google.com/macros/s/AKfycbw5y8y1Yw7ymc7bP-iqV4KmxMB7l3c1wxMpPK1F6-d_vx_ejiIhCzhq0CyHPxDUNM92/exec",
      BRAND_TAG: "æŸ‘å¿ƒæœåœ’",
      INVENTORY: {
        "PON10-23A":{sold:0, stock:999}, "PON10-25A":{sold:0, stock:999}, "PON10-27A":{sold:0, stock:999}, "PON10-30A":{sold:0, stock:999},
        "PON25-23A":{sold:0, stock:999}, "PON25-25A":{sold:0, stock:999}, "PON25-27A":{sold:0, stock:999}, "PON25-30A":{sold:0, stock:999},
        "MAO10-23A":{sold:0, stock:999}, "MAO10-25A":{sold:0, stock:999}, "MAO10-27A":{sold:0, stock:999}, "MAO10-30A":{sold:0, stock:999},
        "MAO25-23A":{sold:0, stock:999}, "MAO25-25A":{sold:0, stock:999}, "MAO25-27A":{sold:0, stock:999}, "MAO25-30A":{sold:0, stock:999}
      }
    };

    // è½‰ raw.githubusercontentï¼ˆGitHub åœ–ç‰‡ç”¨ï¼‰
    function toRaw(u){
      if(!u) return u;
      if(u.includes('raw.githubusercontent.com')) return u;
      return u.replace('https://github.com/','https://raw.githubusercontent.com/').replace('/blob/','/');
    }

    /* ====== ç®¡ç†å“¡ç™»å…¥ï¼ˆç°¡æ˜“å¸³å¯† + è¨˜æ†¶ï¼‰ ====== */
    const ADMIN = {
      LS_KEY:'gx_admin_login',
      USER:'111111',
      PASS:'111111',
      logged(){ try{return JSON.parse(localStorage.getItem(this.LS_KEY))?.ok;}catch{return false} },
      save(ok){ localStorage.setItem(this.LS_KEY, JSON.stringify({ok:!!ok, ts:Date.now()})); }
    };

    function toggleAdmin(open){
      const d = document.getElementById('adminDrawer');
      d.classList.toggle('open', !!open);
      renderAdmin();
    }
    function logoutAdmin(){ ADMIN.save(false); invEditMode=false; renderAdmin(); renderAllGrids(); }

    // ===== ç®¡ç†é¢æ¿ï¼ˆæ”¹ç‚ºï¼šå…§å®¹å…¨é¢å¯ç·¨è¼¯ + RAW é€£çµè½‰æ›å™¨ï¼‰ =====
    function renderAdmin(){
      const box = document.getElementById('adminBody');
      if(!ADMIN.logged()){
        box.innerHTML = [
          '<h3>ç®¡ç†å“¡ç™»å…¥</h3>',
          '<div class="note">æ­¤ç™»å…¥åªè¨˜æ†¶åœ¨æœ¬è£ç½®ï¼Œå‹¿åœ¨å…¬å…±é›»è…¦ä½¿ç”¨ã€‚</div>',
          '<div class="line"></div>',
          '<div class="form">',
            '<div class="label">å¸³è™Ÿ</div>',
            '<input class="input" id="admUser" placeholder="è¼¸å…¥å¸³è™Ÿ">',
            '<div class="label">å¯†ç¢¼</div>',
            '<input class="input" id="admPass" type="password" placeholder="è¼¸å…¥å¯†ç¢¼">',
            '<button class="btn" style="margin-top:10px" onclick="doAdminLogin()">ç™»å…¥</button>',
          '</div>'
        ].join('');
      }else{
        // å·²ç™»å…¥ï¼šé¡¯ç¤ºå¿«é€Ÿç·¨è¼¯èˆ‡å„²å­˜éˆ•
        box.innerHTML = [
          '<h3>å¿«é€Ÿç·¨è¼¯ï¼ˆæ•´ç«™å…§å®¹ï¼‰</h3>',
          '<p class="note">é€™è£¡çš„ä¿®æ”¹æœƒ<strong>ä¿å­˜åˆ°æœ¬æ©Ÿ</strong>ï¼ˆlocalStorageï¼‰ã€‚è‹¥ä½ è¦æ›é›»è…¦æˆ–æ¸…é™¤ç€è¦½å™¨è³‡æ–™ï¼Œè«‹å…ˆæŠŠè³‡æ–™åŒ¯å‡ºå‚™ä»½ã€‚</p>',
          '<div class="line"></div>',
          // RAW é€£çµè½‰æ›å™¨
          '<div class="card content">',
            '<h4>RAW é€£çµè½‰æ›å™¨ï¼ˆåœ–ç‰‡ / å½±ç‰‡ï¼‰</h4>',
            '<p class="note">æŠŠ GitHub æª”æ¡ˆé ç¶²å€è²¼ä¸Šï¼ˆä¾‹å¦‚ https://github.com/.../blob/main/xxx.jpgï¼‰ï¼ŒæŒ‰ä¸€ä¸‹å³å¯è®Šæˆå¯ç›´æ¥å¼•ç”¨çš„ raw é€£çµã€‚</p>',
            '<div class="adm-row">',
              '<input class="input" id="rawIn" placeholder="è²¼ä¸Š GitHub æª”æ¡ˆç¶²å€ã€æˆ–å…¶å®ƒåœ–ç‰‡/å½±ç‰‡ç¶²å€">',
              '<div style="display:flex;gap:8px">',
                '<button class="btn" onclick="doRawConvert()">è½‰æ›</button>',
                '<button class="btn-ghost" onclick="copyRawOut()">è¤‡è£½çµæœ</button>',
              '</div>',
            '</div>',
            '<div class="help">è½‰æ›çµæœï¼š</div>',
            '<input class="input" id="rawOut" readonly placeholder="è½‰æ›å¾Œæœƒå‡ºç¾åœ¨é€™è£¡">',
          '</div>',
          '<div class="line"></div>',
          // Hero / å°è¦½
          '<div class="card content">',
            '<h4>é¦–é  Hero / å°è¦½æ–‡å­—</h4>',
            '<div class="adm-row">',
              '<div><div class="label">å“ç‰Œæ¨™èªŒï¼ˆLOGO é€£çµï¼‰</div><input class="input" id="admLogo" value="'+(CONFIG.IMAGES.LOGO||'')+'"></div>',
              '<div><div class="label">å°é¢èƒŒæ™¯ï¼ˆHERO åœ–ï¼‰</div><input class="input" id="admHero" value="'+(CONFIG.IMAGES.HERO||'')+'"></div>',
            '</div>',
            '<div class="adm-row">',
              '<div><div class="label">å°é¢æ¨™ç±¤ï¼ˆPillï¼‰</div><input class="input" id="admHeroPill" value="'+(document.getElementById('heroPill').textContent||'')+'"></div>',
              '<div><div class="label">æŒ‰éˆ•æ–‡å­—ï¼ˆé¦¬ä¸Šé¸è³¼ï¼‰</div><input class="input" id="admBtnText" value="'+(document.getElementById('shopNowBtn').textContent||'é¦¬ä¸Šé¸è³¼')+'"></div>',
            '</div>',
            '<div class="label">ä¸»æ¨™é¡Œï¼ˆH1ï¼‰</div><input class="input" id="admHeroTitle" value="'+(document.getElementById('heroTitle').textContent||'')+'">',
            '<div class="label">å‰¯æ¨™ï¼ˆæ®µè½ï¼‰</div><textarea class="input" id="admHeroDesc" rows="3">'+(document.getElementById('heroDesc').textContent||'')+'</textarea>',
            '<div style="margin-top:8px"><button class="btn" onclick="saveHero()">ç¢ºèªä¿®æ”¹ï¼ˆHeroï¼‰</button></div>',
          '</div>',
          '<div class="line"></div>',
          // é—œæ–¼æˆ‘å€‘
          '<div class="card content">',
            '<h4>é—œæ–¼æˆ‘å€‘å¡ç‰‡</h4>',
            '<div class="label">æ¨™é¡Œ</div><input class="input" id="admAboutTitle" value="'+(document.getElementById('aboutTitle').textContent||'')+'">',
            '<div class="label">å…§å®¹ï¼ˆå¯è¼¸å…¥ HTMLï¼Œæ›è¡Œè«‹ç”¨ &lt;br&gt;ï¼‰</div>',
            '<textarea class="input" id="admAboutHtml" rows="6">'+(document.getElementById('aboutHtml').innerHTML||'')+'</textarea>',
            '<div style="margin-top:8px"><button class="btn" onclick="saveAbout()">ç¢ºèªä¿®æ”¹ï¼ˆé—œæ–¼æˆ‘å€‘ï¼‰</button></div>',
          '</div>',
          '<div class="line"></div>',
          // æœ€æ–°é®®å ±
          '<div class="card content">',
            '<h4>æœ€æ–°é®®å ±ï¼ˆåœ– / å½±ç‰‡ å¡ç‰‡è¼ªæ’­ï¼‰</h4>',
            '<p class="note">è«‹è²¼ä¸Šæ¯ä¸€å‰‡çš„ã€Œé¡å‹ image æˆ– videoã€é€£çµã€æ¨™é¡Œã€ã€‚</p>',
            '<div id="admNewsList"></div>',
            '<div style="margin-top:8px;display:flex;gap:8px">',
              '<button class="btn" onclick="addNewsItem()">æ–°å¢ä¸€å‰‡</button>',
              '<button class="btn" onclick="saveNews()">ç¢ºèªä¿®æ”¹ï¼ˆæœ€æ–°é®®å ±ï¼‰</button>',
            '</div>',
          '</div>',
          '<div class="line"></div>',
          // è¦æ ¼ç­‰ç´šåœ–
          '<div class="card content">',
            '<h4>è¦æ ¼ç­‰ç´šåœ–ï¼ˆæ©«å‘è¼ªæ’­ï¼‰</h4>',
            '<div id="admSpecList"></div>',
            '<div style="margin-top:8px;display:flex;gap:8px">',
              '<button class="btn" onclick="addSpecImg()">æ–°å¢ä¸€å¼µ</button>',
              '<button class="btn" onclick="saveSpec()">ç¢ºèªä¿®æ”¹ï¼ˆè¦æ ¼ç­‰ç´šï¼‰</button>',
            '</div>',
          '</div>',
          '<div class="line"></div>',
          // å€å¡Šæ¨™é¡Œå€‘
          '<div class="card content">',
            '<h4>å„å€å¡Šæ¨™é¡Œ / èªªæ˜æ–‡å­—</h4>',
            '<div class="adm-grid-3">',
              '<div><div class="label">ç†±éŠ·æ¬¾æ¨™é¡Œ</div><input class="input" id="admHotTitle" value="'+(document.getElementById('hotTitle').textContent||'')+'"><div class="label">èªªæ˜</div><input class="input" id="admHotSub" value="'+(document.getElementById('hotSub').textContent||'')+'"></div>',
              '<div><div class="label">æ¤ªæŸ‘æ¨™é¡Œ</div><input class="input" id="admPonganTitle" value="'+(document.getElementById('ponganTitle').textContent||'')+'"><div class="label">èªªæ˜</div><input class="input" id="admPonganSub" value="'+(document.getElementById('ponganSub').textContent||'')+'"></div>',
              '<div><div class="label">èŒ‚è°·æ¨™é¡Œ</div><input class="input" id="admMaogaoTitle" value="'+(document.getElementById('maogaoTitle').textContent||'')+'"><div class="label">èªªæ˜</div><input class="input" id="admMaogaoSub" value="'+(document.getElementById('maogaoSub').textContent||'')+'"></div>',
            '</div>',
            '<div style="margin-top:8px"><button class="btn" onclick="saveSectionTitles()">ç¢ºèªä¿®æ”¹ï¼ˆå€å¡Šæ¨™é¡Œï¼‰</button></div>',
          '</div>',
          '<div class="line"></div>',
          // ç”¢å“å¡ç‰‡ï¼ˆåœ–ç‰‡ / æ¨™é¡Œ / å”®åƒ¹ / ç‹€æ…‹ï¼‰
          '<div class="card content">',
            '<h4>ç”¢å“å¡ç‰‡ï¼ˆåœ–ç‰‡ / æ¨™é¡Œ / å”®åƒ¹ / é è³¼ / å”®å®Œï¼‰</h4>',
            '<p class="note">ç›´æ¥åœ¨å„ç”¢å“å¡ä¸Šç·¨è¼¯ï¼š<b>å“åï¼ˆå¯é»æ–‡å­—ä¿®æ”¹ï¼‰ / åƒ¹æ ¼ï¼ˆè¼¸å…¥æ¡†ï¼‰ / åœ–ç‰‡ï¼ˆç¶²å€ï¼‰ / åº«å­˜ï¼ˆé½’è¼ªé–‹å•Ÿï¼‰ / ç‹€æ…‹ï¼ˆé è³¼ / å”®å®Œï¼‰</b>ã€‚ç·¨å®Œå¾ŒæŒ‰ä¸‹æ–¹ã€Œå„²å­˜ä¿®æ”¹ã€ã€‚</p>',
            '<div style="display:flex;gap:8px;flex-wrap:wrap">',
              '<button class="btn" onclick="saveOverrides()">å„²å­˜ä¿®æ”¹ï¼ˆåƒ¹æ ¼/åœ–ç‰‡/æ¨™é¡Œ/ç‹€æ…‹ï¼‰</button>',
              '<button class="btn-ghost" onclick="resetOverrides()">æ¸…é™¤æœ¬æ©Ÿè¦†å¯«ï¼ˆé‚„åŸå‡ºå» ï¼‰</button>',
              '<button class="btn-ghost" onclick="exportOverrides()">åŒ¯å‡ºå‚™ä»½</button>',
              '<button class="btn-ghost" onclick="importOverrides()">åŒ¯å…¥å‚™ä»½</button>',
            '</div>',
          '</div>'
        ].join('');
        // æ¸²æŸ“å‹•æ…‹æ¸…å–®ï¼ˆNews / Specï¼‰
        renderAdminNews();
        renderAdminSpec();
      }
    }

    function doAdminLogin(){
      const u = document.getElementById('admUser').value.trim();
      const p = document.getElementById('admPass').value.trim();
      if(u===ADMIN.USER && p===ADMIN.PASS){ ADMIN.save(true); alert('ç™»å…¥æˆåŠŸ'); renderAdmin(); }
      else alert('å¸³å¯†éŒ¯èª¤');
    }

    /* ===== RAW è½‰æ›å™¨ ===== */
    function doRawConvert(){
      const v = (document.getElementById('rawIn').value||'').trim();
      document.getElementById('rawOut').value = toRaw(v);
    }
    function copyRawOut(){
      const out = document.getElementById('rawOut');
      out.select(); document.execCommand('copy');
      showToast('å·²è¤‡è£½ RAW é€£çµ');
    }

    /* ===== ç”¢å“æ¸…å–® ===== */
    const PONGAN = [
      { id:"PON10-23A", section:"PONGAN", title:"æ¤ªæŸ‘ï½œ10å°æ–¤ï½œ23A", weight:"10å°æ–¤", size:"23A" },
      { id:"PON10-25A", section:"PONGAN", title:"æ¤ªæŸ‘ï½œ10å°æ–¤ï½œ25A", weight:"10å°æ–¤", size:"25A" },
      { id:"PON10-27A", section:"PONGAN", title:"æ¤ªæŸ‘ï½œ10å°æ–¤ï½œ27A", weight:"10å°æ–¤", size:"27A" },
      { id:"PON10-30A", section:"PONGAN", title:"æ¤ªæŸ‘ï½œ10å°æ–¤ï½œ30A", weight:"10å°æ–¤", size:"30A" },
      { id:"PON25-23A", section:"PONGAN", title:"æ¤ªæŸ‘ï½œ25å°æ–¤ï½œ23A", weight:"25å°æ–¤", size:"23A" },
      { id:"PON25-25A", section:"PONGAN", title:"æ¤ªæŸ‘ï½œ25å°æ–¤ï½œ25A", weight:"25å°æ–¤", size:"25A" },
      { id:"PON25-27A", section:"PONGAN", title:"æ¤ªæŸ‘ï½œ25å°æ–¤ï½œ27A", weight:"25å°æ–¤", size:"27A" },
      { id:"PON25-30A", section:"PONGAN", title:"æ¤ªæŸ‘ï½œ25å°æ–¤ï½œ30A", weight:"25å°æ–¤", size:"30A" },
    ];
    const MAOGAO = [
      { id:"MAO10-23A", section:"MAOGAO", title:"èŒ‚è°·ï½œ10å°æ–¤ï½œ23A", weight:"10å°æ–¤", size:"23A" },
      { id:"MAO10-25A", section:"MAOGAO", title:"èŒ‚è°·ï½œ10å°æ–¤ï½œ25A", weight:"10å°æ–¤", size:"25A" },
      { id:"MAO10-27A", section:"MAOGAO", title:"èŒ‚è°·ï½œ10å°æ–¤ï½œ27A", weight:"10å°æ–¤", size:"27A" },
      { id:"MAO10-30A", section:"MAOGAO", title:"èŒ‚è°·ï½œ10å°æ–¤ï½œ30A", weight:"10å°æ–¤", size:"30A" },
      { id:"MAO25-23A", section:"MAOGAO", title:"èŒ‚è°·ï½œ25å°æ–¤ï½œ23A", weight:"25å°æ–¤", size:"23A" },
      { id:"MAO25-25A", section:"MAOGAO", title:"èŒ‚è°·ï½œ25å°æ–¤ï½œ25A", weight:"25å°æ–¤", size:"25A" },
      { id:"MAO25-27A", section:"MAOGAO", title:"èŒ‚è°·ï½œ25å°æ–¤ï½œ27A", weight:"25å°æ–¤", size:"27A" },
      { id:"MAO25-30A", section:"MAOGAO", title:"èŒ‚è°·ï½œ25å°æ–¤ï½œ30A", weight:"25å°æ–¤", size:"30A" },
    ];

    /* ===== LocalStorage Keys ===== */
    const LS = {
      cart: 'gx_cart',
      shipMethod: 'gx_ship_method',
      form: 'gx_form',
      inventory: 'gx_inventory',
      overrides: 'gx_overrides'
    };

    /* ===== åŒ¯æ¬¾è³‡è¨Šèˆ‡åœ–ç‰‡å¸¶å…¥ï¼ˆé¦–æ¬¡ï¼‰ ===== */
    document.getElementById('bankName').textContent = CONFIG.BANK.name;
    document.getElementById('bankHolder').textContent = CONFIG.BANK.holder;
    document.getElementById('bankNo').textContent = CONFIG.BANK.no;
    document.getElementById('hero').style.backgroundImage = `url('${CONFIG.IMAGES.HERO}')`;
    document.getElementById('logoImg').src = CONFIG.IMAGES.LOGO;
    document.getElementById('freeShipText').textContent = 'NT$ ' + CONFIG.FREE_SHIP_THRESHOLD.toLocaleString();

    /* ===== åƒ¹æ ¼/åœ–ç‰‡å·¥å…· ===== */
    const priceOf = (section,weight,size)=> CONFIG.PRICES[section]?.[weight]?.[size] ?? 0;
    const currency = n => "NT$ "+(n||0).toLocaleString();
    const imgFor = (section,weight,size)=> CONFIG.IMAGES[section]?.[`${weight}-${size}`] || 'https://via.placeholder.com/800x600?text=Image';

    // è¦†å¯«ä¿å­˜ï¼šåƒ¹æ ¼ / åœ–ç‰‡ / æ¨™é¡Œ / ç”¢å“ç‹€æ…‹
    function setPrice(section,weight,size,val){
      if(!CONFIG.PRICES[section]) CONFIG.PRICES[section]={};
      if(!CONFIG.PRICES[section][weight]) CONFIG.PRICES[section][weight]={};
      CONFIG.PRICES[section][weight][size] = Math.max(0, parseInt(val||0));
      saveOverrides();
    }
    function setImage(section,weight,size,url){
      if(!CONFIG.IMAGES[section]) CONFIG.IMAGES[section]={};
      CONFIG.IMAGES[section][`${weight}-${size}`] = url.trim();
      saveOverrides();
      renderAllGrids();
    }

    /* ===== è³¼ç‰©è»Š ===== */
    const cart = loadCart();
    function loadCart(){ try{ const s = localStorage.getItem(LS.cart); return s? JSON.parse(s):[]; }catch{ return []; } }
    function saveCart(){ localStorage.setItem(LS.cart, JSON.stringify(cart)); }

    /* ===== å‰ç«¯åº«å­˜ ===== */
    let INV = loadInventory();
    function loadInventory(){
      try{ const s = localStorage.getItem(LS.inventory); return s ? JSON.parse(s) : JSON.parse(JSON.stringify(CONFIG.INVENTORY)); }
      catch{ return JSON.parse(JSON.stringify(CONFIG.INVENTORY)); }
    }
    function saveInventory(){ localStorage.setItem(LS.inventory, JSON.stringify(INV)); }

    // ç”¢å“ç‹€æ…‹ï¼ˆnormal / preorder / soldoutï¼‰
    let STATUS = {};  // { [productId]: 'normal'|'preorder'|'soldout' }
    function setStatus(id, val){ STATUS[id] = val; saveOverrides(); renderAllGrids(); }

    let invEditMode = false;
    function toggleInvEdit(){
      if(!ADMIN.logged()){ toggleAdmin(true); return; }
      invEditMode = !invEditMode; renderAllGrids();
    }

    /* ===== è¦†å¯«ï¼ˆæ¨™é¡Œ/åœ–ç‰‡/åƒ¹æ ¼/ç‹€æ…‹ï¼‰å„²å­˜ ===== */
    function saveOverrides(){
      const map = { PRICES: CONFIG.PRICES, IMAGES: CONFIG.IMAGES, TITLES: collectTitles(), STATUS: STATUS };
      localStorage.setItem(LS.overrides, JSON.stringify(map));
      showToast('å·²å„²å­˜åˆ°æœ¬æ©Ÿ');
    }
    function loadOverrides(){
      try{
        const s = localStorage.getItem(LS.overrides);
        if(!s) return;
        const o = JSON.parse(s);
        if(o.PRICES) CONFIG.PRICES = o.PRICES;
        if(o.IMAGES) CONFIG.IMAGES = o.IMAGES;
        if(o.TITLES) applyTitles(o.TITLES);
        if(o.STATUS) STATUS = o.STATUS;
      }catch{}
    }
    function resetOverrides(){
      if(!confirm('ç¢ºå®šæ¸…é™¤æœ¬æ©Ÿè¦†å¯«ï¼Ÿï¼ˆåƒ¹æ ¼/åœ–ç‰‡/æ¨™é¡Œ/ç‹€æ…‹ï¼‰')) return;
      localStorage.removeItem(LS.overrides);
      loadOverrides(); // nothing
      location.reload();
    }
    function exportOverrides(){
      const s = localStorage.getItem(LS.overrides) || '{}';
      const blob = new Blob([s], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'æŸ‘å¿ƒæœåœ’_è¨­å®šå‚™ä»½.json'; a.click();
      URL.revokeObjectURL(url);
    }
    function importOverrides(){
      const input = document.createElement('input');
      input.type='file'; input.accept='.json,application/json';
      input.onchange = ()=>{
        const file = input.files[0]; if(!file) return;
        const fr = new FileReader();
        fr.onload = ()=>{
          try{
            localStorage.setItem(LS.overrides, fr.result);
            alert('åŒ¯å…¥æˆåŠŸï¼Œå°‡é‡æ–°æ•´ç†é é¢'); location.reload();
          }catch(e){ alert('åŒ¯å…¥å¤±æ•—ï¼š'+e.message); }
        };
        fr.readAsText(file);
      };
      input.click();
    }

    function collectTitles(){ const t = {}; [...PONGAN, ...MAOGAO].forEach(p=>{ t[p.id]=p.title; }); return t; }
    function applyTitles(map){ [...PONGAN, ...MAOGAO].forEach(p=>{ if(map[p.id]) p.title = map[p.id]; }); }

    /* ===== æ¸²æŸ“ç”¢å“å¡ç‰‡ï¼ˆç™»å…¥å¯ç·¨è¼¯ï¼‰ ===== */
    function productCard(p){
      const price = priceOf(p.section, p.weight, p.size);
      const img = imgFor(p.section, p.weight, p.size);
      const isHot = p.size==='25A';
      const inv = INV[p.id] || {sold:0,stock:999};
      const editable = ADMIN.logged();
      const st = STATUS[p.id] || 'normal';
      const soldout = st==='soldout';
      const preorder = st==='preorder';

      const statusBadge = soldout ? '<span class="status-badge status-soldout">å·²å”®å®Œ</span>' :
                          (preorder ? '<span class="status-badge status-preorder">é–‹æ”¾é è³¼</span>' : '');

      return `
      <article class="product card ${soldout?'soldout':''}">
        ${statusBadge}
        <img src="${img}" alt="${p.title}">
        <div class="body">
          <div class="row-between" style="gap:8px">
            <h3 class="title" ${editable?'contenteditable="true" onblur="editTitle(\\'${p.id}\\', this.textContent.trim())"':''}>${p.title}</h3>
            ${isHot ? '<span class="tag-hot" aria-label="ç†±éŠ·">ğŸ”¥ ç†±éŠ·</span>' : ''}
          </div>
          <div class="note" style="margin-top:6px"> å·²å”®å‡º ${inv.sold}ã€€å‰©é¤˜ ${inv.stock} ç®± </div>
          <div class="price" style="margin:6px 0 10px">
            ${editable
              ? `<input type="number" value="${price}" style="width:120px" onblur="setPrice('${p.section}','${p.weight}','${p.size}', this.value)">`
              : `${currency(price)}`}
          </div>
          ${editable ? `
            <div class="note" style="display:flex;gap:6px;align-items:center;flex-wrap:wrap;margin:6px 0 10px">
              <span>åœ–ç‰‡ç¶²å€</span>
              <input type="url" value="${img}" style="flex:1;min-width:140px" onblur="setImage('${p.section}','${p.weight}','${p.size}', this.value)">
              <label style="display:flex;gap:6px;align-items:center">
                <input type="checkbox" ${preorder?'checked':''} onchange="setStatus('${p.id}', this.checked ? 'preorder' : (STATUS['${p.id}']==='soldout'?'soldout':'normal'))"> é è³¼
              </label>
              <label style="display:flex;gap:6px;align-items:center">
                <input type="checkbox" ${soldout?'checked':''} onchange="setStatus('${p.id}', this.checked ? 'soldout' : (STATUS['${p.id}']==='preorder'?'preorder':'normal'))"> å”®å®Œ
              </label>
            </div>
          ` : ''}
          <button class="btn btn-block" ${soldout?'disabled':''} onclick="addToCart('${p.id}')" aria-label="åŠ å…¥è³¼ç‰©è»Š">${soldout?'å·²å”®å®Œ':(preorder?'é è³¼åŠ å…¥':'è³¼è²·')}</button>
          ${invEditMode ? `
            <div class="note" style="margin-top:8px;display:flex;gap:6px;align-items:center;flex-wrap:wrap">
              <span>å·²å”®å‡º</span><input type="number" min="0" value="${inv.sold}" style="width:80px" onchange="editInv('${p.id}','sold',this.value)">
              <span>å‰©é¤˜</span><input type="number" min="0" value="${inv.stock}" style="width:80px" onchange="editInv('${p.id}','stock',this.value)">
            </div>
          ` : '' }
        </div>
      </article>`;
    }

    function editTitle(id, val){
      const item = [...PONGAN, ...MAOGAO].find(x=>x.id===id);
      if(item){ item.title = val || item.title; saveOverrides(); renderAllGrids(); }
    }
    function editInv(id,key,val){
      if(!INV[id]) INV[id]={sold:0,stock:0};
      INV[id][key] = Math.max(0, parseInt(val||0));
      saveInventory(); renderAllGrids();
    }
    function renderGrid(elId, items){
      const el = document.getElementById(elId);
      el.innerHTML = items.map(productCard).join('');
    }
    function renderAllGrids(){
      renderGrid('hotGrid', HOT);
      renderGrid('ponganGrid', PONGAN);
      renderGrid('maogaoGrid', MAOGAO);
    }

    /* ç†±éŠ·ï¼šç›®å‰ç”¨ 25A åšä»£è¡¨ï¼Œå¯æ”¹ç‚ºå…¶å®ƒè¦å‰‡ */
    const HOT = [...PONGAN, ...MAOGAO].filter(p=>p.size==='25A');

    /* åˆå§‹åŒ–æ»‘å‹•ç‰† */
    function renderSpecRail(){
      const rail = document.getElementById('specRail');
      rail.innerHTML = (CONFIG.IMAGES.SPEC_GALLERY||[]).map(src=> `
        <div class="card"><img src="${src}" alt="è¦æ ¼ç­‰ç´šèªªæ˜" style="width:100%;height:auto;display:block;border-radius:16px"></div>
      `).join('');
    }
    function renderNewsRail(){
      const rail = document.getElementById('newsRail');
      rail.innerHTML = (CONFIG.IMAGES.NEWS||[]).map(item=>{
        if(item.type==='video'){
          return `
            <div class="card" style="overflow:hidden">
              <video src="${item.src}" controls style="width:100%;height:100%;display:block"></video>
              <div class="content" style="padding:10px">${item.title||''}</div>
            </div>`;
        }else{
          return `
            <div class="card">
              <img src="${item.src}" alt="${item.title||''}" style="width:100%;height:auto;display:block;border-radius:16px 16px 0 0">
              <div class="content" style="padding:10px">${item.title||''}</div>
            </div>`;
        }
      }).join('');
    }

    /* ===== è³¼ç‰©è»Šæµç¨‹ï¼ˆåŠ å…¥è³¼ç‰©è»Šä¸è‡ªå‹•è·³å‡ºï¼‰ ===== */
    function addToCart(pid){
      const src = [...PONGAN, ...MAOGAO].find(x=>x.id===pid);
      if(!src) return;
      const price = priceOf(src.section, src.weight, src.size);
      const existed = cart.find(x=>x.id===pid);
      if(existed) existed.qty++;
      else cart.push({ id:src.id, title:src.title, price, qty:1, weight:src.weight, size:src.size, section:src.section });
      saveCart(); renderCart();
      showToast('å·²åŠ å…¥è³¼ç‰©è»Š');
      // ä¸è‡ªå‹•é–‹å•ŸæŠ½å±œ
    }
    function mutateQty(i,delta){
      cart[i].qty += delta;
      if(cart[i].qty<=0) cart.splice(i,1);
      saveCart(); renderCart();
    }
    function clearCart(){
      if(!cart.length) return;
      if(confirm('ç¢ºå®šè¦æ¸…ç©ºè³¼ç‰©è»Šï¼Ÿ')){ cart.length = 0; saveCart(); renderCart(); }
    }
    function calc(){
      const method = getShipMethod();
      const subtotal = cart.reduce((s,i)=>s+i.price*i.qty,0);
      let shipping = 0;
      if(method==='CVS') shipping = 0;
      else shipping = (subtotal>=CONFIG.FREE_SHIP_THRESHOLD || cart.length===0) ? 0 : CONFIG.SHIPPING;
      return {subtotal, shipping, total: subtotal+shipping};
    }
    function renderCart(){
      const list = document.getElementById('cartList');
      if(!cart.length){
        list.innerHTML = `<div class="muted">è³¼ç‰©è»Šæ˜¯ç©ºçš„ï¼Œå»æŒ‘å¹¾é¡†æœ€é ‚çš„æ©˜å­å§ ğŸŠ</div>`;
      }else{
        list.innerHTML = cart.map((c,i)=> `
          <div class="cart-row">
            <div>
              <div><strong>${c.title}</strong></div>
              <div class="note">${currency(c.price)} Ã— ${c.qty}</div>
            </div>
            <div class="qty">
              <button aria-label="æ¸›å°‘" onclick="mutateQty(${i},-1)">â€“</button>
              <span>${c.qty}</span>
              <button aria-label="å¢åŠ " onclick="mutateQty(${i},1)">ï¼‹</button>
            </div>
          </div>`).join('');
      }
      const {subtotal,shipping,total} = calc();
      document.getElementById('subtotal').textContent = currency(subtotal);
      document.getElementById('shipping').textContent = currency(shipping);
      document.getElementById('total').textContent = currency(total);
      document.getElementById('fabCount').textContent = cart.reduce((s,i)=>s+i.qty,0);
      // æ›´æ–°é…é€æ¨™ç±¤
      const method = getShipMethod();
      document.getElementById('shipLabel').textContent = method==='CVS' ? 'é‹è²»ï¼ˆè¶…å•†å–è²¨ï½œå…é‹ï¼‰' : 'é‹è²»ï¼ˆå®…é…ï¼‰';
      // è¡¨å–®åŒæ­¥é¸å–®
      const shipSel = document.querySelector('select[name="ship"]');
      if(shipSel){ shipSel.value = method==='CVS' ? 'è¶…å•†å–è²¨' : 'å®…é…'; }
      // æ¬„ä½äº’æ–¥
      document.getElementById('homeFields').style.display = (method==='HOME') ? 'block':'none';
      document.getElementById('cvsFields').style.display = (method==='CVS') ? 'block':'none';
      document.querySelector('input[name="addr"]')?.toggleAttribute('required', method==='HOME');
    }

    /* æŠ½å±œåˆ‡æ› */
    function toggleDrawer(open){ document.getElementById('drawer').classList.toggle('open', !!open); }
    function toggleQuery(open){ document.getElementById('queryDrawer').classList.toggle('open', !!open); }

    /* é…é€æ–¹å¼åˆ‡æ› + é™åˆ¶æ¢ä»¶ï¼ˆè¶…å•†ï¼š10æ–¤Ã—1ï¼‰ */
    function getShipMethod(){ return localStorage.getItem(LS.shipMethod) || 'HOME'; }
    function setShipMethod(m){
      if(m==='CVS'){
        const ok = cart.length===1 && cart[0].weight==='10å°æ–¤' && cart[0].qty===1;
        if(!ok){ alert('è¶…å•†å–è²¨é™ã€Œå–®ä¸€ 10 å°æ–¤ Ã— 1 ç®±ã€ã€‚è«‹èª¿æ•´è³¼ç‰©è»Šæ•¸é‡å¾Œå†é¸æ“‡ã€‚'); m = 'HOME'; }
      }
      localStorage.setItem(LS.shipMethod, m);
      document.getElementById('shipHomeBtn').className = (m==='HOME') ? 'btn' : 'btn-ghost';
      document.getElementById('shipCvsBtn').className = (m==='CVS') ? 'btn' : 'btn-ghost';
      renderCart();
    }

    /* å¹³æ»‘æ²å‹•ï¼ˆæ‰£æ‰ subnav é«˜åº¦ï¼‰ */
    function go(e,id){
      if(e) e.preventDefault();
      const el = document.getElementById(id);
      if(!el) return;
      const navH = document.querySelector('.subnav')?.offsetHeight || 0;
      const y = el.getBoundingClientRect().top + window.scrollY - navH - 6;
      window.scrollTo({top:y,behavior:'smooth'});
    }

    /* è¡¨å–®è¨˜æ†¶ */
    function saveForm(){
      const f = document.getElementById('orderForm');
      const obj = Object.fromEntries(new FormData(f));
      obj.shipMethod = getShipMethod();
      localStorage.setItem(LS.form, JSON.stringify(obj));
    }
    function loadForm(){
      try{
        const s = localStorage.getItem(LS.form);
        if(!s) return;
        const obj = JSON.parse(s);
        const f = document.getElementById('orderForm');
        for(const k in obj){ if(f[k]) f[k].value = obj[k]; }
        setShipMethod(obj.shipMethod || 'HOME');
      }catch{}
    }

    /* é€å–®åˆ° GAS */
    async function submitOrder(ev){
      ev.preventDefault();
      if(!cart.length){ alert("è³¼ç‰©è»Šæ˜¯ç©ºçš„"); return; }
      const agree = document.getElementById('agree');
      if(!agree.checked){ alert('è«‹å…ˆé–±è®€ã€Œç‰©æµèˆ‡é€€è²¨èªªæ˜ã€ä¸¦å‹¾é¸åŒæ„'); return; }
      const f = new FormData(ev.target);
      f.set('ship', getShipMethod()==='CVS' ? 'è¶…å•†å–è²¨' : f.get('ship'));
      const method = getShipMethod();
      if(method==='CVS'){
        const ok = cart.length===1 && cart[0].weight==='10å°æ–¤' && cart[0].qty===1;
        if(!ok){ alert('è¶…å•†å–è²¨é™ã€Œå–®ä¸€ 10 å°æ–¤ Ã— 1 ç®±ã€ã€‚'); return; }
      }
      for (const key of ['name','phone','email']){ if(!f.get(key)){ alert('è«‹å®Œæ•´å¡«å¯«è¨‚å–®è³‡æ–™'); return; } }
      if(method==='HOME' && !f.get('addr')){ alert('è«‹å¡«å¯«å®…é…åœ°å€'); return; }

      const payload = {
        ts: new Date().toISOString(),
        name: f.get('name'), phone: f.get('phone'), email: f.get('email'),
        addr: method==='CVS' ? `${f.get('cvsBrand')||''} ${f.get('cvsStore')||''}ï¼ˆè¶…å•†å–è²¨ï¼‰` : (f.get('addr')||''),
        ship: method==='CVS' ? 'è¶…å•†å–è²¨' : f.get('ship'),
        remark: f.get('remark')||'',
        items: cart.map(c=>({title:c.title, section:c.section, weight:c.weight, size:c.size, price:c.price, qty:c.qty})),
        summary: calc(),
        brand: CONFIG.BRAND_TAG,
        shipMeta: { method, cvsBrand: f.get('cvsBrand')||'', cvsStore: f.get('cvsStore')||'' }
      };

      const btn = document.getElementById('submitBtn');
      const resBox = document.getElementById('result');
      btn.disabled = true; btn.textContent = 'é€å‡ºè¨‚å–®ä¸­ï¼Œè«‹ç¨ç­‰â€¦'; resBox.textContent = '';
      try{
        const r = await fetch(CONFIG.GAS_ENDPOINT, {method:'POST', body: JSON.stringify(payload)});
        const data = await r.json();
        if(data.ok){
          resBox.innerHTML = `âœ… è¨‚å–®å·²å»ºç«‹ï¼ˆç·¨è™Ÿï¼š<b>${data.order_no}</b>ï¼‰ã€‚<br>æˆ‘å€‘å·²æŠŠåŒ¯æ¬¾è³‡è¨Šå¯„è‡³ <b>${payload.email}</b>ï¼Œè«‹æ–¼ 24 å°æ™‚å…§å®ŒæˆåŒ¯æ¬¾ä»¥ä¿ç•™åº«å­˜ã€‚`;
          cart.length = 0; saveCart(); renderCart(); ev.target.reset(); saveForm();
        }else{
          resBox.textContent = 'é€å‡ºå¤±æ•—ï¼š'+(data.msg||'æœªçŸ¥éŒ¯èª¤');
        }
      }catch(e){
        resBox.textContent = 'é€å‡ºå¤±æ•—ï¼š'+ e.message;
      }finally{
        btn.disabled = false; btn.textContent = 'é€å‡ºè¨‚å–®';
      }
    }

    /* è¨‚å–®æŸ¥è©¢ï¼ˆåªç”¨è¨‚å–®ç·¨è™Ÿï¼‰ */
    async function queryOrder(ev){
      ev.preventDefault();
      const f = new FormData(ev.target);
      const no = (f.get('orderNo')||'').trim();
      const card = document.getElementById('queryCard');
      const dlBtn = document.getElementById('dlPngBtn');
      const printBtn = document.getElementById('printBtn');
      card.style.display = 'block'; card.innerHTML = 'æŸ¥è©¢ä¸­â€¦';
      dlBtn.style.display = 'none'; printBtn.style.display = 'none';
      try{
        const url = CONFIG.GAS_ENDPOINT + '?orderNo=' + encodeURIComponent(no);
        const r = await fetch(url); const data = await r.json();
        if(data.ok){
          const s = data.status || 'ï¼ˆæœªæä¾›ç‹€æ…‹ï¼‰';
          const total = data.total ? `NT$ ${(data.total||0).toLocaleString()}` : 'â€”';
          const shipDate = data.shipDate || 'â€”';
          const trackNo = data.trackingNo || 'â€”';
          const trackLink = data.trackingNo ? `<a href="https://www.hct.com.tw/searchWaybill.aspx?no=${encodeURIComponent(data.trackingNo)}" target="_blank" rel="noopener">æ–°ç«¹è²¨é‹æŸ¥è©¢</a>` : 'â€”';
          const items = Array.isArray(data.items) ? data.items.map(i=>`${i.title} Ã— ${i.qty}`).join('ã€') : 'â€”';
          card.innerHTML = `
            <div style="display:flex;justify-content:space-between;align-items:center;gap:8px">
              <h3 style="margin:0">è¨‚å–®æŸ¥è©¢çµæœ</h3>
              <div class="note">${new Date().toLocaleString()}</div>
            </div>
            <div class="line" style="margin:10px 0"></div>
            <div><b>è¨‚å–®ç·¨è™Ÿï¼š</b>${no}</div>
            <div><b>ç›®å‰ç‹€æ…‹ï¼š</b>${s}</div>
            <div><b>å‡ºè²¨æ—¥æœŸï¼š</b>${shipDate}</div>
            <div><b>ç‰©æµå–®è™Ÿï¼š</b>${trackNo}</div>
            <div><b>ç‰©æµæŸ¥è©¢ï¼š</b>${trackLink}</div>
            <div><b>é‡‘é¡ï¼š</b>${total}</div>
            <div><b>å“é …ï¼š</b>${items}</div>
          `;
          dlBtn.style.display = 'inline-flex'; printBtn.style.display = 'inline-flex';
        }else{
          card.innerHTML = 'æŸ¥ç„¡æ­¤è¨‚å–®ç·¨è™Ÿ';
        }
      }catch(e){ card.innerHTML = 'æŸ¥è©¢å¤±æ•—ï¼š' + e.message; }
    }

    /* ä¸€éµé–‹å•Ÿé–€å¸‚æŸ¥è©¢ï¼ˆä¾å“ç‰Œåˆ‡æ›ç¶²å€ + å›é è‡ªå‹•è²¼ä¸Šå˜—è©¦ï¼‰ */
    function updateCvsLink(){
      const brand = document.querySelector('select[name="cvsBrand"]').value;
      const a = document.getElementById('cvsFinderLink');
      if(brand==='å…¨å®¶'){
        a.href = 'https://www.family.com.tw/marketing/inquiry.aspx';
        a.textContent = 'é–‹å•Ÿ å…¨å®¶ é–€å¸‚æŸ¥è©¢';
      }else{
        a.href = 'https://emap.pcsc.com.tw/';
        a.textContent = 'é–‹å•Ÿ 7-11 é–€å¸‚æŸ¥è©¢';
      }
    }

    // å˜—è©¦è§£æå‰ªè²¼ç°¿é–€å¸‚æ–‡å­—/ç¶²å€ï¼Œè‡ªå‹•å¡«å…¥ã€Œé–€å¸‚åç¨± / åº—è™Ÿã€
    async function pasteCvsFromClipboard(){
      try{
        const txt = await navigator.clipboard.readText();
        if(!txt){ alert('å‰ªè²¼ç°¿æ²’æœ‰å…§å®¹'); return; }
        const parsed = parseStoreFromText(txt);
        if(parsed){
          document.querySelector('input[name="cvsStore"]').value = `${parsed.name} / ${parsed.code}`;
          showToast('å·²è²¼ä¸Šé–€å¸‚è³‡è¨Š');
        }else{
          document.querySelector('input[name="cvsStore"]').value = txt.trim();
          showToast('å·²è²¼ä¸Šå‰ªè²¼ç°¿å…§å®¹');
        }
      }catch(e){
        alert('ç„¡æ³•è®€å–å‰ªè²¼ç°¿ï¼š' + e.message + 'ï¼ˆè«‹å…ˆå…è¨±æ¬Šé™ï¼‰');
      }
    }
    // å›åˆ°æœ¬åˆ†é æ™‚ï¼Œå˜—è©¦è‡ªå‹•å¾å‰ªè²¼ç°¿å¸¶å›ï¼ˆéœ€ä½¿ç”¨è€…æˆæ¬Šï¼‰
    window.addEventListener('focus', async ()=>{
      const method = getShipMethod();
      if(method!=='CVS') return;
      try{
        const txt = await navigator.clipboard.readText();
        const parsed = parseStoreFromText(txt||'');
        if(parsed){
          const input = document.querySelector('input[name="cvsStore"]');
          if(input && !input.value){ input.value = `${parsed.name} / ${parsed.code}`; showToast('åµæ¸¬åˆ°é–€å¸‚è³‡è¨Šï¼Œå·²è‡ªå‹•è²¼ä¸Š'); }
        }
      }catch{ /* ignore */ }
    });

    function parseStoreFromText(txt){
      // å¸¸è¦‹æ ¼å¼è§£æï¼ˆ7-11 / å…¨å®¶ çš†å¯ï¼‰
      // ä¾‹ï¼šè±åŸæˆåŠŸé–€å¸‚ / 123456ã€XXåº—(123456)ã€åº—è™Ÿï¼š123456ã€ç¶²å€å¸¶ code
      const code = (txt.match(/(\\d{5,6})/)||[])[1];
      const name = (txt.match(/([\\u4e00-\\u9fa5A-Za-z0-9]+é–€å¸‚)/)||[])[1]
                || (txt.match(/åº—å[:ï¼š]?\\s*([\\u4e00-\\u9fa5A-Za-z0-9]+)/)||[])[1]
                || (txt.replace(/\\s+/g,' ').trim().split(/[\\/,ï¼Œ-]/)[0]||'é–€å¸‚');
      if(code){ return {name, code}; }
      return null;
    }

    /* æ¢æ¬¾ï¼šå±•é–‹ä¸¦æ²åˆ°åº•æ‰å¯å‹¾é¸ */
    (function setupPolicy(){
      const det = document.getElementById('policy');
      const agree = document.getElementById('agree');
      const enableIfBottom = ()=>{
        const sc = det.scrollTop + det.clientHeight;
        const need = det.scrollHeight - 10;
        if(sc >= need){ agree.disabled = false; }
      };
      det.addEventListener('toggle', ()=>{ if(det.open){ det.focus(); }});
      det.addEventListener('scroll', enableIfBottom, {passive:true});
      document.querySelector('label[for="agree"]')?.addEventListener('click', (e)=>{
        if(agree.disabled){ e.preventDefault(); det.open=true; det.scrollIntoView({behavior:'smooth',block:'center'}); }
      });
    })();

    /* è¡¨å–®æ¬„ä½å³æ™‚è¨˜æ†¶ */
    document.getElementById('orderForm').addEventListener('input', saveForm);

    /* åˆå§‹åŒ– */
    function init(){
      loadOverrides(); // â† å…ˆè¼‰å…¥è¦†å¯«ï¼ˆå«ç”¢å“ç‹€æ…‹ï¼‰
      renderAllGrids();
      renderNewsRail();
      renderSpecRail();
      setShipMethod(getShipMethod());
      renderCart();
      loadForm();
      updateCvsLink();
    }
    init();

    /* ä¸€éµæˆªåœ–ï¼šæŠŠã€ŒqueryCardã€å­˜æˆ PNG */
    async function downloadQueryPNG(){
      const card = document.getElementById('queryCard');
      if(!window.html2canvas){ alert('æˆªåœ–å·¥å…·è¼‰å…¥ä¸­ï¼Œè«‹ç¨å¾Œå†è©¦'); return; }
      const canvas = await html2canvas(card, {scale:2});
      const url = canvas.toDataURL('image/png');
      const a = document.createElement('a'); a.href = url; a.download = 'order-query.png'; a.click();
    }

    /* ======= ç®¡ç†ï¼šä¿å­˜ Hero / About / News / Spec / æ¨™é¡Œ ======= */
    function saveHero(){
      const logo = toRaw(document.getElementById('admLogo').value.trim());
      const hero = toRaw(document.getElementById('admHero').value.trim());
      const pill = document.getElementById('admHeroPill').value.trim();
      const h1 = document.getElementById('admHeroTitle').value.trim();
      const desc = document.getElementById('admHeroDesc').value.trim();
      const btnText = document.getElementById('admBtnText').value.trim() || 'é¦¬ä¸Šé¸è³¼';
      CONFIG.IMAGES.LOGO = logo || CONFIG.IMAGES.LOGO;
      CONFIG.IMAGES.HERO = hero || CONFIG.IMAGES.HERO;
      document.getElementById('logoImg').src = CONFIG.IMAGES.LOGO;
      document.getElementById('hero').style.backgroundImage = `url('${CONFIG.IMAGES.HERO}')`;
      document.getElementById('heroPill').textContent = pill || document.getElementById('heroPill').textContent;
      document.getElementById('heroTitle').textContent = h1 || document.getElementById('heroTitle').textContent;
      document.getElementById('heroDesc').textContent = desc || document.getElementById('heroDesc').textContent;
      document.getElementById('shopNowBtn').textContent = btnText;
      saveOverrides(); showToast('å·²æ›´æ–° Hero');
    }
    function saveAbout(){
      const t = document.getElementById('admAboutTitle').value.trim();
      const html = document.getElementById('admAboutHtml').value.trim();
      if(t) document.getElementById('aboutTitle').textContent = t;
      if(html) document.getElementById('aboutHtml').innerHTML = html;
      saveOverrides(); showToast('å·²æ›´æ–° é—œæ–¼æˆ‘å€‘');
    }

    function renderAdminNews(){
      const box = document.getElementById('admNewsList');
      const list = CONFIG.IMAGES.NEWS || [];
      box.innerHTML = list.map((it,idx)=>`
        <div class="adm-row" style="align-items:end">
          <div>
            <div class="label">ç¬¬ ${idx+1} å‰‡ï¼šé¡å‹ï¼ˆimage / videoï¼‰</div>
            <input class="input" id="newsType_${idx}" value="${it.type||'image'}">
          </div>
          <div>
            <div class="label">é€£çµï¼ˆå»ºè­° RAW æˆ–ç›´é€£ï¼‰</div>
            <input class="input" id="newsSrc_${idx}" value="${it.src||''}">
          </div>
          <div>
            <div class="label">æ¨™é¡Œ</div>
            <input class="input" id="newsTitle_${idx}" value="${it.title||''}">
          </div>
          <div style="display:flex;gap:8px">
            <button class="btn-ghost" onclick="moveNews(${idx}, -1)">ä¸Šç§»</button>
            <button class="btn-ghost" onclick="moveNews(${idx}, 1)">ä¸‹ç§»</button>
            <button class="btn-red" onclick="delNews(${idx})">åˆªé™¤</button>
          </div>
        </div>
      `).join('');
    }
    function addNewsItem(){ (CONFIG.IMAGES.NEWS = CONFIG.IMAGES.NEWS||[]).push({type:'image',src:'',title:''}); renderAdminNews(); }
    function delNews(i){ CONFIG.IMAGES.NEWS.splice(i,1); renderAdminNews(); }
    function moveNews(i,dir){
      const j = i+dir; const arr = CONFIG.IMAGES.NEWS;
      if(j<0 || j>=arr.length) return;
      [arr[i],arr[j]]=[arr[j],arr[i]]; renderAdminNews();
    }
    function saveNews(){
      const arr = CONFIG.IMAGES.NEWS||[];
      for(let i=0;i<arr.length;i++){
        const t = document.getElementById('newsType_'+i)?.value||'image';
        const s = toRaw((document.getElementById('newsSrc_'+i)?.value||'').trim());
        const title = document.getElementById('newsTitle_'+i)?.value||'';
        arr[i] = {type:t.toLowerCase().includes('vid')?'video':'image', src:s, title};
      }
      saveOverrides(); renderNewsRail(); showToast('å·²æ›´æ–° æœ€æ–°é®®å ±');
    }

    function renderAdminSpec(){
      const box = document.getElementById('admSpecList');
      const list = CONFIG.IMAGES.SPEC_GALLERY || [];
      box.innerHTML = list.map((src,idx)=>`
        <div class="adm-row" style="align-items:end">
          <div>
            <div class="label">ç¬¬ ${idx+1} å¼µ åœ–ç‰‡é€£çµ</div>
            <input class="input" id="specSrc_${idx}" value="${src||''}">
          </div>
          <div style="display:flex;gap:8px">
            <button class="btn-ghost" onclick="moveSpec(${idx}, -1)">ä¸Šç§»</button>
            <button class="btn-ghost" onclick="moveSpec(${idx}, 1)">ä¸‹ç§»</button>
            <button class="btn-red" onclick="delSpec(${idx})">åˆªé™¤</button>
          </div>
        </div>
      `).join('');
    }
    function addSpecImg(){ (CONFIG.IMAGES.SPEC_GALLERY = CONFIG.IMAGES.SPEC_GALLERY||[]).push(''); renderAdminSpec(); }
    function delSpec(i){ CONFIG.IMAGES.SPEC_GALLERY.splice(i,1); renderAdminSpec(); }
    function moveSpec(i,dir){
      const j = i+dir; const arr = CONFIG.IMAGES.SPEC_GALLERY;
      if(j<0 || j>=arr.length) return;
      [arr[i],arr[j]]=[arr[j],arr[i]]; renderAdminSpec();
    }
    function saveSpec(){
      const arr = CONFIG.IMAGES.SPEC_GALLERY||[];
      for(let i=0;i<arr.length;i++){
        const s = toRaw((document.getElementById('specSrc_'+i)?.value||'').trim());
        arr[i] = s;
      }
      saveOverrides(); renderSpecRail(); showToast('å·²æ›´æ–° è¦æ ¼ç­‰ç´šåœ–');
    }

    function saveSectionTitles(){
      const map = {
        hotTitle: document.getElementById('admHotTitle').value,
        hotSub: document.getElementById('admHotSub').value,
        ponganTitle: document.getElementById('admPonganTitle').value,
        ponganSub: document.getElementById('admPonganSub').value,
        maogaoTitle: document.getElementById('admMaogaoTitle').value,
        maogaoSub: document.getElementById('admMaogaoSub').value,
      };
      if(map.hotTitle) document.getElementById('hotTitle').textContent = map.hotTitle;
      if(map.hotSub) document.getElementById('hotSub').textContent = map.hotSub;
      if(map.ponganTitle) document.getElementById('ponganTitle').textContent = map.ponganTitle;
      if(map.ponganSub) document.getElementById('ponganSub').textContent = map.ponganSub;
      if(map.maogaoTitle) document.getElementById('maogaoTitle').textContent = map.maogaoTitle;
      if(map.maogaoSub) document.getElementById('maogaoSub').textContent = map.maogaoSub;
      saveOverrides(); showToast('å·²æ›´æ–° å€å¡Šæ¨™é¡Œ');
    }

    /* ===== å°å·¥å…·ï¼šToast ===== */
    let toastTimer = null;
    function showToast(msg){
      const t = document.getElementById('toast');
      t.textContent = msg; t.classList.add('show');
      clearTimeout(toastTimer);
      toastTimer = setTimeout(()=> t.classList.remove('show'), 2000);
    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
</body>
</html>
