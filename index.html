<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>柑心果園｜公老坪椪柑・東勢茂谷｜在地傳承的好滋味</title>
<meta name="description" content="柑心果園：用心種柑，與你柑心相伴。公老坪山頂在地50年椪柑、東勢在地30年茂谷。現採分級直送，10/25台斤多規格，匯款立即安排出貨。到貨請開箱錄影保障理賠。">
<style>
  :root{
    --bg:#faf7f2; --surface:#ffffff; --text:#1f2937; --muted:#6b7280; --brand:#f59e0b; --brand-dark:#d97706;
    --border:#e5e7eb;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans TC","Helvetica Neue",Arial,sans-serif}
  a{color:var(--brand-dark);text-decoration:none}
  .wrap{max-width:1100px;margin:0 auto;padding:0 16px}

  /* Hero */
  .hero{position:relative;min-height:58vh;display:grid;place-items:center;color:#fff;background-size:cover;background-position:center}
  .hero::after{content:"";position:absolute;inset:0;background:linear-gradient(180deg,rgba(0,0,0,.45),rgba(0,0,0,.38))}
  .hero-inner{position:relative;text-align:center;padding:64px 16px}
  .logo{width:120px;height:120px;border-radius:18px;background:#fff9;padding:10px;backdrop-filter:blur(4px);display:inline-grid;place-items:center;margin-bottom:12px}
  .logo img{max-width:100%;max-height:100%}
  .hero h1{font-size:clamp(26px,4vw,44px);margin:6px 0 8px}
  .hero p{font-size:clamp(14px,2.2vw,18px);opacity:.98;margin:0}
  .pill{display:inline-block;background:#fff3;backdrop-filter:blur(4px);border:1px solid #fff7;color:#fff;border-radius:999px;padding:6px 10px;font-weight:700}

  .btn{display:inline-flex;align-items:center;gap:8px;border-radius:12px;padding:12px 18px;background:var(--brand);color:#111;font-weight:700;border:1px solid rgba(0,0,0,.05);box-shadow:0 10px 20px rgba(245,158,11,.25);cursor:pointer}
  .btn:hover{background:var(--brand-dark)}

  .section{padding:42px 0}
  .section h2{font-size:clamp(22px,3vw,28px);margin:0 0 14px}
  .muted{color:var(--muted)}
  .card{background:var(--surface);border:1px solid var(--border);border-radius:16px;box-shadow:0 10px 28px rgba(0,0,0,.06)}
  .grid{display:grid;gap:18px}
  @media(min-width:900px){.grid-2{grid-template-columns:1fr 1fr}}

  /* 輪播 */
  .carousel{display:flex;gap:14px;overflow:auto;scroll-snap-type:x mandatory;padding:10px 0 6px}
  .carousel::-webkit-scrollbar{height:8px}
  .carousel::-webkit-scrollbar-thumb{background:#ddd;border-radius:999px}
  .product{min-width:280px;scroll-snap-align:start;display:flex;flex-direction:column}
  .product img{width:100%;height:190px;object-fit:cover;border-radius:14px 14px 0 0}
  .product .body{padding:14px}
  .price{font-weight:800;font-size:20px}

  /* 抽屜購物車 */
  .drawer{position:fixed;right:0;top:0;bottom:0;width:min(420px,96%);background:var(--surface);border-left:1px solid var(--border);
    transform:translateX(105%);transition:.28s;z-index:50;display:flex;flex-direction:column}
  .drawer.open{transform:none}
  .drawer header{padding:14px 16px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
  .drawer main{padding:14px 16px;overflow:auto;flex:1}
  .line{height:1px;background:var(--border);margin:10px 0}
  .cart-row{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:8px 0}
  .qty{display:flex;align-items:center;border:1px solid var(--border);border-radius:10px}
  .qty button{width:30px;height:30px;border:0;background:#f3f4f6}
  .qty span{display:inline-block;width:32px;text-align:center}
  .summary{background:#f9fafb;border:1px dashed var(--border);border-radius:12px;padding:12px}
  .badge{display:inline-block;background:#fff0d6;color:#7c2d12;border:1px solid #fed7aa;border-radius:10px;padding:4px 8px;font-size:12px;font-weight:700}

  /* 表單 */
  .form .row{display:grid;gap:10px}
  @media(min-width:720px){.form .row{grid-template-columns:1fr 1fr}}
  .label{font-weight:700;margin:8px 0 6px}
  .input, select, textarea{width:100%;padding:12px;border:1px solid var(--border);border-radius:10px;background:#fff}
  .note{font-size:13px;color:var(--muted)}

  .warn{background:#fff1f2;border:1px solid #fecdd3;color:#7f1d1d}
  footer{padding:36px 0 56px;color:#6b7280;text-align:center}
</style>
</head>
<body>

<!-- 抽屜購物車 -->
<aside id="drawer" class="drawer" aria-hidden="true">
  <header>
    <strong>購物車</strong>
    <button class="btn" onclick="toggleDrawer(false)">關閉</button>
  </header>
  <main>
    <div id="cartList"></div>
    <div class="line"></div>
    <div class="summary">
      <div style="display:flex;justify-content:space-between"><span>商品小計</span><strong id="subtotal">$0</strong></div>
      <div style="display:flex;justify-content:space-between"><span>運費（常溫宅配）</span><strong id="shipping">$0</strong></div>
      <div class="line"></div>
      <div style="display:flex;justify-content:space-between;font-size:18px"><span>應付金額</span><strong id="total">$0</strong></div>
      <div style="margin-top:8px" class="note">滿額 1800 即免運。</div>
    </div>

    <div class="line"></div>
    <!-- 下單表單 -->
    <form id="orderForm" class="form" onsubmit="submitOrder(event)">
      <div class="row">
        <div><div class="label">姓名</div><input class="input" name="name" required></div>
        <div><div class="label">手機</div><input class="input" name="phone" required></div>
      </div>
      <div class="row">
        <div><div class="label">Email（寄送出貨通知）</div><input class="input" type="email" name="email" required></div>
        <div>
          <div class="label">物流方式</div>
          <select name="ship" class="input">
            <option value="新竹常溫宅配">新竹常溫宅配</option>
            <option value="自取（台中市石岡區石岡街61號）">自取（台中市石岡區石岡街61號）</option>
          </select>
        </div>
      </div>
      <div>
        <div class="label">收件地址（自取可填自取地點）</div>
        <input class="input" name="addr" required>
      </div>
      <div>
        <div class="label">備註（到貨時段、發票需求等）</div>
        <textarea class="input" name="remark" rows="3"></textarea>
      </div>
      <div style="margin:6px 0">
        <label><input type="checkbox" required> 我已詳閱下方「物流與退貨說明」並同意</label>
      </div>
      <button class="btn" type="submit" style="width:100%;justify-content:center">送出訂單（取得匯款資訊）</button>
    </form>
    <div id="result" class="note" style="margin-top:8px"></div>
  </main>
</aside>

<!-- Hero -->
<section class="hero" id="hero">
  <div class="hero-inner wrap">
    <div class="logo"><img id="logoImg" src="" alt="柑心果園 Logo"></div>
    <span class="pill">豐原・東勢｜在地傳承</span>
    <h1>柑心果園｜用心種柑，與你柑心相伴</h1>
    <p>公老坪椪柑（50年）與東勢茂谷（30年），現採分級直送。10 / 25 台斤多規格可選，匯款後立即安排出貨；到貨請開箱錄影，保障運損理賠。</p>
    <div style="margin-top:16px"><a id="shopNowBtn" class="btn" href="#pongan">馬上選購</a></div>
  </div>
</section>

<!-- 品牌故事 + 影片 -->
<section class="section">
  <div class="wrap grid grid-2">
    <div class="card" style="padding:18px">
      <h2>關於「柑心果園」</h2>
      <p class="muted">
        我們相信，好的水果，來自長年的堅持與土地的回應。<br>
        <b>公老坪椪柑</b>承載著家族在山頂的 <b>50 年</b>耕作記憶：日照充足、早晚溫差大，讓果皮薄、汁水足、酸甜平衡。<br>
        <b>東勢茂谷</b>則是一路相伴的 <b>30 年</b>老友：香氣清甜、纖維細緻、入口化開。<br><br>
        從採收、分級到裝箱，我們做的每一步只有一個目的——把最好吃的柑橘，完好送到你手上。<br>
        <b>用心種柑，與你柑心相伴。</b>
      </p>
    </div>
    <div class="card" style="overflow:hidden">
      <!-- 影片：用 raw 連結才能播放 -->
      <video src="https://raw.githubusercontent.com/s9000721-cloud/gonglaoping/main/780323577.063367.mp4" controls style="width:100%;height:100%;display:block" poster="">
      </video>
    </div>
  </div>
</section>

<!-- 產品區：公老坪椪柑 -->
<section id="pongan" class="section">
  <div class="wrap">
    <div class="card" style="padding:0 0 12px 0">
      <div style="padding:18px 18px 0 18px">
        <h2 style="margin-bottom:6px">公老坪椪柑（50年）</h2>
        <p class="muted" style="margin:0">現採分級｜皮薄多汁｜酸甜平衡</p>
      </div>
      <!-- 規格比較圖（你提供的第一張） -->
      <img src="https://github.com/s9000721-cloud/gonglaoping/blob/main/%E7%AD%89%E7%B4%9A%E6%AF%94%E8%BC%83%E5%9C%96.jpg" alt="椪柑規格比較" style="width:100%;height:auto;border-radius:0 0 16px 16px">
      <div class="carousel" id="ponganList" style="padding:12px 18px 18px 18px"><!-- JS 注入 --></div>
    </div>
  </div>
</section>

<!-- 產品區：東勢茂谷 -->
<section id="maogao" class="section">
  <div class="wrap">
    <div class="card" style="padding:18px">
      <h2>東勢茂谷（30年）</h2>
      <p class="muted" style="margin-top:-6px">香氣清甜｜纖維細緻｜入口化開</p>
      <div class="carousel" id="maogaoList"><!-- JS 注入 --></div>
    </div>
  </div>
</section>

<!-- 訂單查詢 -->
<section id="query" class="section">
  <div class="wrap card" style="padding:16px">
    <h2>訂單查詢</h2>
    <form id="queryForm" onsubmit="queryOrder(event)" style="display:flex;gap:10px;flex-wrap:wrap">
      <input class="input" name="orderNo" placeholder="輸入訂單編號（例：K24-20250923-1234）" required style="flex:1 1 260px">
      <button class="btn" type="submit">查詢</button>
    </form>
    <div id="queryResult" class="note" style="margin-top:8px"></div>
  </div>
</section>

<!-- 物流與退貨說明 -->
<section class="section">
  <div class="wrap grid grid-2">
    <div class="card" style="padding:16px">
      <h2>物流與出貨</h2>
      <ul class="muted">
        <li>入帳後 1–3 個工作天內出貨（週末與節慶量大時順延）。</li>
        <li>宅配：黑貓常溫。到貨請「全程開箱錄影」；若有運損，48 小時內提供影片與照片，協助向物流申請理賠。</li>
        <li>自取：可於豐原或公老坪自取，請於備註填寫自取點與時間。</li>
      </ul>
      <div class="badge">貼心提醒</div>
      <p class="note">水果屬天然農產，外觀、甜度、酸度會因批次氣候略有差異，屬正常現象。</p>
    </div>
    <div class="card warn" style="padding:16px">
      <h2>退貨與售後說明</h2>
      <ul>
        <li>生鮮水果依法不適用 7 日猶豫期。</li>
        <li>自然果斑、色澤差異、糖瓤與甜度落差屬正常範圍，恕不退換。</li>
        <li>運損請於 48 小時內提供「完整開箱錄影＋照片」，我們會協助向物流理賠。</li>
      </ul>
    </div>
  </div>
</section>

<!-- 匯款資訊 -->
<section class="section">
  <div class="wrap card" style="padding:16px">
    <h2>匯款資訊</h2>
    <p><strong id="bankName"></strong>　戶名：<strong id="bankHolder"></strong>　帳號：<strong id="bankNo"></strong></p>
    <p class="note">匯款完成請於「匯款後五碼」回覆（回信或 LINE），我們將立即安排出貨。</p>
  </div>
</section>

<footer>
  <div class="wrap"><div class="muted">© 柑心果園｜公老坪椪柑・東勢茂谷</div></div>
</footer>

<script>
/** =========================
 *  設定（價格 / 匯款 / 運費 / 影像URL / GAS）
 *  ========================= */
const CONFIG = {
  PRICES: {
    // 椪柑
    PONGAN: {
      "10台斤": { "23A": 750, "25A": 780, "27A": 820, "30A": 880 },
      "25台斤": { "23A": 1600,"25A": 1680,"27A": 1780,"30A": 1880 }
    },
    // 茂谷（先用一樣價 / 可自行調整）
    MAOGAO: {
      "10台斤": { "23A": 720, "25A": 760, "27A": 800, "30A": 860 },
      "25台斤": { "23A": 1500,"25A": 1580,"27A": 1680,"30A": 1780 }
    }
  },
  SHIPPING: 160,              // 常溫運費（單筆）
  FREE_SHIP_THRESHOLD: 1500,  // 滿額免運（整筆）
  BANK: {
    name: "連線銀行(824)",
    holder: "張鈞泓",
    no: "11101-37823-13"
  },
  // 影像 URL：統一改這裡就好
  IMAGES: {
    HERO: toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/%E5%B0%81%E9%9D%A2%E5%9C%96.png"),
    LOGO: toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/%E6%9F%91%E5%BF%83%E6%9E%9C%E5%9C%92LOGO.png"),
    PONGAN: {
      "10台斤-23A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/10%E6%96%A4%E5%A4%A7%E5%90%89%E5%A4%A7%E5%88%A93.jpg"),
      "10台斤-25A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/10%E6%96%A4%E5%A4%A7%E5%90%89%E5%A4%A7%E5%88%A93.jpg"),
      "10台斤-27A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/10%E6%96%A4%E5%A4%A7%E5%90%89%E5%A4%A7%E5%88%A93.jpg"),
      "10台斤-30A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/10%E6%96%A4%E5%A4%A7%E5%90%89%E5%A4%A7%E5%88%A93.jpg"),
      "25台斤-23A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/25%E6%96%A4%E6%A9%98%E5%AD%90.jpg"),
      "25台斤-25A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/25%E6%96%A4%E6%A9%98%E5%AD%90.jpg"),
      "25台斤-27A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/25%E6%96%A4%E6%A9%98%E5%AD%90.jpg"),
      "25台斤-30A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/25%E6%96%A4%E6%A9%98%E5%AD%90.jpg")
    },
    MAOGAO: {
      "10台斤-23A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/10%E6%96%A4%E5%A4%A7%E5%90%89%E5%A4%A7%E5%88%A93.jpg"),
      "10台斤-25A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/10%E6%96%A4%E5%A4%A7%E5%90%89%E5%A4%A7%E5%88%A93.jpg"),
      "10台斤-27A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/10%E6%96%A4%E5%A4%A7%E5%90%89%E5%A4%A7%E5%88%A93.jpg"),
      "10台斤-30A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/10%E6%96%A4%E5%A4%A7%E5%90%89%E5%A4%A7%E5%88%A93.jpg"),
      "25台斤-23A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/25%E6%96%A4%E6%A9%98%E5%AD%90.jpg"),
      "25台斤-25A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/25%E6%96%A4%E6%A9%98%E5%AD%90.jpg"),
      "25台斤-27A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/25%E6%96%A4%E6%A9%98%E5%AD%90.jpg"),
      "25台斤-30A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/25%E6%96%A4%E6%A9%98%E5%AD%90.jpg")
    }
  },
  GAS_ENDPOINT: "https://script.google.com/macros/s/你的WebAppID/exec", // ← 換成你的 Apps Script 發佈網址
  BRAND_TAG: "柑心果園"
};

// 轉 raw.githubusercontent 以便 <img>/<video> 直接顯示
function toRaw(u){
  if(!u) return u;
  if(u.includes('raw.githubusercontent.com')) return u;
  return u.replace('https://github.com/','https://raw.githubusercontent.com/').replace('/blob/','/');
}

// 匯款資訊填入
document.getElementById('bankName').textContent   = CONFIG.BANK.name;
document.getElementById('bankHolder').textContent = CONFIG.BANK.holder;
document.getElementById('bankNo').textContent     = CONFIG.BANK.no;

// Hero 圖 / Logo 圖
document.getElementById('hero').style.backgroundImage = `url('${CONFIG.IMAGES.HERO}')`;
document.getElementById('logoImg').src = CONFIG.IMAGES.LOGO;

// 「馬上選購」平滑捲動（避免有些環境 a#hash 不生效）
document.getElementById('shopNowBtn').addEventListener('click', (e)=>{
  e.preventDefault();
  document.getElementById('pongan').scrollIntoView({behavior:'smooth'});
});

/** 產品清單（分區渲染） */
const PONGAN = [
  { id:"PON10-23A", section:"PONGAN", title:"椪柑｜10台斤｜23A", weight:"10台斤", size:"23A" },
  { id:"PON10-25A", section:"PONGAN", title:"椪柑｜10台斤｜25A", weight:"10台斤", size:"25A" },
  { id:"PON10-27A", section:"PONGAN", title:"椪柑｜10台斤｜27A", weight:"10台斤", size:"27A" },
  { id:"PON10-30A", section:"PONGAN", title:"椪柑｜10台斤｜30A", weight:"10台斤", size:"30A" },
  { id:"PON25-23A", section:"PONGAN", title:"椪柑｜25台斤｜23A", weight:"25台斤", size:"23A" },
  { id:"PON25-25A", section:"PONGAN", title:"椪柑｜25台斤｜25A", weight:"25台斤", size:"25A" },
  { id:"PON25-27A", section:"PONGAN", title:"椪柑｜25台斤｜27A", weight:"25台斤", size:"27A" },
  { id:"PON25-30A", section:"PONGAN", title:"椪柑｜25台斤｜30A", weight:"25台斤", size:"30A" },
];
const MAOGAO = [
  { id:"MAO10-23A", section:"MAOGAO", title:"茂谷｜10台斤｜23A", weight:"10台斤", size:"23A" },
  { id:"MAO10-25A", section:"MAOGAO", title:"茂谷｜10台斤｜25A", weight:"10台斤", size:"25A" },
  { id:"MAO10-27A", section:"MAOGAO", title:"茂谷｜10台斤｜27A", weight:"10台斤", size:"27A" },
  { id:"MAO10-30A", section:"MAOGAO", title:"茂谷｜10台斤｜30A", weight:"10台斤", size:"30A" },
  { id:"MAO25-23A", section:"MAOGAO", title:"茂谷｜25台斤｜23A", weight:"25台斤", size:"23A" },
  { id:"MAO25-25A", section:"MAOGAO", title:"茂谷｜25台斤｜25A", weight:"25台斤", size:"25A" },
  { id:"MAO25-27A", section:"MAOGAO", title:"茂谷｜25台斤｜27A", weight:"25台斤", size:"27A" },
  { id:"MAO25-30A", section:"MAOGAO", title:"茂谷｜25台斤｜30A", weight:"25台斤", size:"30A" },
];

const cart = []; // {id,title,price,qty,weight,size,section}

const priceOf = (section,weight,size)=> CONFIG.PRICES[section]?.[weight]?.[size] ?? 0;
const currency = n => "NT$ "+(n||0).toLocaleString();
const imgFor = (section,weight,size)=>{
  const key = `${weight}-${size}`;
  return CONFIG.IMAGES[section]?.[key] || 'https://via.placeholder.com/600x400?text=No+Image';
};

/* 渲染產品卡片 */
function renderList(elId, items){
  const el = document.getElementById(elId);
  el.innerHTML = items.map(p=>{
    const price = priceOf(p.section, p.weight, p.size);
    const img = imgFor(p.section, p.weight, p.size);
    return `
      <article class="product card">
        <img src="${img}" alt="${p.title}">
        <div class="body">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <h3 style="margin:0;font-size:18px">${p.title}</h3>
            <div class="price">${currency(price)}</div>
          </div>
          <p class="muted" style="margin:6px 0 12px">當日採收分級，甜度高、皮薄多汁。</p>
          <button class="btn" onclick="addToCart('${p.id}')">加入購物車</button>
        </div>
      </article>`;
  }).join('');
}

/* 初始化兩個區塊 */
renderList('ponganList', PONGAN);
renderList('maogaoList', MAOGAO);

/* 購物車邏輯 */
function addToCart(pid){
  const src = [...PONGAN, ...MAOGAO].find(x=>x.id===pid);
  if(!src) return;
  const price = priceOf(src.section, src.weight, src.size);
  const existed = cart.find(x=>x.id===pid);
  if(existed) existed.qty++;
  else cart.push({ id:src.id, title:src.title, price, qty:1, weight:src.weight, size:src.size, section:src.section });
  renderCart(); toggleDrawer(true);
}
function mutateQty(i,delta){
  cart[i].qty += delta;
  if(cart[i].qty<=0) cart.splice(i,1);
  renderCart();
}
function calc(){
  const subtotal = cart.reduce((s,i)=>s+i.price*i.qty,0);
  const shipping = subtotal>=CONFIG.FREE_SHIP_THRESHOLD || cart.length===0 ? 0 : CONFIG.SHIPPING;
  return {subtotal, shipping, total: subtotal+shipping};
}
function renderCart(){
  const list = document.getElementById('cartList');
  if(!cart.length){
    list.innerHTML = `<div class="muted">購物車是空的，去挑幾顆最頂的橘子吧 🍊</div>`;
  }else{
    list.innerHTML = cart.map((c,i)=>`
      <div class="cart-row">
        <div>
          <div><strong>${c.title}</strong></div>
          <div class="note">${currency(c.price)} × ${c.qty}</div>
        </div>
        <div class="qty">
          <button onclick="mutateQty(${i},-1)">–</button>
          <span>${c.qty}</span>
          <button onclick="mutateQty(${i},1)">＋</button>
        </div>
      </div>`).join('');
  }
  const {subtotal,shipping,total} = calc();
  document.getElementById('subtotal').textContent = currency(subtotal);
  document.getElementById('shipping').textContent = currency(shipping);
  document.getElementById('total').textContent = currency(total);
}
function toggleDrawer(open){ document.getElementById('drawer').classList.toggle('open', !!open); }

/* 送單到 GAS */
async function submitOrder(ev){
  ev.preventDefault();
  if(!cart.length){ alert("購物車是空的"); return; }
  const f = new FormData(ev.target);
  const payload = {
    ts: new Date().toISOString(),
    name: f.get('name'), phone: f.get('phone'), email: f.get('email'),
    addr: f.get('addr'), ship: f.get('ship'), remark: f.get('remark'),
    items: cart.map(c=>({title:c.title, section:c.section, weight:c.weight, size:c.size, price:c.price, qty:c.qty})),
    summary: calc(),
    brand: CONFIG.BRAND_TAG
  };
  try{
    const r = await fetch(CONFIG.GAS_ENDPOINT, {method:'POST', body: JSON.stringify(payload)});
    const data = await r.json();
    if(data.ok){
      document.getElementById('result').innerHTML =
        `✅ 訂單已建立（編號：<b>${data.order_no}</b>）。<br>
         我們已把匯款資訊寄至 <b>${payload.email}</b>，請於 24 小時內完成匯款以保留庫存。`;
      cart.length = 0; renderCart(); ev.target.reset();
    }else{
      document.getElementById('result').textContent = '送出失敗：'+(data.msg||'未知錯誤');
    }
  }catch(e){
    document.getElementById('result').textContent = '送出失敗：'+ e.message;
  }
}

/* 訂單查詢（GET ?orderNo=...；需要你的 GAS 實作 doGet 支援） */
async function queryOrder(ev){
  ev.preventDefault();
  const no = ev.target.orderNo.value.trim();
  if(!no) return;
  const box = document.getElementById('queryResult');
  box.textContent = '查詢中…';
  try{
    const url = CONFIG.GAS_ENDPOINT + '?orderNo=' + encodeURIComponent(no);
    const r = await fetch(url);
    const data = await r.json();
    if(data.ok){
      const s = data.status || '（未提供狀態）';
      const total = data.total ? `，金額 ${currency(data.total)}` : '';
      const items = Array.isArray(data.items) ? data.items.map(i=>`${i.title}×${i.qty}`).join('、') : '';
      box.innerHTML = `📦 訂單 <b>${no}</b> 狀態：<b>${s}</b>${total}${items?`<br>品項：${items}`:''}`;
    }else{
      box.textContent = '查無此訂單編號';
    }
  }catch(e){
    box.textContent = '查詢失敗：' + e.message + '（請確認 GAS 已支援 doGet 查詢）';
  }
}

/* 首次渲染購物車 */
renderCart();
</script>
</body>
</html>
