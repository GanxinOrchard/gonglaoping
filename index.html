<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>柑心果園｜公老坪椪柑・東勢茂谷｜在地傳承的好滋味</title>
<meta name="description" content="柑心果園：用心種柑，與你柑心相伴。公老坪山頂在地50年椪柑、東勢在地30年茂谷。現採分級直送，10/25 台斤多規格，匯款立即安排出貨。到貨請開箱錄影保障理賠。">

<style>
:root{
  --bg:#faf7f2; --surface:#ffffff; --text:#1f2937; --muted:#6b7280;
  --brand:#f59e0b; --brand-dark:#d97706; --border:#e5e7eb;
  --shadow:0 10px 28px rgba(0,0,0,.06);
  --hot:#ef4444; --hot-dark:#dc2626;
  --pongan-surface:#fff7d6; --maogao-surface:#eef9f0;
}
*{box-sizing:border-box}
html{scroll-behavior:smooth; -webkit-text-size-adjust:100%}
body{margin:0;background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans TC","Helvetica Neue",Arial,sans-serif}
a{color:var(--brand-dark);text-decoration:none}
.wrap{max-width:1100px;margin:0 auto;padding:0 16px}

/* Hero */
.hero{position:relative;min-height:52vh;display:grid;place-items:center;color:#fff;background-size:cover;background-position:center}
@media(max-width:560px){.hero{min-height:44vh}}
.hero::after{content:"";position:absolute;inset:0;background:linear-gradient(180deg,rgba(0,0,0,.45),rgba(0,0,0,.38));z-index:0;pointer-events:none}
.hero-inner{position:relative;z-index:1;text-align:center;padding:56px 16px}
.logo{width:110px;height:110px;border-radius:18px;background:#fff9;padding:10px;backdrop-filter:blur(4px);display:inline-grid;place-items:center;margin-bottom:10px}
.logo img{max-width:100%;max-height:100%}
.hero h1{font-size:clamp(21px,4.8vw,36px);margin:4px 0 6px}
.hero p{font-size:clamp(12.5px,3.2vw,15px);opacity:.98;margin:0}
.pill{display:inline-block;background:#fff3;backdrop-filter:blur(4px);border:1px solid #fff7;color:#fff;border-radius:999px;padding:6px 10px;font-weight:700}

.btn{display:inline-flex;align-items:center;gap:8px;border-radius:12px;padding:10px 14px;background:var(--brand);color:#111;font-weight:700;border:1px solid rgba(0,0,0,.05);box-shadow:0 10px 20px rgba(245,158,11,.25);cursor:pointer;font-size:clamp(12.5px,3vw,15px)}
.btn:hover{background:var(--brand-dark)}
.btn-ghost{background:#f9fafb;border:1px solid var(--border);color:var(--text);box-shadow:none}
.btn-ghost:hover{background:#f3f4f6}
.btn-red{background:var(--hot);color:#fff;border-color:#ef4444;box-shadow:0 10px 20px rgba(239,68,68,.25)}
.btn-red:hover{background:var(--hot-dark)}
.btn-block{width:100%;justify-content:center}

.section{padding:34px 0}
.section h2{font-size:clamp(17px,3.8vw,25px);margin:0 0 10px}
.muted{color:var(--muted)}
.card{background:var(--surface);border:1px solid var(--border);border-radius:16px;box-shadow:var(--shadow)}
.grid{display:grid;gap:16px}
@media(min-width:900px){.grid-2{grid-template-columns:1fr 1fr}}
.content{padding:16px}
.content p{margin:0 0 10px;line-height:1.8;font-size:clamp(13.5px,3.2vw,15px)}
.content ul{margin:0;padding-left:1.2em;line-height:1.8}
.content li{margin:4px 0}
.note{font-size:12.5px;color:var(--muted)}

/* 分類籤 */
.subnav{position:sticky;top:0;z-index:40;background:var(--surface);border-bottom:1px solid var(--border);box-shadow:0 6px 20px rgba(0,0,0,.04)}
.subnav .rail{display:flex;gap:8px;align-items:center;padding:10px 4px;overflow-x:auto;white-space:nowrap;-webkit-overflow-scrolling:touch;scroll-snap-type:x proximity}
.subnav .rail::-webkit-scrollbar{height:6px}
.subnav .rail::-webkit-scrollbar-thumb{background:#e6e6e6;border-radius:999px}
.chip{flex:0 0 auto;background:#fef3c7;border:1px solid #fde68a;color:#7c2d12;padding:8px 12px;border-radius:12px;font-weight:800;cursor:pointer;scroll-snap-align:center;font-size:clamp(12.5px,3vw,14px)}
.chip:hover{background:#fde68a}

/* 橫向滑動卡片 */
.rail-cards{display:flex;gap:12px;overflow:auto;padding:10px 4px}
.rail-cards::-webkit-scrollbar{height:6px}
.rail-cards::-webkit-scrollbar-thumb{background:#e6e6e6;border-radius:999px}
.rail-cards .card{flex:0 0 auto;width:min(480px,92%)}

/* 規格等級 */
.spec-cards .card{width:min(360px,48%)}
@media(min-width:900px){.spec-cards .card{width:min(420px,32%)}}

/* 產品網格 */
.product-grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}
@media(min-width:960px){.product-grid{gap:14px}}
.product{display:flex;flex-direction:column;overflow:hidden}
.product .imgbox{position:relative}
.product img{width:100%;aspect-ratio:4/3;height:auto;object-fit:cover;border-radius:14px 14px 0 0}
.img-badge{position:absolute;left:8px;top:8px;background:rgba(0,0,0,.75);color:#fff;padding:4px 8px;border-radius:10px;font-weight:800;font-size:12px}
.product .body{padding:10px 12px}
.title{margin:0;font-weight:700;font-size:clamp(12.5px,3.5vw,15px);line-height:1.35;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;min-height:2.4em}
.price{font-weight:800;font-size:clamp(14px,3.8vw,16px)}
.row-between{display:flex;align-items:center;justify-content:space-between}
.tag-hot{display:inline-block;background:var(--hot);color:#fff;border:1px solid #ef4444;border-radius:10px;padding:3px 7px;font-size:12px;font-weight:800}

/* 主題色 */
.theme-hot .content{background:#fee2e2;border-color:#fecaca}
.theme-pongan .content{background:var(--pongan-surface);border-color:#fde68a}
.theme-maogao .content{background:var(--maogao-surface);border-color:#bbf7d0}

/* 抽屜 */
.drawer{position:fixed;right:0;top:0;bottom:0;width:min(480px,96%);background:var(--surface);border-left:1px solid var(--border);transform:translateX(105%);transition:.28s;z-index:60;display:flex;flex-direction:column}
.drawer.open{transform:none}
.drawer header{padding:12px 14px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;gap:8px}
.drawer header .btns{display:flex;gap:8px}
.drawer main{padding:12px 14px;overflow:auto;flex:1}

.line{height:1px;background:var(--border);margin:10px 0}
.cart-row{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:8px 0}
.qty{display:flex;align-items:center;border:1px solid var(--border);border-radius:10px}
.qty button{width:30px;height:30px;border:0;background:#f3f4f6}
.qty span{display:inline-block;width:32px;text-align:center}
.summary{background:#f9fafb;border:1px dashed var(--border);border-radius:12px;padding:12px}
.badge{display:inline-block;background:#fff0d6;color:#7c2d12;border:1px solid #fed7aa;border-radius:10px;padding:4px 8px;font-size:12px;font-weight:700}
.warn{background:#fff1f2;border:1px solid #fecdd3;color:#7f1d1d}

/* 表單 */
.form .row{display:grid;gap:10px}
@media(min-width:720px){.form .row{grid-template-columns:1fr 1fr}}
.label{font-weight:700;margin:8px 0 6px}
.input, select, textarea{width:100%;padding:12px;border:1px solid var(--border);border-radius:10px;background:#fff;font-size:16px}
input, select, textarea{touch-action:manipulation}
.help{font-size:12px;color:#6b7280;margin-top:4px}

/* 浮動購物車按鈕（改橘子樣式） */
.fab{position:fixed;right:16px;bottom:calc(16px + env(safe-area-inset-bottom));z-index:55;background:linear-gradient(180deg,#ffb74d,#f59e0b);color:#111;border:1px solid rgba(0,0,0,.06);padding:12px 16px;border-radius:999px;box-shadow:0 10px 18px rgba(245,158,11,.35);display:flex;align-items:center;gap:8px;font-weight:800;cursor:pointer}
.fab .emoji{font-size:18px}
.fab-badge{display:inline-block;min-width:22px;height:22px;border-radius:999px;background:#111;color:#fff;font-size:12px;line-height:22px;text-align:center;padding:0 6px}

/* 管理員鈕/齒輪 */
.admin-btn{position:fixed;left:14px;bottom:calc(16px + env(safe-area-inset-bottom));z-index:56;background:#fff;border:1px solid var(--border);border-radius:999px;box-shadow:var(--shadow);padding:8px 10px;opacity:.5;cursor:pointer}
.admin-btn:hover{opacity:.9}
.gear{position:fixed;right:16px;bottom:calc(68px + env(safe-area-inset-bottom));z-index:55;background:#fff;border:1px solid var(--border);border-radius:999px;box-shadow:var(--shadow);padding:10px 12px;cursor:pointer}

/* Toast 提示 */
.toast{position:fixed;left:50%;bottom:calc(90px + env(safe-area-inset-bottom));transform:translateX(-50%);z-index:70;background:#111;color:#fff;padding:10px 14px;border-radius:10px;opacity:0;pointer-events:none;transition:.25s}
.toast.show{opacity:1}
footer{padding:34px 0 56px;color:#6b7280;text-align:center}
</style>
</head>

<body>
<!-- 購物車抽屜 -->
<aside id="drawer" class="drawer" aria-hidden="true">
  <header>
    <strong>購物車</strong>
    <div class="btns">
      <button class="btn-ghost" onclick="clearCart()">清空購物車</button>
      <button class="btn" onclick="toggleDrawer(false)">關閉</button>
    </div>
  </header>
  <main>
    <div id="cartList"></div>
    <div class="line"></div>
    <!-- 配送方式 -->
    <div class="summary" style="margin-bottom:10px">
      <div class="label">配送方式</div>
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <button id="shipHomeBtn" class="btn" type="button" onclick="setShipMethod('HOME')">宅配</button>
        <button id="shipCvsBtn" class="btn-ghost" type="button" onclick="setShipMethod('CVS')">超商取貨（免運｜限10斤×1）</button>
      </div>
      <div class="help">超商取貨限「單一 10 台斤 × 1 箱」，不接受外島配送。</div>
    </div>
    <!-- 運費與總額 -->
    <div class="summary">
      <div class="row-between"><span>商品小計</span><strong id="subtotal">$0</strong></div>
      <div class="row-between"><span id="shipLabel">運費（宅配）</span><strong id="shipping">$0</strong></div>
      <div class="line"></div>
      <div class="row-between" style="font-size:18px"><span>應付金額</span><strong id="total">$0</strong></div>
      <div class="note" style="margin-top:8px">宅配滿額 <b id="freeShipText">0</b> 免運；超商取貨一律免運。</div>
    </div>
    <div class="line"></div>
    <!-- 下單表單 -->
    <form id="orderForm" class="form" onsubmit="submitOrder(event)">
      <div class="row">
        <div>
          <div class="label">姓名</div>
          <input class="input" name="name" placeholder="例：陳小橘" required>
        </div>
        <div>
          <div class="label">手機</div>
          <input class="input" name="phone" placeholder="例：0912-345-678" required>
        </div>
      </div>
      <div class="row">
        <div>
          <div class="label">Email（寄送出貨通知）</div>
          <input class="input" type="email" name="email" placeholder="例：orange@example.com" required>
        </div>
        <div>
          <div class="label">物流方式</div>
          <select name="ship" class="input" required>
            <option value="宅配">宅配</option>
            <option value="超商取貨">超商取貨（免運｜限10斤×1）</option>
            <option value="自取（台中市石岡區石岡街61號）">自取（台中市石岡區石岡街61號）</option>
          </select>
          <div class="help">此欄會跟上方「配送方式」同步。</div>
        </div>
      </div>

      <!-- 地址／超商 -->
      <div id="homeFields">
        <div class="label">收件地址（宅配專用）</div>
        <input class="input" name="addr" placeholder="例：台中市○○區○○路 123 號 5 樓" required>
      </div>

      <div id="cvsFields" style="display:none">
        <div class="row">
          <div>
            <div class="label">超商品牌（7-11／全家）</div>
            <select class="input" name="cvsBrand" onchange="updateCvsLink()">
              <option value="7-11">7-11</option>
              <option value="全家">全家</option>
            </select>
            <div class="help">
              <a id="cvsFinderLink" href="https://emap.pcsc.com.tw/" target="_blank" rel="noopener">開啟 7-11 門市查詢</a>
              <button type="button" class="btn-ghost" onclick="openCvsFinder()">在新分頁開啟</button>
              <button type="button" class="btn-ghost" onclick="pasteCvsFromClipboard()">已選好，一鍵貼上</button>
            </div>
          </div>
          <div>
            <div class="label">門市名稱 / 店號</div>
            <input class="input" name="cvsStore" placeholder="例：豐原成功門市 / 123456">
            <div class="help">先到官方查詢頁選門市，回來後按「已選好，一鍵貼上」自動回填；或手動輸入。</div>
          </div>
        </div>
      </div>

      <div>
        <div class="label">備註（到貨時段等）</div>
        <textarea class="input" name="remark" rows="3" placeholder="例：平日 18:00 後收件"></textarea>
      </div>

      <!-- 同意條款 -->
      <div class="line"></div>
      <div class="label">物流與退貨說明</div>
      <details id="policy" class="card content" style="max-height:220px;overflow:auto">
        <summary style="cursor:pointer"><b>請展開閱讀（需捲到最底才可勾選同意）</b></summary>
        <div class="content" style="padding-top:10px">
          <ul>
            <li>入帳後 1–3 個工作天內出貨（週末與節慶量大時順延）。</li>
            <li>宅配：新竹貨運（常溫）。到貨請「全程開箱錄影」。若有運損，<b>24 小時內提供影片與照片</b>，我們協助向物流理賠。</li>
            <li>超商取貨：<b>免運</b>，<b>限單一 10 台斤 × 1 箱</b>，且目前<b>不接受外島配送</b>。</li>
            <li>水果屬天然農產，<b>表皮無法完美無瑕</b>屬正常現象；外觀、甜度會因氣候批次略有差異。</li>
            <li>生鮮水果依法不適用 7 日猶豫期；自然果斑、糖瓤、甜度落差不列為退換。</li>
          </ul>
          <p class="note">請確認上述內容，捲到底即可啟用同意勾選。</p>
        </div>
      </details>
      <div style="margin:8px 0">
        <label for="agree">
          <input type="checkbox" id="agree" disabled> 我已詳閱<span style="text-decoration:underline">上方</span>「物流與退貨說明」並同意
        </label>
        <div class="help">（若未啟用，請先展開並捲到最底）</div>
      </div>

      <button id="submitBtn" class="btn btn-block" type="submit">送出訂單</button>
      <div id="result" class="note" style="margin-top:8px"></div>
    </form>
  </main>
</aside>

<!-- 訂單查詢抽屜 -->
<aside id="queryDrawer" class="drawer" aria-hidden="true">
  <header>
    <strong>訂單查詢</strong>
    <div class="btns"><button class="btn" onclick="toggleQuery(false)">關閉</button></div>
  </header>
  <main>
    <form id="queryForm" onsubmit="queryOrder(event)" class="form">
      <div>
        <div class="label">訂單編號</div>
        <input class="input" name="orderNo" placeholder="例：K24-20251008-1234" required>
      </div>
      <button class="btn" type="submit" style="margin-top:8px">查詢</button>
    </form>
    <div class="line"></div>
    <div id="queryCard" class="card content" style="display:none"></div>
    <div style="display:flex;gap:8px;margin-top:8px">
      <button id="dlPngBtn" class="btn-ghost" onclick="downloadQueryPNG()" style="display:none">一鍵截圖（PNG）</button>
      <button id="printBtn" class="btn-ghost" onclick="window.print()" style="display:none">列印 / 存 PDF</button>
    </div>
  </main>
</aside>

<!-- 管理員抽屜（登入＋管理面板） -->
<aside id="adminDrawer" class="drawer" aria-hidden="true">
  <header>
    <strong>管理面板</strong>
    <div class="btns">
      <button class="btn-ghost" onclick="logoutAdmin()">登出</button>
      <button class="btn" onclick="toggleAdmin(false)">關閉</button>
    </div>
  </header>
  <main id="adminBody" class="content"><!-- JS render --></main>
</aside>

<!-- 浮動購物車按鈕（橘子樣式） -->
<button id="cartFab" class="fab" aria-label="開啟購物車" onclick="toggleDrawer(true)">
  <span class="emoji">🍊</span> 購物車 <span id="fabCount" class="fab-badge">0</span>
</button>

<!-- 管理員 / 庫存 -->
<button class="admin-btn" onclick="toggleAdmin(true)" title="管理員">🔒</button>
<button class="gear" onclick="toggleInvEdit()" title="庫存編輯">⚙️</button>

<!-- Hero -->
<section class="hero" id="hero">
  <div class="hero-inner wrap">
    <div class="logo"><img id="logoImg" src="" alt="柑心果園 Logo"></div>
    <span class="pill">豐原・東勢｜在地傳承</span>
    <h1>柑心果園｜用心種柑，與你柑心相伴</h1>
    <p>公老坪椪柑（50年）與東勢茂谷（30年），現採分級直送。10 / 25 台斤多規格可選，匯款後立即安排出貨；到貨請開箱錄影，保障運損理賠。</p>
    <div style="margin-top:14px">
      <a id="shopNowBtn" class="btn" href="#hot" onclick="go(event,'hot')">馬上選購</a>
    </div>
  </div>
</section>

<!-- 分類錨點 -->
<nav class="subnav">
  <div class="wrap">
    <div class="rail">
      <button class="chip" onclick="go(event,'hot')">🔥 熱銷款</button>
      <button class="chip" onclick="go(event,'pongan')">公老坪椪柑</button>
      <button class="chip" onclick="go(event,'maogao')">東勢茂谷</button>
      <button class="chip" onclick="toggleQuery(true)">訂單查詢</button>
    </div>
  </div>
</nav>

<!-- 品牌故事 + 最新鮮報 -->
<section class="section">
  <div class="wrap grid grid-2">
    <div class="card content">
      <h2>關於「柑心果園」</h2>
      <p>我們相信，好的水果，來自長年的堅持與土地的回應。</p>
      <p><b>公老坪椪柑</b>承載著家族在山頂的 <b>50 年</b>耕作記憶：日照充足、早晚溫差大，讓果皮薄、汁水足、酸甜平衡。</p>
      <p><b>東勢茂谷</b>則是一路相伴的 <b>30 年</b>老友：香氣清甜、纖維細緻、入口化開。</p>
      <p>從採收、分級到裝箱，我們做的每一步只有一個目的——把最好吃的柑橘，完好送到你手上。<br><b>用心種柑，與你柑心相伴。</b></p>
    </div>
    <div class="card content">
      <h2>最新鮮報｜果園日誌</h2>
      <div class="rail-cards" id="newsRail"></div>
    </div>
  </div>
</section>

<!-- 規格等級 -->
<section class="section">
  <div class="wrap">
    <div class="card content" style="padding-bottom:0">
      <h2>如何分辨規格等級</h2>
      <p class="muted" style="margin-top:-6px">快速了解各等級差異，挑對最合適的口感與顆粒</p>
    </div>
    <div class="rail-cards spec-cards" id="specRail" style="padding:10px 14px"></div>
  </div>
</section>

<!-- 熱銷 -->
<section id="hot" class="section theme-hot">
  <div class="wrap">
    <div class="card content" style="padding-bottom:0">
      <h2>🔥 熱銷款</h2>
      <p class="muted" style="margin-top:-6px">大家最常回購的熱門規格</p>
    </div>
    <div class="card" style="padding:0 14px 14px">
      <div id="hotGrid" class="product-grid"></div>
    </div>
  </div>
</section>

<!-- 公老坪椪柑 -->
<section id="pongan" class="section theme-pongan">
  <div class="wrap">
    <div class="card content" style="padding-bottom:0">
      <h2>公老坪椪柑（50年）</h2>
      <p class="muted" style="margin-top:-6px">現採分級｜皮薄多汁｜酸甜平衡</p>
    </div>
    <div class="card" style="padding:0 14px 14px">
      <div id="ponganGrid" class="product-grid"></div>
    </div>
  </div>
</section>

<!-- 東勢茂谷 -->
<section id="maogao" class="section theme-maogao">
  <div class="wrap">
    <div class="card content" style="padding-bottom:0">
      <h2>東勢茂谷（30年）</h2>
      <p class="muted" style="margin-top:-6px">香氣清甜｜纖維細緻｜入口化開</p>
    </div>
    <div class="card" style="padding:0 14px 14px">
      <div id="maogaoGrid" class="product-grid"></div>
    </div>
  </div>
</section>

<!-- 匯款資訊 -->
<section class="section">
  <div class="wrap card content">
    <h2>匯款資訊</h2>
    <p><strong id="bankName"></strong>　戶名：<strong id="bankHolder"></strong></p>
    <p>帳號：<strong id="bankNo"></strong></p>
    <p class="note">匯款完成後，歡迎到我們的 <a href="https://www.facebook.com/profile.php?id=61581488901343" target="_blank">Facebook</a> 私訊「訂單編號＋匯款後五碼」或直接回覆信件通知「訂單編號＋匯款後五碼」，我們將立即為您安排出貨。</p>
  </div>
</section>

<footer>
  <div class="wrap">
    <div class="content" style="text-align:center;padding-top:0">
      <div class="muted">© 柑心果園｜公老坪椪柑・東勢茂谷</div>
      <div class="muted">地址：台中市石岡區石岡街61號　|　連絡電話：0933-721-978</div>
    </div>
  </div>
</footer>

<!-- Toast -->
<div id="toast" class="toast">已加入購物車</div>

<script>
/** =========================
 * 設定（所有「← 可改」都能直接改）
 * ========================= */
const CONFIG = {
  PRICES: { // ← 可改：售價表
    PONGAN: {
      "10台斤": { "23A": 750, "25A": 780, "27A": 820, "30A": 880 },
      "25台斤": { "23A": 1600,"25A": 1680,"27A": 1780,"30A": 1880 }
    },
    MAOGAO: {
      "10台斤": { "23A": 720, "25A": 760, "27A": 800, "30A": 860 },
      "25台斤": { "23A": 1500,"25A": 1580,"27A": 1680,"30A": 1780 }
    }
  },
  SHIPPING: 160,                 // ← 可改：宅配運費
  FREE_SHIP_THRESHOLD: 1800,     // ← 可改：宅配免運門檻
  BANK: {                        // ← 可改：匯款資訊
    name: "連線銀行(824)",
    holder: "張鈞泓",
    no: "11101-37823-13"
  },
  IMAGES: {                      // ← 可改：圖片 / 影片
    HERO: toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/%E5%B0%81%E9%9D%A2%E5%9C%96.png"),
    LOGO: toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/%E6%9F%91%E5%BF%83%E6%9E%9C%E5%9C%92LOGO.png"),
    SPEC_GALLERY: [
      toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/%E7%AD%89%E7%B4%9A%E6%AF%94%E8%BC%83%E5%9C%96.jpg"),
      "https://via.placeholder.com/1200x800?text=%E8%A6%8F%E6%A0%BC%E5%9C%96+2",
      "https://via.placeholder.com/1200x800?text=%E8%A6%8F%E6%A0%BC%E5%9C%96+3"
    ],
    NEWS: [
      {type:"video", src:"https://raw.githubusercontent.com/s9000721-cloud/gonglaoping/main/780323577.063367.mp4", title:"採收花絮"},
      {type:"image", src:"https://via.placeholder.com/1200x800?text=%E6%9C%80%E6%96%B0%E7%9F%AD%E5%BD%B1", title:"山頂晚霞"},
      {type:"image", src:"https://via.placeholder.com/1200x800?text=%E6%9E%97%E9%96%93%E6%97%A5%E5%B8%B8", title:"果園日常"},
      {type:"video", src:"https://www.w3schools.com/html/mov_bbb.mp4", title:"分級上架"}
    ],
    PONGAN: {
      "10台斤-23A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/10%E6%96%A4%E5%A4%A7%E5%90%89%E5%A4%A7%E5%88%A93.jpg"),
      "10台斤-25A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/10%E6%96%A4%E5%A4%A7%E5%90%89%E5%A4%A7%E5%88%A93.jpg"),
      "10台斤-27A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/10%E6%96%A4%E5%A4%A7%E5%90%89%E5%A4%A7%E5%88%A93.jpg"),
      "10台斤-30A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/10%E6%96%A4%E5%A4%A7%E5%90%89%E5%A4%A7%E5%88%A93.jpg"),
      "25台斤-23A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/25%E6%96%A4%E6%A9%98%E5%AD%90.jpg"),
      "25台斤-25A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/25%E6%96%A4%E6%A9%98%E5%AD%90.jpg"),
      "25台斤-27A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/25%E6%96%A4%E6%A9%98%E5%AD%90.jpg"),
      "25台斤-30A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/25%E6%96%A4%E6%A9%98%E5%AD%90.jpg")
    },
    MAOGAO: {
      "10台斤-23A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/10%E6%96%A4%E5%A4%A7%E5%90%89%E5%A4%A7%E5%88%A93.jpg"),
      "10台斤-25A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/10%E6%96%A4%E5%A4%A7%E5%90%89%E5%A4%A7%E5%88%A93.jpg"),
      "10台斤-27A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/10%E6%96%A4%E5%A4%A7%E5%90%89%E5%A4%A7%E5%88%A93.jpg"),
      "10台斤-30A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/10%E6%96%A4%E5%A4%A7%E5%90%89%E5%A4%A7%E5%88%A93.jpg"),
      "25台斤-23A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/25%E6%96%A4%E6%A9%98%E5%AD%90.jpg"),
      "25台斤-25A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/25%E6%96%A4%E6%A9%98%E5%AD%90.jpg"),
      "25台斤-27A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/25%E6%96%A4%E6%A9%98%E5%AD%90.jpg"),
      "25台斤-30A": toRaw("https://github.com/s9000721-cloud/gonglaoping/blob/main/25%E6%96%A4%E6%A9%98%E5%AD%90.jpg")
    }
  },
  GAS_ENDPOINT: "https://script.google.com/macros/s/AKfycbw5y8y1Yw7ymc7bP-iqV4KmxMB7l3c1wxMpPK1F6-d_vx_ejiIhCzhq0CyHPxDUNM92/exec", // ← 可改
  BRAND_TAG: "柑心果園", // ← 可改
  INVENTORY: { // ← 可改：預設已售出/庫存
    "PON10-23A":{sold:0, stock:999}, "PON10-25A":{sold:0, stock:999}, "PON10-27A":{sold:0, stock:999}, "PON10-30A":{sold:0, stock:999},
    "PON25-23A":{sold:0, stock:999}, "PON25-25A":{sold:0, stock:999}, "PON25-27A":{sold:0, stock:999}, "PON25-30A":{sold:0, stock:999},
    "MAO10-23A":{sold:0, stock:999}, "MAO10-25A":{sold:0, stock:999}, "MAO10-27A":{sold:0, stock:999}, "MAO10-30A":{sold:0, stock:999},
    "MAO25-23A":{sold:0, stock:999}, "MAO25-25A":{sold:0, stock:999}, "MAO25-27A":{sold:0, stock:999}, "MAO25-30A":{sold:0, stock:999}
  }
};

// ✅ 轉 raw.githubusercontent（GitHub 圖片/影片直連）
function toRaw(u){
  if(!u) return u;
  if(u.includes('raw.githubusercontent.com')) return u;
  return u.replace('https://github.com/','https://raw.githubusercontent.com/').replace('/blob/','/');
}

/* ====== 管理員登入（簡易帳密 + 記憶） ====== */
const ADMIN = {
  LS_KEY:'gx_admin_login', // ← 可改
  USER:'111111',           // ← 可改
  PASS:'111111',           // ← 可改
  logged(){ try{return JSON.parse(localStorage.getItem(this.LS_KEY))?.ok;}catch{return false} },
  save(ok){ localStorage.setItem(this.LS_KEY, JSON.stringify({ok:!!ok, ts:Date.now()})); }
};
function toggleAdmin(open){ const d = document.getElementById('adminDrawer'); d.classList.toggle('open', !!open); renderAdmin(); }
function logoutAdmin(){ ADMIN.save(false); invEditMode=false; renderAdmin(); renderAllGrids(); }
function doAdminLogin(){
  const u = document.getElementById('admUser').value.trim();
  const p = document.getElementById('admPass').value.trim();
  if(u===ADMIN.USER && p===ADMIN.PASS){ ADMIN.save(true); alert('登入成功'); renderAdmin(); }
  else alert('帳密錯誤');
}

/* ====== 產品清單 ====== */
const PONGAN = [
  { id:"PON10-23A", section:"PONGAN", title:"椪柑｜10台斤｜23A", weight:"10台斤", size:"23A" },
  { id:"PON10-25A", section:"PONGAN", title:"椪柑｜10台斤｜25A", weight:"10台斤", size:"25A" },
  { id:"PON10-27A", section:"PONGAN", title:"椪柑｜10台斤｜27A", weight:"10台斤", size:"27A" },
  { id:"PON10-30A", section:"PONGAN", title:"椪柑｜10台斤｜30A", weight:"10台斤", size:"30A" },
  { id:"PON25-23A", section:"PONGAN", title:"椪柑｜25台斤｜23A", weight:"25台斤", size:"23A" },
  { id:"PON25-25A", section:"PONGAN", title:"椪柑｜25台斤｜25A", weight:"25台斤", size:"25A" },
  { id:"PON25-27A", section:"PONGAN", title:"椪柑｜25台斤｜27A", weight:"25台斤", size:"27A" },
  { id:"PON25-30A", section:"PONGAN", title:"椪柑｜25台斤｜30A", weight:"25台斤", size:"30A" },
];
const MAOGAO = [
  { id:"MAO10-23A", section:"MAOGAO", title:"茂谷｜10台斤｜23A", weight:"10台斤", size:"23A" },
  { id:"MAO10-25A", section:"MAOGAO", title:"茂谷｜10台斤｜25A", weight:"10台斤", size:"25A" },
  { id:"MAO10-27A", section:"MAOGAO", title:"茂谷｜10台斤｜27A", weight:"10台斤", size:"27A" },
  { id:"MAO10-30A", section:"MAOGAO", title:"茂谷｜10台斤｜30A", weight:"10台斤", size:"30A" },
  { id:"MAO25-23A", section:"MAOGAO", title:"茂谷｜25台斤｜23A", weight:"25台斤", size:"23A" },
  { id:"MAO25-25A", section:"MAOGAO", title:"茂谷｜25台斤｜25A", weight:"25台斤", size:"25A" },
  { id:"MAO25-27A", section:"MAOGAO", title:"茂谷｜25台斤｜27A", weight:"25台斤", size:"27A" },
  { id:"MAO25-30A", section:"MAOGAO", title:"茂谷｜25台斤｜30A", weight:"25台斤", size:"30A" },
];

/* ====== LocalStorage Keys ====== */
const LS = {
  cart: 'gx_cart',
  shipMethod: 'gx_ship_method',
  form: 'gx_form',
  inventory: 'gx_inventory',
  overrides: 'gx_overrides'
};

/* ====== 匯款 + 圖片（Hero/Logo）帶入 ====== */
document.getElementById('bankName').textContent = CONFIG.BANK.name;
document.getElementById('bankHolder').textContent = CONFIG.BANK.holder;
document.getElementById('bankNo').textContent = CONFIG.BANK.no;
document.getElementById('freeShipText').textContent = 'NT$ ' + CONFIG.FREE_SHIP_THRESHOLD.toLocaleString();
document.getElementById('hero').style.backgroundImage = "url('" + CONFIG.IMAGES.HERO + "')";
document.getElementById('logoImg').src = CONFIG.IMAGES.LOGO;

/* ====== 價格/圖片工具 ====== */
const priceOf = (section,weight,size)=> CONFIG.PRICES[section]?.[weight]?.[size] ?? 0;
const currency = n => "NT$ "+(n||0).toLocaleString();
const imgFor = (section,weight,size)=> CONFIG.IMAGES[section]?.[`${weight}-${size}`] || 'https://via.placeholder.com/800x600?text=Image';

function setPrice(section,weight,size,val){ // 管理：改價
  if(!CONFIG.PRICES[section]) CONFIG.PRICES[section]={};
  if(!CONFIG.PRICES[section][weight]) CONFIG.PRICES[section][weight]={};
  CONFIG.PRICES[section][weight][size] = Math.max(0, parseInt(val||0));
  saveOverrides();
}
function setImage(section,weight,size,url){ // 管理：改圖
  if(!CONFIG.IMAGES[section]) CONFIG.IMAGES[section]={};
  CONFIG.IMAGES[section][`${weight}-${size}`] = toRaw(url.trim());
  saveOverrides();
  renderAllGrids();
}

/* ====== 購物車 ====== */
const cart = loadCart();
function loadCart(){ try{ const s = localStorage.getItem(LS.cart); return s? JSON.parse(s):[]; }catch{ return []; } }
function saveCart(){ localStorage.setItem(LS.cart, JSON.stringify(cart)); }

/* ====== 前端庫存＋銷售狀態 ======
  新增 STATUS 狀態：{ [id]: 'normal' | 'preorder' | 'soldout' }
  - 管理員在商品卡可勾選「開放預購 / 已售完」
====================================================== */
let INV = loadInventory();
function loadInventory(){
  try{ const s = localStorage.getItem(LS.inventory); return s ? JSON.parse(s) : JSON.parse(JSON.stringify(CONFIG.INVENTORY)); }
  catch{ return JSON.parse(JSON.stringify(CONFIG.INVENTORY)); }
}
function saveInventory(){ localStorage.setItem(LS.inventory, JSON.stringify(INV)); }
let STATUS = {}; // 由 overrides 載入/儲存

let invEditMode = false;
function toggleInvEdit(){
  if(!ADMIN.logged()){ toggleAdmin(true); return; }
  invEditMode = !invEditMode;
  renderAllGrids();
}

/* ====== 覆寫（標題/圖片/價格/狀態）儲存 ====== */
function saveOverrides(){
  const map = {
    PRICES: CONFIG.PRICES,
    IMAGES: CONFIG.IMAGES,
    TITLES: collectTitles(),
    STATUS // 新增
  };
  localStorage.setItem(LS.overrides, JSON.stringify(map));
}
function loadOverrides(){
  try{
    const s = localStorage.getItem(LS.overrides);
    if(!s) return;
    const o = JSON.parse(s);
    if(o.PRICES) CONFIG.PRICES = o.PRICES;
    if(o.IMAGES) CONFIG.IMAGES = o.IMAGES;
    if(o.TITLES) applyTitles(o.TITLES);
    if(o.STATUS) STATUS = o.STATUS;
  }catch{}
}
function collectTitles(){
  const t = {};
  [...PONGAN, ...MAOGAO].forEach(p=>{ t[p.id]=p.title; });
  return t;
}
function applyTitles(map){
  [...PONGAN, ...MAOGAO].forEach(p=>{ if(map[p.id]) p.title = map[p.id]; });
}

/* ====== 渲染產品卡片（含狀態與管理控制） ====== */
function productCard(p){
  const price = priceOf(p.section, p.weight, p.size);
  const img = imgFor(p.section, p.weight, p.size);
  const isHot = p.size==='25A';
  const inv = INV[p.id] || {sold:0,stock:999};
  const st = STATUS[p.id] || 'normal'; // normal | preorder | soldout
  const editable = ADMIN.logged();

  // 狀態徽章 & 按鈕狀態
  const badge = st==='soldout' ? '<span class="img-badge">已售完</span>'
              : st==='preorder' ? '<span class="img-badge">開放預購</span>' : '';
  const btnDisabled = st==='soldout' ? 'disabled' : '';
  const btnText = st==='preorder' ? '預購' : '購買';

  return `
  <article class="product card">
    <div class="imgbox">
      <img src="${img}" alt="${p.title}">
      ${badge}
    </div>
    <div class="body">
      <div class="row-between" style="gap:8px">
        <h3 class="title" ${editable?'contenteditable="true" onblur="editTitle(\''+p.id+'\', this.textContent.trim())"':''}>${p.title}</h3>
        ${isHot ? '<span class="tag-hot" aria-label="熱銷">🔥 熱銷</span>' : ''}
      </div>

      <div class="note" style="margin-top:6px"> 已售出 ${inv.sold}　剩餘 ${inv.stock} 箱 </div>

      <div class="price" style="margin:6px 0 10px">
        ${editable
          ? `<input type="number" value="${price}" style="width:120px" onblur="setPrice('${p.section}','${p.weight}','${p.size}', this.value)">`
          : `${currency(price)}`
        }
      </div>

      ${editable ? `
      <!-- 管理：圖片網址 -->
      <div class="note" style="display:flex;gap:6px;align-items:center;flex-wrap:wrap;margin:6px 0 10px">
        <span>圖片網址</span>
        <input type="url" value="${img}" style="flex:1;min-width:140px" onblur="setImage('${p.section}','${p.weight}','${p.size}', this.value)">
      </div>
      <!-- 管理：銷售狀態（兩個勾選框） -->
      <div class="note" style="display:flex;gap:14px;align-items:center;flex-wrap:wrap;margin:6px 0 10px">
        <label><input type="checkbox" ${st==='preorder'?'checked':''} onchange="setStatus('${p.id}','preorder',this.checked)"> 開放預購</label>
        <label><input type="checkbox" ${st==='soldout'?'checked':''} onchange="setStatus('${p.id}','soldout',this.checked)"> 已售完</label>
        <span class="help">（兩個都不勾＝正常販售）</span>
      </div>` : ``}

      <button class="btn btn-block" ${btnDisabled} onclick="addToCart('${p.id}')" aria-label="加入購物車">${btnText}</button>

      ${invEditMode ? `
      <div class="note" style="margin-top:8px;display:flex;gap:6px;align-items:center;flex-wrap:wrap">
        <span>已售出</span><input type="number" min="0" value="${inv.sold}" style="width:80px" onchange="editInv('${p.id}','sold',this.value)">
        <span>剩餘</span><input type="number" min="0" value="${inv.stock}" style="width:80px" onchange="editInv('${p.id}','stock',this.value)">
      </div>` : ``}
    </div>
  </article>`;
}

function setStatus(id, type, checked){
  // 規則：若勾「已售完」→ 一律 soldout；否則若勾「預購」→ preorder；否則 normal
  const cur = STATUS[id] || 'normal';
  let next = cur;
  if(type==='soldout' && checked){ next='soldout'; }
  else if(type==='soldout' && !checked){ next = (STATUS[id]==='soldout') ? 'normal' : (STATUS[id]||'normal'); }

  if(type==='preorder'){
    if(checked) next = 'preorder';
    else if(STATUS[id]==='preorder') next = 'normal';
  }
  // 若兩個都勾，「已售完」優先
  const el = document.querySelectorAll('input[type="checkbox"]');
  // 正規做法：直接以 DOM 狀態重新判定
  const card = document.querySelectorAll('[onclick="addToCart(\\''+id+'\\')"]');
  // 直接重算：
  const preorder = document.querySelectorAll(`input[type="checkbox"][onchange="setStatus('${id}','preorder',this.checked)"]`)[0]?.checked;
  const soldout  = document.querySelectorAll(`input[type="checkbox"][onchange="setStatus('${id}','soldout',this.checked)"]`)[0]?.checked;
  if(soldout) next='soldout';
  else if(preorder) next='preorder';
  else next='normal';

  STATUS[id]=next;
  saveOverrides();
  renderAllGrids();
}

function editTitle(id, val){
  const item = [...PONGAN, ...MAOGAO].find(x=>x.id===id);
  if(item){
    item.title = val || item.title;
    saveOverrides();
    renderAllGrids();
  }
}

function editInv(id,key,val){
  if(!INV[id]) INV[id]={sold:0,stock:0};
  INV[id][key] = Math.max(0, parseInt(val||0));
  saveInventory();
  renderAllGrids();
}

function renderGrid(elId, items){
  const el = document.getElementById(elId);
  if(!el) return;
  el.innerHTML = items.map(productCard).join('');
}
function renderAllGrids(){
  renderGrid('hotGrid', HOT);
  renderGrid('ponganGrid', PONGAN);
  renderGrid('maogaoGrid', MAOGAO);
}

/* 熱銷：目前用 25A 作為代表 */
const HOT = [...PONGAN, ...MAOGAO].filter(p=>p.size==='25A');

/* 規格/新聞 牆 */
function renderSpecRail(){
  const rail = document.getElementById('specRail');
  if(!rail) return;
  rail.innerHTML = (CONFIG.IMAGES.SPEC_GALLERY||[]).map(src=>`
    <div class="card"><img src="${src}" alt="規格等級說明" style="width:100%;height:auto;display:block;border-radius:16px"></div>
  `).join('');
}
function renderNewsRail(){
  const rail = document.getElementById('newsRail');
  if(!rail) return;
  rail.innerHTML = (CONFIG.IMAGES.NEWS||[]).map(item=>{
    if(item.type==='video'){
      return `<div class="card" style="overflow:hidden">
        <video src="${item.src}" controls playsinline style="width:100%;height:100%;display:block"></video>
        <div class="content" style="padding:10px">${item.title||''}</div>
      </div>`;
    }else{
      return `<div class="card">
        <img src="${item.src}" alt="${item.title||''}" style="width:100%;height:auto;display:block;border-radius:16px 16px 0 0">
        <div class="content" style="padding:10px">${item.title||''}</div>
      </div>`;
    }
  }).join('');
}

/* ====== 購物車流程（不自動開抽屜，改用 Toast + 徽章動畫） ====== */
function addToCart(pid){
  const src = [...PONGAN, ...MAOGAO].find(x=>x.id===pid);
  if(!src) return;
  const price = priceOf(src.section, src.weight, src.size);
  const existed = cart.find(x=>x.id===pid);
  if(existed) existed.qty++;
  else cart.push({ id:src.id, title:src.title, price, qty:1, weight:src.weight, size:src.size, section:src.section });
  saveCart();
  renderCart();
  showToast('已加入購物車');
  bumpFab();
}
function mutateQty(i,delta){
  cart[i].qty += delta;
  if(cart[i].qty<=0) cart.splice(i,1);
  saveCart(); renderCart();
}
function clearCart(){
  if(!cart.length) return;
  if(confirm('確定要清空購物車？')){ cart.length = 0; saveCart(); renderCart(); }
}
function calc(){
 
