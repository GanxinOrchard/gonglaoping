<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>柑心果園｜公老坪椪柑・東勢茂谷｜在地傳承的好滋味</title>
  <meta name="description" content="柑心果園：用心種柑，與你柑心相伴。公老坪山頂在地50年椪柑、東勢在地30年茂谷。現採分級直送，10/25 台斤多規格，匯款立即安排出貨。到貨請開箱錄影保障理賠。">
  <style>
    :root{
      --bg:#faf7f2; --surface:#ffffff; --text:#1f2937; --muted:#6b7280;
      --brand:#f59e0b; --brand-dark:#d97706; --border:#e5e7eb;
      --shadow:0 10px 28px rgba(0,0,0,.06);
      --hot:#ef4444; --hot-dark:#dc2626;
      --pongan-surface:#fff7d6; --maogao-surface:#eef9f0;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Noto Sans TC","Helvetica Neue",Arial,sans-serif}
    a{color:var(--brand-dark);text-decoration:none}
    .wrap{max-width:1100px;margin:0 auto;padding:0 16px}

    /* ===== Hero 區塊 ===== */
    .hero{position:relative;min-height:52vh;display:grid;place-items:center;color:#fff;background-size:cover;background-position:center}
    @media(max-width:560px){.hero{min-height:44vh}}
    .hero::after{content:"";position:absolute;inset:0;background:linear-gradient(180deg,rgba(0,0,0,.45),rgba(0,0,0,.38));z-index:0;pointer-events:none}
    .hero-inner{position:relative;z-index:1;text-align:center;padding:56px 16px}
    .logo{width:110px;height:110px;border-radius:18px;background:#fff9;padding:10px;backdrop-filter:blur(4px);display:inline-grid;place-items:center;margin-bottom:10px}
    .logo img{max-width:100%;max-height:100%}
    .hero h1{font-size:clamp(21px,4.8vw,36px);margin:4px 0 6px}
    .hero p{font-size:clamp(12.5px,3.2vw,15px);opacity:.98;margin:0}
    .pill{display:inline-block;background:#fff3;backdrop-filter:blur(4px);border:1px solid #fff7;color:#fff;border-radius:999px;padding:6px 10px;font-weight:700}

    /* ===== 按鈕 ===== */
    .btn{display:inline-flex;align-items:center;gap:8px;border-radius:12px;padding:10px 14px;background:var(--brand);color:#111;font-weight:700;border:1px solid rgba(0,0,0,.05);box-shadow:0 10px 20px rgba(245,158,11,.25);cursor:pointer;font-size:clamp(12.5px,3vw,15px)}
    .btn:hover{background:var(--brand-dark)}
    .btn-ghost{background:#f9fafb;border:1px solid var(--border);color:var(--text);box-shadow:none}
    .btn-ghost:hover{background:#f3f4f6}
    .btn-red{background:var(--hot);color:#fff;border-color:#ef4444;box-shadow:0 10px 20px rgba(239,68,68,.25)}
    .btn-red:hover{background:var(--hot-dark)}
    .btn-block{width:100%;justify-content:center}

    /* ===== 卡片 ===== */
    .card{background:var(--surface);border:1px solid var(--border);border-radius:16px;box-shadow:var(--shadow)}
    .content{padding:16px}
    .content p{margin:0 0 10px;line-height:1.8;font-size:clamp(13.5px,3.2vw,15px)}

    /* ===== 抽屜（共用） ===== */
    .drawer{position:fixed;right:0;top:0;bottom:0;width:min(480px,96%);background:var(--surface);border-left:1px solid var(--border);transform:translateX(105%);transition:.28s;z-index:60;display:flex;flex-direction:column}
    .drawer.open{transform:none}
    .drawer header{padding:12px 14px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;gap:8px}
    .drawer main{padding:12px 14px;overflow:auto;flex:1}

    /* ===== 浮動購物車 🍊 ===== */
    .fab{position:fixed;right:16px;bottom:calc(16px + env(safe-area-inset-bottom));z-index:55;background:var(--brand);color:#111;border:1px solid rgba(0,0,0,.06);padding:12px 16px;border-radius:999px;box-shadow:0 10px 18px rgba(245,158,11,.35);display:flex;align-items:center;gap:8px;font-weight:800;cursor:pointer}
    .fab-badge{display:inline-block;min-width:22px;height:22px;border-radius:999px;background:#111;color:#fff;font-size:12px;line-height:22px;text-align:center;padding:0 6px}

    /* ===== 頁尾 ===== */
    footer{padding:34px 0 56px;color:#6b7280;text-align:center}
  </style>
</head>
<body>
  <!-- 購物車抽屜 -->
  <aside id="drawer" class="drawer" aria-hidden="true">
    <header>
      <strong>購物車</strong>
      <div class="btns">
        <button class="btn-ghost" onclick="clearCart()">清空購物車</button>
        <button class="btn" onclick="toggleDrawer(false)">關閉</button>
      </div>
    </header>
    <main>
      <div id="cartList"></div>
      <div class="line"></div>
      <!-- 運費、總額會在 JS 裡更新 -->
      <div class="summary">
        <div class="row-between"><span>商品小計</span><strong id="subtotal">$0</strong></div>
        <div class="row-between"><span id="shipLabel">運費（宅配）</span><strong id="shipping">$0</strong></div>
        <div class="line"></div>
        <div class="row-between" style="font-size:18px"><span>應付金額</span><strong id="total">$0</strong></div>
      </div>
    </main>
  </aside>

  <!-- 訂單查詢抽屜 -->
  <aside id="queryDrawer" class="drawer" aria-hidden="true">
    <header>
      <strong>訂單查詢</strong>
      <div class="btns">
        <button class="btn" onclick="toggleQuery(false)">關閉</button>
      </div>
    </header>
    <main>
      <form id="queryForm" onsubmit="queryOrder(event)" class="form">
        <div class="label">訂單編號</div>
        <input class="input" name="orderNo" required>
        <button class="btn" type="submit" style="margin-top:8px">查詢</button>
      </form>
      <div class="line"></div>
      <div id="queryCard" class="card content" style="display:none"></div>
    </main>
  </aside>

  <!-- 管理員抽屜 -->
  <aside id="adminDrawer" class="drawer" aria-hidden="true">
    <header>
      <strong>管理面板</strong>
      <div class="btns">
        <button class="btn-ghost" onclick="logoutAdmin()">登出</button>
        <button class="btn" onclick="toggleAdmin(false)">關閉</button>
      </div>
    </header>
    <main id="adminBody" class="content">
      <!-- 登入後會由 JS 動態渲染 -->
    </main>
  </aside>

  <!-- 浮動購物車 🍊 -->
  <button id="cartFab" class="fab" aria-label="開啟購物車" onclick="toggleDrawer(true)">
    🍊 購物車 <span id="fabCount" class="fab-badge">0</span>
  </button>

  <!-- 管理員按鈕 -->
  <button class="admin-btn" onclick="toggleAdmin(true)" title="管理員">🔒</button>

  <!-- Hero 區塊 -->
  <section class="hero" id="hero">
    <div class="hero-inner wrap">
      <div class="logo"><img id="logoImg" src="" alt="柑心果園 Logo"></div>
      <span class="pill" contenteditable="true" data-key="hero-pill">豐原・東勢｜在地傳承</span>
      <h1 contenteditable="true" data-key="hero-title">柑心果園｜用心種柑，與你柑心相伴</h1>
      <p contenteditable="true" data-key="hero-desc">公老坪椪柑（50年）與東勢茂谷（30年），現採分級直送。</p>
      <div style="margin-top:14px">
        <a id="shopNowBtn" class="btn" href="#hot">馬上選購</a>
      </div>
    </div>
  </section>

  <!-- 下面品牌故事 / 最新鮮報 / 商品區塊 ... -->
  <!-- （保持原本結構，等第二段 JS 來控制可編輯與儲存） -->

  <footer>
    <div class="wrap">
      <div class="content" style="text-align:center;padding-top:0">
        <div class="muted">© 柑心果園｜公老坪椪柑・東勢茂谷</div>
        <div class="muted">地址：台中市石岡區石岡街61號　|　連絡電話：0933-721-978</div>
      </div>
    </div>
  </footer>
<script>
/* ========== 全域狀態 ========== */
let CART = JSON.parse(localStorage.getItem('gx_cart')||'[]');

/* ========== 工具函式 ========== */
function saveCart(){
  localStorage.setItem('gx_cart', JSON.stringify(CART));
  renderCart();
}
function clearCart(){
  if(confirm('確定要清空購物車嗎？')){
    CART = [];
    saveCart();
  }
}

/* ========== 購物車 ========== */
function renderCart(){
  const list = document.getElementById('cartList');
  const fabCount = document.getElementById('fabCount');
  if(!list||!fabCount) return;
  list.innerHTML='';
  let subtotal = 0;
  CART.forEach((item,i)=>{
    subtotal += item.price*item.qty;
    const row = document.createElement('div');
    row.className='row-between';
    row.innerHTML=`
      <div>${item.name} x${item.qty}</div>
      <div>$${item.price*item.qty}</div>
    `;
    list.appendChild(row);
  });
  fabCount.textContent = CART.length;
  document.getElementById('subtotal').textContent = '$'+subtotal;
  document.getElementById('shipping').textContent = '$0';
  document.getElementById('total').textContent = '$'+subtotal;
}

/* ====== 打開/關閉抽屜 ====== */
function toggleDrawer(open){document.getElementById('drawer').classList.toggle('open',open);}
function toggleQuery(open){document.getElementById('queryDrawer').classList.toggle('open',open);}
function toggleAdmin(open){document.getElementById('adminDrawer').classList.toggle('open',open);}

/* ========== 管理員登入/登出 ========== */
const ADMIN = {
  logged:()=>localStorage.getItem('gx_admin')==='1'
};
function doAdminLogin(){
  const u=document.getElementById('admUser').value.trim();
  const p=document.getElementById('admPass').value.trim();
  if(u==='111111'&&p==='111111'){
    localStorage.setItem('gx_admin','1');
    renderAdmin();
  }else alert('帳密錯誤');
}
function logoutAdmin(){
  localStorage.removeItem('gx_admin');
  renderAdmin();
}

/* ========== 管理面板內容渲染 ========== */
function renderAdmin(){
  const box=document.getElementById('adminBody');
  if(!ADMIN.logged()){
    box.innerHTML=`
      <h3>管理員登入</h3>
      <div class="note">預設帳密皆為 111111</div>
      <div class="form">
        <div class="label">帳號</div>
        <input class="input" id="admUser">
        <div class="label">密碼</div>
        <input class="input" id="admPass" type="password">
        <button class="btn" onclick="doAdminLogin()">登入</button>
      </div>
    `;
  }else{
    box.innerHTML=`
      <h3>快速編輯模式</h3>
      <p class="note">可直接修改卡片文字、圖片網址、價格。</p>
      <div class="line"></div>
      <h4>GitHub RAW URL 轉換工具</h4>
      <div class="form">
        <div class="label">GitHub 檔案網址</div>
        <input class="input" id="ghRawInput" placeholder="https://github.com/.../blob/main/xxx.png">
        <button class="btn" onclick="convertRawUrl()">轉換</button>
        <div id="ghRawMsg" class="note" style="margin-top:6px"></div>
      </div>
      <div class="line"></div>
      <button class="btn btn-red" onclick="confirmAllChanges()">確認修改並儲存</button>
    `;
  }
}

/* ========== RAW URL 轉換器 ========== */
function convertRawUrl(){
  const input=document.getElementById('ghRawInput').value.trim();
  const msg=document.getElementById('ghRawMsg');
  if(!input){msg.textContent='請先貼上網址';return;}
  let raw=input.replace('https://github.com/','https://raw.githubusercontent.com/').replace('/blob/','/');
  msg.innerHTML=`✅ 轉換成功：<a href="${raw}" target="_blank">${raw}</a>`;
}

/* ========== 可編輯卡片儲存 ========== */
function confirmAllChanges(){
  const editableEls=document.querySelectorAll('[contenteditable][data-key]');
  const edits={};
  editableEls.forEach(el=>{
    edits[el.dataset.key]=el.innerHTML;
  });
  localStorage.setItem('gx_card_edits',JSON.stringify(edits));
  alert('修改已儲存');
}
function loadCardEdits(){
  try{
    const edits=JSON.parse(localStorage.getItem('gx_card_edits')||'{}');
    for(const k in edits){
      const el=document.querySelector(`[data-key="${k}"]`);
      if(el) el.innerHTML=edits[k];
    }
  }catch{}
}

/* ========== 商品卡片（含預購/售完） ========== */
function addToCart(name,price,status){
  if(status==='soldout'){alert('此商品已售完');return;}
  CART.push({name,price,qty:1});
  saveCart();
  // 注意：這裡不會自動打開購物車，只更新右下角橘子數字
}
function renderProducts(){
  // 範例：你可以在這裡生成商品卡
  const container=document.getElementById('hot');
  if(!container) return;
  container.innerHTML='';
  const products=[
    {id:1,name:'公老坪椪柑 10斤',price:650,status:'normal'},
    {id:2,name:'東勢茂谷禮盒 10斤',price:800,status:'preorder'},
    {id:3,name:'限量茂谷禮盒 20斤',price:1500,status:'soldout'}
  ];
  products.forEach(p=>{
    let badge='';
    if(p.status==='preorder') badge='<div style="color:#f59e0b;font-weight:700">預購中</div>';
    if(p.status==='soldout') badge='<div style="color:#ef4444;font-weight:700">已售完</div>';
    const card=document.createElement('div');
    card.className='card content';
    card.innerHTML=`
      <h3>${p.name}</h3>
      <p>價格：$${p.price}</p>
      ${badge}
      <button class="btn" ${p.status==='soldout'?'disabled':''}
        onclick="addToCart('${p.name}',${p.price},'${p.status}')">加入購物車</button>
    `;
    container.appendChild(card);
  });
}

/* ========== 初始化 ========== */
function init(){
  renderCart();
  renderAdmin();
  loadCardEdits();
  renderProducts();
}
init();
</script>
</body>
</html>
